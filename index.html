<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQZone - IQ Assessment & High IQ Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333333;
            position: relative;
            /* Added for animation container */
        }

        /* Brain Animation Styles */
        .brain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        #brainCanvas {
            width: 100%;
            height: 100%;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            color: #666666;
            font-size: 1.1rem;
        }

        .intro-section {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .intro-section h2 {
            color: #00d4ff;
            margin-bottom: 20px;
        }

        .intro-section ul {
            list-style: none;
            margin: 20px 0;
        }

        .intro-section li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            color: #555555;
        }

        .intro-section li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #00d4ff;
        }

        .btn {
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            color: #fff;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .test-section {
            display: none;
        }

        .question-card {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            transition: width 0.3s;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            color: #00d4ff;
            font-size: 0.9rem;
        }

        .timer {
            color: #ff6b6b;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .category-badge {
            background: rgba(123, 44, 191, 0.15);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #7b2cbf;
        }

        .difficulty-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .difficulty-easy {
            background: rgba(16, 185, 129, 0.15);
            color: #059669;
        }

        .difficulty-medium {
            background: rgba(245, 158, 11, 0.15);
            color: #d97706;
        }

        .difficulty-hard {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #333333;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 300px;
            margin: 20px auto;
        }

        .matrix-cell {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #333333;
        }

        .matrix-cell.empty {
            background: rgba(0, 212, 255, 0.1);
            border: 2px dashed #00d4ff;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .option {
            background: rgba(0, 0, 0, 0.02);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option:hover {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.05);
        }

        .option.selected {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }

        .option-label {
            font-size: 1.1rem;
            color: #333333;
        }

        .sequence-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .sequence-item {
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333333;
        }

        .sequence-item.unknown {
            background: rgba(0, 212, 255, 0.1);
            border: 2px dashed #00d4ff;
            color: #00d4ff;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid rgba(0, 0, 0, 0.2);
            color: #333333;
        }

        .btn-secondary:hover {
            border-color: #00d4ff;
            box-shadow: none;
        }

        .results-section {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7b2cbf);
            margin: 40px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-number {
            font-size: 4rem;
            font-weight: bold;
            color: #ffffff;
        }

        .score-label {
            font-size: 1rem;
            opacity: 0.8;
            color: #ffffff;
        }

        .results-details {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            text-align: left;
        }

        .result-category {
            margin-bottom: 25px;
        }

        .result-category h4 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .result-bar {
            height: 20px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .result-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            border-radius: 10px;
            transition: width 1s;
        }

        .result-score {
            text-align: right;
            margin-top: 5px;
            color: #666666;
            font-size: 0.9rem;
        }

        .iq-classification {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .iq-classification h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .percentile-info {
            color: #666666;
            margin-top: 15px;
        }

        .shape-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .shape {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .shape svg {
            width: 100%;
            height: 100%;
        }

        .analogy-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .analogy-item {
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            font-size: 1.2rem;
            color: #333333;
        }

        .analogy-separator {
            color: #00d4ff;
            font-size: 1.5rem;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8rem;
            }

            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>

<body>
    <!-- Brain Animation Container -->
    <div class="brain-container">
        <canvas id="brainCanvas"></canvas>
    </div>

    <div class="container">
        <header>
            <h1>IQZone</h1>
            <p>Í≥ºÌïôÏ†Å Î¨∏Ï†ú ÏÑ§Í≥Ñ Í∏∞Î∞ò Ï¢ÖÌï© Ïù∏ÏßÄÎä•Î†• ÌèâÍ∞Ä</p>
        </header>

        <!-- ÏãúÏûë ÌôîÎ©¥ -->
        <div class="intro-section" id="intro">
            <h2>ÌÖåÏä§Ìä∏ ÏïàÎÇ¥</h2>
            <p>Î≥∏ ÌÖåÏä§Ìä∏Îäî Îã§ÏñëÌïú Ïù∏ÏßÄ ÏòÅÏó≠ÏùÑ Ï∏°Ï†ïÌïòÎäî Ï¢ÖÌï© ÌèâÍ∞ÄÏûÖÎãàÎã§.</p>

            <ul>
                <li><strong>Ìå®ÌÑ¥ Ïù∏Ïãù</strong> - ÏãúÍ∞ÅÏ†Å Ìå®ÌÑ¥Í≥º Í∑úÏπô Î∞úÍ≤¨ Îä•Î†•</li>
                <li><strong>ÏàòÏó¥ Ï∂îÎ°†</strong> - ÏàòÌïôÏ†Å Ìå®ÌÑ¥ Ïù∏Ïãù Îä•Î†•</li>
                <li><strong>Í≥µÍ∞Ñ Ï∂îÎ°†</strong> - ÎèÑÌòï ÌöåÏ†Ñ Î∞è Í≥µÍ∞Ñ ÏßÄÍ∞Å Îä•Î†•</li>
                <li><strong>ÎÖºÎ¶¨ Ï∂îÎ°†</strong> - ÎÖºÎ¶¨Ï†Å ÏÇ¨Í≥†Î†•</li>
                <li><strong>Ïñ∏Ïñ¥ Ïú†Ï∂î</strong> - Í∞úÎÖê Í∞Ñ Í¥ÄÍ≥Ñ ÌååÏïÖ Îä•Î†•</li>
            </ul>

            <div
                style="margin-top: 30px; padding: 20px; background: rgba(255,107,107,0.1); border-radius: 10px; border: 1px solid rgba(255,107,107,0.3);">
                <p><strong>‚è±Ô∏è Ï†úÌïú ÏãúÍ∞Ñ:</strong> Î¨∏Ï†úÎãπ 60Ï¥à</p>
                <p><strong>üìù Î¨∏Ìï≠ Ïàò:</strong> Ï¥ù 25Î¨∏Ìï≠</p>
                <p><strong>‚ö†Ô∏è Ï£ºÏùò:</strong> Í∞Å Î¨∏Ï†úÎäî Ìïú Î≤àÎßå ÎãµÌï† Ïàò ÏûàÏäµÎãàÎã§</p>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn" onclick="startTest()">ÌÖåÏä§Ìä∏ ÏãúÏûëÌïòÍ∏∞</button>
            </div>
        </div>

        <!-- ÌÖåÏä§Ìä∏ ÌôîÎ©¥ -->
        <div class="test-section" id="test">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-number" id="questionNum">Î¨∏Ï†ú 1/25</span>
                    <div>
                        <span class="category-badge" id="categoryBadge">Ìå®ÌÑ¥ Ïù∏Ïãù</span>
                        <span class="difficulty-badge" id="difficultyBadge">Ïâ¨ÏõÄ</span>
                    </div>
                    <span class="timer" id="timer">60Ï¥à</span>
                </div>

                <div id="questionContent">
                    <!-- Î¨∏Ï†ú ÎÇ¥Ïö©Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÇΩÏûÖÎê® -->
                </div>

                <div class="options-grid" id="optionsGrid">
                    <!-- ÏÑ†ÌÉùÏßÄÍ∞Ä ÎèôÏ†ÅÏúºÎ°ú ÏÇΩÏûÖÎê® -->
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="skipQuestion()">Í±¥ÎÑàÎõ∞Í∏∞</button>
                    <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>Îã§Ïùå Î¨∏Ï†ú</button>
                </div>
            </div>
        </div>

        <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
        <div class="results-section" id="results">
            <h2>ÌÖåÏä§Ìä∏ ÏôÑÎ£å!</h2>

            <div class="score-circle">
                <span class="score-number" id="iqScore">--</span>
                <span class="score-label">IQ Ï†êÏàò</span>
            </div>

            <div class="iq-classification" id="iqClass">
                <h3 id="classLabel">Î∂ÑÎ•ò</h3>
                <p id="classDesc">ÏÑ§Î™Ö</p>
                <p class="percentile-info" id="percentile">ÏÉÅÏúÑ %</p>
            </div>

            <div class="results-details">
                <h3 style="margin-bottom: 30px; color: #333333;">ÏòÅÏó≠Î≥Ñ Î∂ÑÏÑù</h3>

                <div class="result-category">
                    <h4>Ìå®ÌÑ¥ Ïù∏Ïãù (Pattern Recognition)</h4>
                    <div class="result-bar">
                        <div class="result-bar-fill" id="patternBar" style="width: 0%"></div>
                    </div>
                    <div class="result-score" id="patternScore">0/5</div>
                </div>

                <div class="result-category">
                    <h4>ÏàòÏó¥ Ï∂îÎ°† (Numerical Reasoning)</h4>
                    <div class="result-bar">
                        <div class="result-bar-fill" id="numericalBar" style="width: 0%"></div>
                    </div>
                    <div class="result-score" id="numericalScore">0/5</div>
                </div>

                <div class="result-category">
                    <h4>Í≥µÍ∞Ñ Ï∂îÎ°† (Spatial Reasoning)</h4>
                    <div class="result-bar">
                        <div class="result-bar-fill" id="spatialBar" style="width: 0%"></div>
                    </div>
                    <div class="result-score" id="spatialScore">0/5</div>
                </div>

                <div class="result-category">
                    <h4>ÎÖºÎ¶¨ Ï∂îÎ°† (Logical Reasoning)</h4>
                    <div class="result-bar">
                        <div class="result-bar-fill" id="logicalBar" style="width: 0%"></div>
                    </div>
                    <div class="result-score" id="logicalScore">0/5</div>
                </div>

                <div class="result-category">
                    <h4>Ïñ∏Ïñ¥ Ïú†Ï∂î (Verbal Analogies)</h4>
                    <div class="result-bar">
                        <div class="result-bar-fill" id="verbalBar" style="width: 0%"></div>
                    </div>
                    <div class="result-score" id="verbalScore">0/5</div>
                </div>
            </div>

            <button class="btn" onclick="location.reload()">Îã§Ïãú ÌÖåÏä§Ìä∏ÌïòÍ∏∞</button>
        </div>
    </div>

    <script>
        // ============================================
        // IQ ÌÖåÏä§Ìä∏ Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§
        // ============================================

        const questions = {
            // Ìå®ÌÑ¥ Ïù∏Ïãù Î¨∏Ï†ú (ÌñâÎ†¨ Ï∂îÎ°† Ïä§ÌÉÄÏùº)
            pattern: [
                {
                    id: 'p1',
                    category: 'pattern',
                    categoryName: 'Ìå®ÌÑ¥ Ïù∏Ïãù',
                    difficulty: 1,
                    question: 'Îã§Ïùå 3x3 ÌñâÎ†¨ÏóêÏÑú Îπà Ïπ∏Ïóê Îì§Ïñ¥Í∞à ÎèÑÌòïÏùÑ Í≥†Î•¥ÏÑ∏Ïöî.',
                    matrix: ['‚óè', '‚óè‚óè', '‚óè‚óè‚óè', '‚ñ†', '‚ñ†‚ñ†', '‚ñ†‚ñ†‚ñ†', '‚ñ≤', '‚ñ≤‚ñ≤', '?'],
                    options: ['‚ñ≤', '‚ñ≤‚ñ≤‚ñ≤', '‚ñ†‚ñ†‚ñ†', '‚óè‚óè‚óè'],
                    correct: 1,
                    explanation: 'Í∞Å ÌñâÏóêÏÑú ÎèÑÌòïÏùò Í∞úÏàòÍ∞Ä 1, 2, 3ÏúºÎ°ú Ï¶ùÍ∞ÄÌï©ÎãàÎã§.'
                },
                {
                    id: 'p2',
                    category: 'pattern',
                    categoryName: 'Ìå®ÌÑ¥ Ïù∏Ïãù',
                    difficulty: 2,
                    question: 'Í∑úÏπôÏùÑ Ï∞æÏïÑ Îπà Ïπ∏Ïóê Îì§Ïñ¥Í∞à Í≤ÉÏùÑ Í≥†Î•¥ÏÑ∏Ïöî.',
                    matrix: ['1', '2', '3', '2', '4', '6', '3', '6', '?'],
                    options: ['7', '8', '9', '12'],
                    correct: 2,
                    explanation: 'Í∞Å ÌñâÏùò ÏÑ∏ Î≤àÏß∏ Ïà´ÏûêÎäî Ï≤´ Î≤àÏß∏ÏôÄ Îëê Î≤àÏß∏Ïùò Ìï©ÏûÖÎãàÎã§. 3+6=9'
                },
                {
                    id: 'p3',
                    category: 'pattern',
                    categoryName: 'Ìå®ÌÑ¥ Ïù∏Ïãù',
                    difficulty: 2,
                    question: 'Ìå®ÌÑ¥ÏùÑ Î∂ÑÏÑùÌïòÏó¨ Îπà Ïπ∏ÏùÑ Ï±ÑÏö∞ÏÑ∏Ïöî.',
                    matrix: ['‚óã', '‚óê', '‚óè', '‚ñ°', '‚óß', '‚ñ†', '‚ñ≥', '‚ó≠', '?'],
                    options: ['‚ñ≥', '‚ñ≤', '‚ó≠', '‚óã'],
                    correct: 1,
                    explanation: 'Í∞Å ÌñâÏóêÏÑú ÎèÑÌòïÏù¥ Ï†êÏ†ê Ï±ÑÏõåÏßëÎãàÎã§ (Îπà Í≤É ‚Üí Î∞òÏØ§ ‚Üí Í∞ÄÎìù).'
                },
                {
                    id: 'p4',
                    category: 'pattern',
                    categoryName: 'Ìå®ÌÑ¥ Ïù∏Ïãù',
                    difficulty: 3,
                    question: 'Í∑úÏπôÏùÑ Ï∞æÏïÑ ? Ïóê Îì§Ïñ¥Í∞à Í∞íÏùÑ Í≥†Î•¥ÏÑ∏Ïöî.',
                    matrix: ['2', '4', '8', '3', '9', '27', '4', '16', '?'],
                    options: ['32', '48', '64', '256'],
                    correct: 2,
                    explanation: 'Í∞Å ÌñâÏùÄ n, n¬≤, n¬≥ Ìå®ÌÑ¥ÏûÖÎãàÎã§. 4¬≥ = 64'
                },
                {
                    id: 'p5',
                    category: 'pattern',
                    categoryName: 'Ìå®ÌÑ¥ Ïù∏Ïãù',
                    difficulty: 3,
                    question: 'ÌñâÎ†¨Ïùò Í∑úÏπôÏùÑ Ï∞æÏïÑ Îπà Ïπ∏ÏùÑ ÏôÑÏÑ±ÌïòÏÑ∏Ïöî.',
                    matrix: ['A1', 'B2', 'C3', 'D4', 'E5', 'F6', 'G7', 'H8', '?'],
                    options: ['I9', 'J9', 'I10', 'J10'],
                    correct: 0,
                    explanation: 'ÏïåÌååÎ≤≥Í≥º Ïà´ÏûêÍ∞Ä ÏàúÏÑúÎåÄÎ°ú Ï¶ùÍ∞ÄÌï©ÎãàÎã§.'
                }
            ],

            // ÏàòÏó¥ Ï∂îÎ°† Î¨∏Ï†ú
            numerical: [
                {
                    id: 'n1',
                    category: 'numerical',
                    categoryName: 'ÏàòÏó¥ Ï∂îÎ°†',
                    difficulty: 1,
                    question: 'Îã§Ïùå ÏàòÏó¥Ïùò Í∑úÏπôÏùÑ Ï∞æÏïÑ ? Ïóê Îì§Ïñ¥Í∞à Ïà´ÏûêÎ•º Í≥†Î•¥ÏÑ∏Ïöî.',
                    sequence: [2, 4, 6, 8, '?'],
                    options: ['9', '10', '11', '12'],
                    correct: 1,
                    explanation: '2Ïî© Ï¶ùÍ∞ÄÌïòÎäî Îì±Ï∞®ÏàòÏó¥ÏûÖÎãàÎã§.'
                },
                {
                    id: 'n2',
                    category: 'numerical',
                    categoryName: 'ÏàòÏó¥ Ï∂îÎ°†',
                    difficulty: 2,
                    question: 'Í∑úÏπôÏùÑ Ï∞æÏïÑ Îπà Ïπ∏Ïóê Îì§Ïñ¥Í∞à Ïà´ÏûêÎ•º Í≥†Î•¥ÏÑ∏Ïöî.',
                    sequence: [1, 1, 2, 3, 5, 8, '?'],
                    options: ['11', '12', '13', '14'],
                    correct: 2,
                    explanation: 'ÌîºÎ≥¥ÎÇòÏπò ÏàòÏó¥ÏûÖÎãàÎã§. ÏïûÏùò Îëê ÏàòÎ•º ÎçîÌïòÎ©¥ Îã§Ïùå ÏàòÍ∞Ä Îê©ÎãàÎã§.'
                },
                {
                    id: 'n3',
                    category: 'numerical',
                    categoryName: 'ÏàòÏó¥ Ï∂îÎ°†',
                    difficulty: 2,
                    question: 'ÏàòÏó¥Ïùò Îã§Ïùå Ìï≠ÏùÑ Íµ¨ÌïòÏÑ∏Ïöî.',
                    sequence: [3, 6, 12, 24, '?'],
                    options: ['36', '48', '30', '42'],
                    correct: 1,
                    explanation: 'Í∞Å Ìï≠Ïù¥ 2Î∞∞Ïî© Ï¶ùÍ∞ÄÌïòÎäî Îì±ÎπÑÏàòÏó¥ÏûÖÎãàÎã§.'
                },
                {
                    id: 'n4',
                    category: 'numerical',
                    categoryName: 'ÏàòÏó¥ Ï∂îÎ°†',
                    difficulty: 3,
                    question: 'Í∑úÏπôÏùÑ Ï∞æÏïÑ ? Ïóê Îì§Ïñ¥Í∞à Ïà´ÏûêÎ•º Í≥†Î•¥ÏÑ∏Ïöî.',
                    sequence: [1, 4, 9, 16, 25, '?'],
                    options: ['30', '35', '36', '49'],
                    correct: 2,
                    explanation: 'ÏûêÏó∞ÏàòÏùò Ï†úÍ≥±ÏàòÏó¥ÏûÖÎãàÎã§. (1¬≤, 2¬≤, 3¬≤, 4¬≤, 5¬≤, 6¬≤)'
                },
                {
                    id: 'n5',
                    category: 'numerical',
                    categoryName: 'ÏàòÏó¥ Ï∂îÎ°†',
                    difficulty: 3,
                    question: 'Î≥µÏû°Ìïú ÏàòÏó¥Ïùò Îã§Ïùå Ìï≠ÏùÑ Íµ¨ÌïòÏÑ∏Ïöî.',
                    sequence: [2, 6, 12, 20, 30, '?'],
                    options: ['40', '42', '44', '46'],
                    correct: 1,
                    explanation: 'Ï∞®Ïù¥Í∞Ä 4, 6, 8, 10, 12Î°ú Ï¶ùÍ∞ÄÌï©ÎãàÎã§. (n√ó(n+1) Ìå®ÌÑ¥)'
                }
            ],

            // Í≥µÍ∞Ñ Ï∂îÎ°† Î¨∏Ï†ú
            spatial: [
                {
                    id: 's1',
                    category: 'spatial',
                    categoryName: 'Í≥µÍ∞Ñ Ï∂îÎ°†',
                    difficulty: 1,
                    question: 'ÎèÑÌòïÏùÑ ÏãúÍ≥ÑÎ∞©Ìñ•ÏúºÎ°ú 90¬∞ ÌöåÏ†ÑÌïòÎ©¥ Ïñ¥Îñ§ Î™®ÏñëÏù¥ Îê†ÍπåÏöî?',
                    shapeType: 'rotation',
                    shape: 'LÏûê Î™®Ïñë (‚îò)',
                    options: ['‚îê', '‚îå', '‚îî', '‚îÄ'],
                    correct: 2,
                    explanation: 'ÏãúÍ≥ÑÎ∞©Ìñ• 90¬∞ ÌöåÏ†Ñ Ïãú ‚îò ‚Üí ‚îî'
                },
                {
                    id: 's2',
                    category: 'spatial',
                    categoryName: 'Í≥µÍ∞Ñ Ï∂îÎ°†',
                    difficulty: 2,
                    question: 'Ï†ÑÍ∞úÎèÑÎ•º Ï†ëÏóàÏùÑ Îïå ÎßåÎì§Ïñ¥ÏßÄÎäî Ï†ïÏú°Î©¥Ï≤¥ÏóêÏÑú 1Ïùò ÎßûÏùÄÌé∏ Î©¥Ïùò Ïà´ÏûêÎäî?',
                    shapeType: 'cube',
                    cubeNet: 'Ïã≠ÏûêÌòï Ï†ÑÍ∞úÎèÑ: ÏÉÅ(2) / Ï¢å(3)-Ï§ë(1)-Ïö∞(4) / Ìïò(5) / Îß®ÏïÑÎûò(6)',
                    options: ['2', '4', '5', '6'],
                    correct: 3,
                    explanation: 'Ïã≠ÏûêÌòï Ï†ÑÍ∞úÎèÑÏóêÏÑú 1Ïùò ÎßûÏùÄÌé∏ÏùÄ 6ÏûÖÎãàÎã§.'
                },
                {
                    id: 's3',
                    category: 'spatial',
                    categoryName: 'Í≥µÍ∞Ñ Ï∂îÎ°†',
                    difficulty: 2,
                    question: 'Í±∞Ïö∏Ïóê ÎπÑÏπú Í∏ÄÏûê "B"Îäî Ïñ¥ÎñªÍ≤å Î≥¥ÏùºÍπåÏöî?',
                    shapeType: 'mirror',
                    options: ['B', '·ó∫', 'd', 'q'],
                    correct: 1,
                    explanation: 'Í±∞Ïö∏Ïóê ÎπÑÏπòÎ©¥ Ï¢åÏö∞Í∞Ä Î∞òÏ†ÑÎê©ÎãàÎã§.'
                },
                {
                    id: 's4',
                    category: 'spatial',
                    categoryName: 'Í≥µÍ∞Ñ Ï∂îÎ°†',
                    difficulty: 3,
                    question: 'Ï£ºÏñ¥ÏßÑ Ï°∞Í∞ÅÎì§ÏùÑ Ï°∞Ìï©ÌïòÎ©¥ Ïñ¥Îñ§ ÎèÑÌòïÏù¥ ÏôÑÏÑ±Îê†ÍπåÏöî? Ï°∞Í∞Å: ÏßÅÍ∞ÅÏÇºÍ∞ÅÌòï 2Í∞ú, Ï†ïÏÇ¨Í∞ÅÌòï 1Í∞ú',
                    shapeType: 'assembly',
                    options: ['Ï†ïÏÇ¨Í∞ÅÌòï', 'ÏßÅÏÇ¨Í∞ÅÌòï', 'ÌèâÌñâÏÇ¨Î≥ÄÌòï', 'ÎßàÎ¶ÑÎ™®'],
                    correct: 1,
                    explanation: 'ÏßÅÍ∞ÅÏÇºÍ∞ÅÌòï 2Í∞úÏôÄ Ï†ïÏÇ¨Í∞ÅÌòï 1Í∞úÎ•º Ï†ÅÏ†àÌûà Î∞∞ÏπòÌïòÎ©¥ ÏßÅÏÇ¨Í∞ÅÌòïÏù¥ Îê©ÎãàÎã§.'
                },
                {
                    id: 's5',
                    category: 'spatial',
                    categoryName: 'Í≥µÍ∞Ñ Ï∂îÎ°†',
                    difficulty: 3,
                    question: 'Ï†ïÏú°Î©¥Ï≤¥Î•º ÎåÄÍ∞ÅÏÑ†ÏúºÎ°ú ÏûêÎ•¥Î©¥ Îã®Î©¥ÏùÄ Ïñ¥Îñ§ Î™®ÏñëÏùºÍπåÏöî?',
                    shapeType: 'cross-section',
                    options: ['Ï†ïÏÇ¨Í∞ÅÌòï', 'ÏßÅÏÇ¨Í∞ÅÌòï', 'Ï†ïÏÇºÍ∞ÅÌòï', 'Ï†ïÏú°Í∞ÅÌòï'],
                    correct: 1,
                    explanation: 'Ï†ïÏú°Î©¥Ï≤¥Î•º ÎåÄÍ∞ÅÏÑ†ÏúºÎ°ú ÏûêÎ•¥Î©¥ ÏßÅÏÇ¨Í∞ÅÌòï Îã®Î©¥Ïù¥ ÏÉùÍπÅÎãàÎã§.'
                }
            ],

            // ÎÖºÎ¶¨ Ï∂îÎ°† Î¨∏Ï†ú
            logical: [
                {
                    id: 'l1',
                    category: 'logical',
                    categoryName: 'ÎÖºÎ¶¨ Ï∂îÎ°†',
                    difficulty: 1,
                    question: 'Î™®Îì† ÏÉàÎäî ÎÇ†Í∞úÍ∞Ä ÏûàÎã§. Ï∞∏ÏÉàÎäî ÏÉàÎã§. Îã§Ïùå Ï§ë Î∞òÎìúÏãú Ï∞∏Ïù∏ Í≤ÉÏùÄ?',
                    options: [
                        'Î™®Îì† ÎÇ†Í∞úÍ∞Ä ÏûàÎäî Í≤ÉÏùÄ ÏÉàÎã§',
                        'Ï∞∏ÏÉàÎäî ÎÇ†Í∞úÍ∞Ä ÏûàÎã§',
                        'ÎÇ†Í∞úÍ∞Ä ÏóÜÏúºÎ©¥ Ï∞∏ÏÉàÍ∞Ä ÏïÑÎãàÎã§',
                        'Î™®Îì† ÏÉàÎäî Ï∞∏ÏÉàÎã§'
                    ],
                    correct: 1,
                    explanation: 'ÏÇºÎã®ÎÖºÎ≤ïÏóê ÏùòÌï¥ Ï∞∏ÏÉàÎäî ÏÉàÏù¥ÎØÄÎ°ú ÎÇ†Í∞úÍ∞Ä ÏûàÏäµÎãàÎã§.'
                },
                {
                    id: 'l2',
                    category: 'logical',
                    categoryName: 'ÎÖºÎ¶¨ Ï∂îÎ°†',
                    difficulty: 2,
                    question: 'A > B, B > C, D > A Ïùº Îïå, Í∞ÄÏû• ÌÅ∞ Í≤ÉÏùÄ?',
                    options: ['A', 'B', 'C', 'D'],
                    correct: 3,
                    explanation: 'D > A > B > C ÏàúÏÑúÏù¥ÎØÄÎ°ú DÍ∞Ä Í∞ÄÏû• ÌÅΩÎãàÎã§.'
                },
                {
                    id: 'l3',
                    category: 'logical',
                    categoryName: 'ÎÖºÎ¶¨ Ï∂îÎ°†',
                    difficulty: 2,
                    question: '"ÎπÑÍ∞Ä Ïò§Î©¥ ÎïÖÏù¥ Ï†ñÎäîÎã§"Ïùò ÎåÄÏö∞ Î™ÖÏ†úÎäî?',
                    options: [
                        'ÎïÖÏù¥ Ï†ñÏúºÎ©¥ ÎπÑÍ∞Ä Ïò®Îã§',
                        'ÎπÑÍ∞Ä Ïò§ÏßÄ ÏïäÏúºÎ©¥ ÎïÖÏù¥ Ï†ñÏßÄ ÏïäÎäîÎã§',
                        'ÎïÖÏù¥ Ï†ñÏßÄ ÏïäÏúºÎ©¥ ÎπÑÍ∞Ä Ïò§ÏßÄ ÏïäÎäîÎã§',
                        'ÎïÖÏù¥ Ï†ñÏñ¥ÎèÑ ÎπÑÍ∞Ä Ïò§ÏßÄ ÏïäÏùÑ Ïàò ÏûàÎã§'
                    ],
                    correct: 2,
                    explanation: 'ÎåÄÏö∞ Î™ÖÏ†úÎäî ÏõêÎûò Î™ÖÏ†úÏùò Í≤∞Î°†ÏùÑ Î∂ÄÏ†ïÌïòÍ≥† Í∞ÄÏ†ïÏùÑ Î∂ÄÏ†ïÌïú Í≤ÉÏûÖÎãàÎã§.'
                },
                {
                    id: 'l4',
                    category: 'logical',
                    categoryName: 'ÎÖºÎ¶¨ Ï∂îÎ°†',
                    difficulty: 3,
                    question: '5Î™ÖÏù¥ ÏõêÌòï ÌÖåÏù¥Î∏îÏóê ÏïâÏäµÎãàÎã§. AÎäî B Î∞îÎ°ú ÏòÜ, CÎäî DÏùò ÎßûÏùÄÌé∏. AÏôÄ C ÏÇ¨Ïù¥ÏóêÎäî 1Î™ÖÏù¥ ÏûàÏäµÎãàÎã§. EÎäî ÎàÑÍµ¨ ÏòÜÏóê ÏïâÏïÑÏûàÏùÑÍπåÏöî?',
                    options: [
                        'AÏôÄ C ÏòÜ',
                        'BÏôÄ D ÏòÜ',
                        'AÏôÄ D ÏòÜ',
                        'BÏôÄ C ÏòÜ'
                    ],
                    correct: 1,
                    explanation: 'Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÎäî Î∞∞ÏπòÏóêÏÑú EÎäî BÏôÄ D ÏòÜÏóê ÏïâÏäµÎãàÎã§.'
                },
                {
                    id: 'l5',
                    category: 'logical',
                    categoryName: 'ÎÖºÎ¶¨ Ï∂îÎ°†',
                    difficulty: 3,
                    question: 'Ïñ¥Îñ§ ÏàòÏóê 3ÏùÑ Í≥±Ìïú ÌõÑ 7ÏùÑ ÎπºÎ©¥ 20Ïù¥ Îê©ÎãàÎã§. ÏõêÎûò ÏàòÎäî?',
                    options: ['7', '8', '9', '10'],
                    correct: 2,
                    explanation: '(x √ó 3) - 7 = 20 ‚Üí 3x = 27 ‚Üí x = 9'
                }
            ],

            // Ïñ∏Ïñ¥ Ïú†Ï∂î Î¨∏Ï†ú
            verbal: [
                {
                    id: 'v1',
                    category: 'verbal',
                    categoryName: 'Ïñ∏Ïñ¥ Ïú†Ï∂î',
                    difficulty: 1,
                    question: 'Ï±Ö : ÎèÖÏÑú = ÏùåÏïÖ : ?',
                    analogy: ['Ï±Ö', 'ÎèÖÏÑú', 'ÏùåÏïÖ', '?'],
                    options: ['ÏïÖÍ∏∞', 'Ï≤≠Ï∑®', 'Í∞ÄÏàò', 'ÏΩòÏÑúÌä∏'],
                    correct: 1,
                    explanation: 'Ï±ÖÏùÑ ÌïòÎäî ÌñâÏúÑÍ∞Ä ÎèÖÏÑúÏù¥ÎìØ, ÏùåÏïÖÏùÑ ÌïòÎäî ÌñâÏúÑÎäî Ï≤≠Ï∑®ÏûÖÎãàÎã§.'
                },
                {
                    id: 'v2',
                    category: 'verbal',
                    categoryName: 'Ïñ∏Ïñ¥ Ïú†Ï∂î',
                    difficulty: 2,
                    question: 'ÏùòÏÇ¨ : Î≥ëÏõê = ÍµêÏÇ¨ : ?',
                    analogy: ['ÏùòÏÇ¨', 'Î≥ëÏõê', 'ÍµêÏÇ¨', '?'],
                    options: ['ÌïôÏÉù', 'ÌïôÍµê', 'ÍµêÏã§', 'ÍµêÏú°'],
                    correct: 1,
                    explanation: 'ÏùòÏÇ¨Í∞Ä ÏùºÌïòÎäî Í≥≥Ïù¥ Î≥ëÏõêÏù¥ÎìØ, ÍµêÏÇ¨Í∞Ä ÏùºÌïòÎäî Í≥≥ÏùÄ ÌïôÍµêÏûÖÎãàÎã§.'
                },
                {
                    id: 'v3',
                    category: 'verbal',
                    categoryName: 'Ïñ∏Ïñ¥ Ïú†Ï∂î',
                    difficulty: 2,
                    question: 'ÏÜê : Ïû•Í∞ë = Î∞ú : ?',
                    analogy: ['ÏÜê', 'Ïû•Í∞ë', 'Î∞ú', '?'],
                    options: ['Îã§Î¶¨', 'ÏñëÎßê', 'Ïã†Î∞ú', 'Í±∑Í∏∞'],
                    correct: 1,
                    explanation: 'ÏÜêÏóê ÎÅºÎäî Í≤ÉÏù¥ Ïû•Í∞ëÏù¥ÎìØ, Î∞úÏóê Ïã†Îäî Í≤ÉÏùÄ ÏñëÎßêÏûÖÎãàÎã§.'
                },
                {
                    id: 'v4',
                    category: 'verbal',
                    categoryName: 'Ïñ∏Ïñ¥ Ïú†Ï∂î',
                    difficulty: 3,
                    question: 'Îπõ : Ïñ¥Îë† = ÏßÄÏãù : ?',
                    analogy: ['Îπõ', 'Ïñ¥Îë†', 'ÏßÄÏãù', '?'],
                    options: ['ÌïôÍµê', 'Î¨¥ÏßÄ', 'Ï±Ö', 'Í≥µÎ∂Ä'],
                    correct: 1,
                    explanation: 'ÎπõÏùò Î∞òÎåÄÍ∞Ä Ïñ¥Îë†Ïù¥ÎìØ, ÏßÄÏãùÏùò Î∞òÎåÄÎäî Î¨¥ÏßÄÏûÖÎãàÎã§.'
                },
                {
                    id: 'v5',
                    category: 'verbal',
                    categoryName: 'Ïñ∏Ïñ¥ Ïú†Ï∂î',
                    difficulty: 3,
                    question: 'Ïî®Ïïó : ÎÇòÎ¨¥ = Ïú†Ï∂© : ?',
                    analogy: ['Ïî®Ïïó', 'ÎÇòÎ¨¥', 'Ïú†Ï∂©', '?'],
                    options: ['Ïïå', 'ÎÇòÎπÑ', 'Î≤åÎ†à', 'ÍΩÉ'],
                    correct: 1,
                    explanation: 'Ïî®ÏïóÏù¥ ÏûêÎùºÎ©¥ ÎÇòÎ¨¥Í∞Ä ÎêòÎìØ, Ïú†Ï∂©Ïù¥ ÏûêÎùºÎ©¥ ÎÇòÎπÑÍ∞Ä Îê©ÎãàÎã§.'
                }
            ]
        };

        // ============================================
        // ÌÖåÏä§Ìä∏ ÏÉÅÌÉú Í¥ÄÎ¶¨
        // ============================================

        let currentQuestionIndex = 0;
        let allQuestions = [];
        let answers = [];
        let timer = null;
        let timeLeft = 60;
        let startTime = null;
        let responseTimes = [];

        // ============================================
        // ÌÖåÏä§Ìä∏ Ï¥àÍ∏∞Ìôî Î∞è ÏãúÏûë
        // ============================================

        function startTest() {
            // Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ÏóêÏÑú Î¨∏Ï†ú ÏàòÏßë Î∞è ÏÑûÍ∏∞
            allQuestions = [
                ...shuffleArray(questions.pattern),
                ...shuffleArray(questions.numerical),
                ...shuffleArray(questions.spatial),
                ...shuffleArray(questions.logical),
                ...shuffleArray(questions.verbal)
            ];

            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú ÏÑûÏù¥ÎèÑÎ°ù Ï†ÑÏ≤¥ Ïû¨Î∞∞Ïó¥
            allQuestions = shuffleArray(allQuestions);

            // ÎãµÎ≥Ä Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
            answers = new Array(allQuestions.length).fill(null);
            responseTimes = new Array(allQuestions.length).fill(null);

            document.getElementById('intro').style.display = 'none';
            document.getElementById('test').style.display = 'block';

            loadQuestion(0);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // ============================================
        // Î¨∏Ï†ú Î°úÎìú Î∞è ÌëúÏãú
        // ============================================

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const q = allQuestions[index];

            // ÏßÑÌñâ ÏÉÅÌô© ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('progress').style.width = `${((index + 1) / allQuestions.length) * 100}%`;
            document.getElementById('questionNum').textContent = `Î¨∏Ï†ú ${index + 1}/${allQuestions.length}`;
            document.getElementById('categoryBadge').textContent = q.categoryName;

            // ÎÇúÏù¥ÎèÑ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            const difficultyBadge = document.getElementById('difficultyBadge');
            const difficultyText = q.difficulty === 1 ? 'Ïâ¨ÏõÄ' : q.difficulty === 2 ? 'Î≥¥ÌÜµ' : 'Ïñ¥Î†§ÏõÄ';
            const difficultyClass = q.difficulty === 1 ? 'difficulty-easy' : q.difficulty === 2 ? 'difficulty-medium' : 'difficulty-hard';
            difficultyBadge.textContent = difficultyText;
            difficultyBadge.className = `difficulty-badge ${difficultyClass}`;

            // Î¨∏Ï†ú ÎÇ¥Ïö© Î†åÎçîÎßÅ
            const contentDiv = document.getElementById('questionContent');
            contentDiv.innerHTML = renderQuestionContent(q);

            // ÏÑ†ÌÉùÏßÄ Î†åÎçîÎßÅ
            const optionsDiv = document.getElementById('optionsGrid');
            optionsDiv.innerHTML = q.options.map((opt, i) => `
                <div class="option" onclick="selectOption(${i})" data-index="${i}">
                    <span class="option-label">${opt}</span>
                </div>
            `).join('');

            // Ïù¥Ï†Ñ ÎãµÎ≥ÄÏù¥ ÏûàÏúºÎ©¥ ÌëúÏãú
            if (answers[index] !== null) {
                const selectedOption = optionsDiv.querySelector(`[data-index="${answers[index]}"]`);
                if (selectedOption) selectedOption.classList.add('selected');
                document.getElementById('nextBtn').disabled = false;
            } else {
                document.getElementById('nextBtn').disabled = true;
            }

            // ÌÉÄÏù¥Î®∏ ÏãúÏûë
            startTimer();
            startTime = Date.now();
        }

        function renderQuestionContent(q) {
            let html = `<p class="question-text">${q.question}</p>`;

            if (q.matrix) {
                html += '<div class="matrix-grid">';
                q.matrix.forEach((cell, i) => {
                    const isEmpty = cell === '?';
                    html += `<div class="matrix-cell ${isEmpty ? 'empty' : ''}">${isEmpty ? '?' : cell}</div>`;
                });
                html += '</div>';
            }

            if (q.sequence) {
                html += '<div class="sequence-display">';
                q.sequence.forEach(item => {
                    const isUnknown = item === '?';
                    html += `<div class="sequence-item ${isUnknown ? 'unknown' : ''}">${item}</div>`;
                });
                html += '</div>';
            }

            if (q.analogy) {
                html += '<div class="analogy-display">';
                html += `<span class="analogy-item">${q.analogy[0]}</span>`;
                html += `<span class="analogy-separator">:</span>`;
                html += `<span class="analogy-item">${q.analogy[1]}</span>`;
                html += `<span class="analogy-separator">=</span>`;
                html += `<span class="analogy-item">${q.analogy[2]}</span>`;
                html += `<span class="analogy-separator">:</span>`;
                html += `<span class="analogy-item unknown">?</span>`;
                html += '</div>';
            }

            if (q.shapeType === 'cube' && q.cubeNet) {
                html += `<div style="text-align: center; margin: 20px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <p style="color: #8892b0;">${q.cubeNet}</p>
                </div>`;
            }

            if (q.shapeType === 'rotation' && q.shape) {
                html += `<div style="text-align: center; margin: 20px 0; font-size: 3rem;">${q.shape}</div>`;
            }

            return html;
        }

        // ============================================
        // ÌÉÄÏù¥Î®∏ Í¥ÄÎ¶¨
        // ============================================

        function startTimer() {
            clearInterval(timer);
            timeLeft = 60;
            updateTimerDisplay();

            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    autoNext();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = `${timeLeft}Ï¥à`;
            timerEl.style.color = timeLeft <= 10 ? '#ff6b6b' : '#333333';
        }

        // ============================================
        // ÎãµÎ≥Ä ÏÑ†ÌÉù Î∞è ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        // ============================================

        function selectOption(index) {
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));

            // ÏÉà ÏÑ†ÌÉù
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            answers[currentQuestionIndex] = index;
            responseTimes[currentQuestionIndex] = Date.now() - startTime;

            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            clearInterval(timer);

            if (currentQuestionIndex < allQuestions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            } else {
                showResults();
            }
        }

        function skipQuestion() {
            clearInterval(timer);
            responseTimes[currentQuestionIndex] = 60000; // ÏµúÎåÄ ÏãúÍ∞Ñ

            if (currentQuestionIndex < allQuestions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            } else {
                showResults();
            }
        }

        function autoNext() {
            responseTimes[currentQuestionIndex] = 60000;

            if (currentQuestionIndex < allQuestions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            } else {
                showResults();
            }
        }

        // ============================================
        // Í≤∞Í≥º Í≥ÑÏÇ∞ Î∞è ÌëúÏãú
        // ============================================

        function calculateResults() {
            const categoryScores = {
                pattern: { correct: 0, total: 0 },
                numerical: { correct: 0, total: 0 },
                spatial: { correct: 0, total: 0 },
                logical: { correct: 0, total: 0 },
                verbal: { correct: 0, total: 0 }
            };

            let totalCorrect = 0;
            let totalDifficulty = 0;
            let weightedScore = 0;

            allQuestions.forEach((q, i) => {
                categoryScores[q.category].total++;

                if (answers[i] === q.correct) {
                    categoryScores[q.category].correct++;
                    totalCorrect++;

                    // ÎÇúÏù¥ÎèÑ Í∞ÄÏ§ëÏπò Ï†ÅÏö© (Ïñ¥Î†§Ïö¥ Î¨∏Ï†úÏùºÏàòÎ°ù ÎÜíÏùÄ Ï†êÏàò)
                    const difficultyWeight = q.difficulty;

                    // ÏùëÎãµ ÏãúÍ∞Ñ Î≥¥ÎÑàÏä§ (Îπ†Î•ºÏàòÎ°ù ÎÜíÏùÄ Ï†êÏàò)
                    const timeBonus = Math.max(0, 1 - (responseTimes[i] / 60000)) * 0.2;

                    weightedScore += difficultyWeight * (1 + timeBonus);
                    totalDifficulty += difficultyWeight;
                } else {
                    totalDifficulty += q.difficulty;
                }
            });

            // IQ Ï†êÏàò Í≥ÑÏÇ∞ (ÌëúÏ§ÄÌôî)
            // ÏõêÏ†êÏàò ÎπÑÏú®ÏùÑ Ï†ïÍ∑úÎ∂ÑÌè¨Î°ú Î≥ÄÌôò
            const rawPercentage = weightedScore / totalDifficulty;

            // ÌëúÏ§Ä IQ Ï≤ôÎèÑÎ°ú Î≥ÄÌôò (ÌèâÍ∑† 100, ÌëúÏ§ÄÌé∏Ï∞® 15)
            // z-score Î≥ÄÌôò ÌõÑ IQ Ï≤ôÎèÑ Ï†ÅÏö©
            const zScore = (rawPercentage - 0.5) * 4; // -2 ~ +2 Î≤îÏúÑ
            const iqScore = Math.round(100 + (zScore * 15));

            // IQ Î≤îÏúÑ Ï†úÌïú (55 ~ 145)
            const finalIQ = Math.max(55, Math.min(145, iqScore));

            return {
                iq: finalIQ,
                categoryScores,
                totalCorrect,
                totalQuestions: allQuestions.length
            };
        }

        function getIQClassification(iq) {
            if (iq >= 130) return { label: 'Îß§Ïö∞ Ïö∞Ïàò (Very Superior)', desc: 'ÏÉÅÏúÑ 2% Ïù¥ÎÇ¥Ïùò Îõ∞Ïñ¥ÎÇú Ïù∏ÏßÄÎä•Î†•ÏùÑ Î≥¥Ïú†ÌïòÍ≥† ÏûàÏäµÎãàÎã§.', percentile: 98 };
            if (iq >= 120) return { label: 'Ïö∞Ïàò (Superior)', desc: 'ÏÉÅÏúÑ 10% Ïù¥ÎÇ¥Ïùò Ïö∞ÏàòÌïú Ïù∏ÏßÄÎä•Î†•ÏûÖÎãàÎã§.', percentile: 91 };
            if (iq >= 110) return { label: 'ÌèâÍ∑† ÏÉÅ (High Average)', desc: 'ÌèâÍ∑† Ïù¥ÏÉÅÏùò Ï¢ãÏùÄ Ïù∏ÏßÄÎä•Î†•ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏäµÎãàÎã§.', percentile: 75 };
            if (iq >= 90) return { label: 'ÌèâÍ∑† (Average)', desc: 'ÏùºÎ∞òÏ†ÅÏù∏ ÏàòÏ§ÄÏùò Ïù∏ÏßÄÎä•Î†•ÏûÖÎãàÎã§.', percentile: 50 };
            if (iq >= 80) return { label: 'ÌèâÍ∑† Ìïò (Low Average)', desc: 'ÌèâÍ∑†Î≥¥Îã§ ÏïΩÍ∞Ñ ÎÇÆÏùÄ ÏàòÏ§ÄÏûÖÎãàÎã§.', percentile: 25 };
            if (iq >= 70) return { label: 'Í≤ΩÍ≥ÑÏÑ† (Borderline)', desc: 'Í≤ΩÍ≥ÑÏÑ† ÏàòÏ§ÄÏùò Ïù∏ÏßÄÎä•Î†•ÏûÖÎãàÎã§.', percentile: 9 };
            return { label: 'Î∞úÎã¨ ÏßÄÏó∞ Í∞ÄÎä•ÏÑ±', desc: 'Ï†ÑÎ¨∏Í∞Ä ÏÉÅÎã¥ÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.', percentile: 2 };
        }

        function showResults() {
            document.getElementById('test').style.display = 'none';
            document.getElementById('results').style.display = 'block';

            const results = calculateResults();
            const classification = getIQClassification(results.iq);

            // IQ Ï†êÏàò ÌëúÏãú
            document.getElementById('iqScore').textContent = results.iq;
            document.getElementById('classLabel').textContent = classification.label;
            document.getElementById('classDesc').textContent = classification.desc;
            document.getElementById('percentile').textContent = `ÏÉÅÏúÑ ${100 - classification.percentile}% (Î∞±Î∂ÑÏúÑ ${classification.percentile})`;

            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ï†êÏàò ÌëúÏãú
            setTimeout(() => {
                const categories = ['pattern', 'numerical', 'spatial', 'logical', 'verbal'];
                categories.forEach(cat => {
                    const score = results.categoryScores[cat];
                    const percentage = (score.correct / score.total) * 100;

                    document.getElementById(`${cat}Bar`).style.width = `${percentage}%`;
                    document.getElementById(`${cat}Score`).textContent = `${score.correct}/${score.total} (${Math.round(percentage)}%)`;
                });
            }, 100);
        }

        // Brain Animation Script
        const canvas = document.getElementById('brainCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 2 + 1;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0 || this.x > width) this.vx *= -1;
                if (this.y < 0 || this.y > height) this.vy *= -1;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(0, 212, 255, 0.3)';
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < 50; i++) particles.push(new Particle());
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => {
                p.update();
                p.draw();
                particles.forEach(p2 => {
                    const dx = p.x - p2.x;
                    const dy = p.y - p2.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 100) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(0, 212, 255, ${0.1 - dist / 1000})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                });
            });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => { resize(); initParticles(); });
        resize();
        initParticles();
        animate();
    </script>
</body>

</html>