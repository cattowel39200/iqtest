<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQZone - IQ Assessment & High IQ Challenge</title>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Brain Animation Container -->
    <div class="brain-container">
        <canvas id="brainCanvas"></canvas>
    </div>

    <div class="container">
        <header>
            <h1>IQZone</h1>
            <p>과학적 문제 설계 기반 종합 인지능력 평가</p>
            <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">👤</span>
                    <strong id="currentUserNickname" style="color: #00d4ff;"></strong>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">📝</span>
                    <span>테스트 <strong id="userTotalTests" style="color: #7b2cbf;">0</strong>회</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">🧠</span>
                    <span>최고 IQ: <strong id="userBestIQ" style="color: #22c55e;">-</strong></span>
                </div>
                <button onclick="logout()"
                    style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">로그아웃</button>
            </div>
    </div>
    </div>

    <!-- 4가지 유형별 랭킹 테이블 (한 줄에 모두 표시) -->
    <div class="main-grid" id="mainDashboard" style="margin-bottom: 40px;">
        <h2
            style="text-align: center; margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 10px;">
            🏆 유형별 랭킹 TOP 10
            <button onclick="refreshAllTypeRankings()"
                style="background: none; border: none; cursor: pointer; font-size: 1rem; color: #00d4ff;">🔄</button>
        </h2>

        <div class="ranking-grid-container">

            <!-- 쉬움테스트 랭킹 -->
            <div class="intro-section ranking-card" style="margin-bottom: 0;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <h3 style="color: #22c55e; margin: 0; font-size: 0.95rem;">🟢 쉬움</h3>
                    <div id="myEasyRank" style="font-size: 0.75rem; color: #666; margin-top: 2px;"></div>
                </div>
                <div id="mainEasyRanking" class="main-ranking-table">
                    <!-- 쉬움테스트 랭킹이 여기에 표시됨 -->
                </div>
            </div>

            <!-- 중간테스트 랭킹 -->
            <div class="intro-section ranking-card" style="margin-bottom: 0;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <h3 style="color: #f97316; margin: 0; font-size: 0.95rem;">🟡 중간</h3>
                    <div id="myMediumRank" style="font-size: 0.75rem; color: #666; margin-top: 2px;"></div>
                </div>
                <div id="mainMediumRanking" class="main-ranking-table">
                    <!-- 중간테스트 랭킹이 여기에 표시됨 -->
                </div>
            </div>

            <!-- 고난도테스트 랭킹 -->
            <div class="intro-section ranking-card" style="margin-bottom: 0;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <h3 style="color: #ef4444; margin: 0; font-size: 0.95rem;">🔴 고난도</h3>
                    <div id="myHardRank" style="font-size: 0.75rem; color: #666; margin-top: 2px;"></div>
                </div>
                <div id="mainHardRanking" class="main-ranking-table">
                    <!-- 고난도테스트 랭킹이 여기에 표시됨 -->
                </div>
            </div>

            <!-- 종합테스트 랭킹 (마지막 배치) -->
            <div class="intro-section ranking-card" style="margin-bottom: 0;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <h3 style="color: #00d4ff; margin: 0; font-size: 0.95rem;">🧠 종합</h3>
                    <div id="myComprehensiveRank" style="font-size: 0.75rem; color: #666; margin-top: 2px;"></div>
                </div>
                <div id="mainComprehensiveRanking" class="main-ranking-table">
                    <!-- 종합테스트 랭킹이 여기에 표시됨 -->
                </div>
            </div>

        </div>
    </div>

    <!-- 시작 화면 -->
    <div class="intro-section" id="intro">
        <h2>IQ 테스트 시작</h2>
        <p>다양한 난이도의 IQ 테스트를 선택하여 인지능력을 평가해보세요. 선택 즉시 테스트가 시작됩니다.</p>

        <!-- 테스트 유형 선택 (종합테스트 마지막 배치) -->
        <div
            style="background: rgba(123, 44, 191, 0.05); border-radius: 15px; padding: 25px; margin: 25px 0; border: 1px solid rgba(123, 44, 191, 0.2);">
            <h4 style="color: #7b2cbf; margin-bottom: 20px;">🎯 테스트 유형 선택 (클릭 시 바로 시작)</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                <!-- 쉬움테스트 -->
                <div class="test-type-card" onclick="selectTestType('easy')"
                    style="border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 1.5rem;">🟢</span>
                        <h5 style="color: #22c55e; margin: 0;">쉬움테스트</h5>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin: 8px 0;">10문항 • 약 10분</p>
                    <p style="font-size: 0.85rem; color: #777;">기본적인 논리와 패턴 인식 문제</p>
                </div>

                <!-- 중간테스트 -->
                <div class="test-type-card" onclick="selectTestType('medium')"
                    style="border: 2px solid rgba(249, 115, 22, 0.3); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 1.5rem;">🟡</span>
                        <h5 style="color: #f97316; margin: 0;">중간테스트</h5>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin: 8px 0;">16문항 • 약 20분</p>
                    <p style="font-size: 0.85rem; color: #777;">중급 수준의 추론과 패턴 분석</p>
                </div>

                <!-- 고난도테스트 -->
                <div class="test-type-card" onclick="selectTestType('hard')"
                    style="border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 1.5rem;">🔴</span>
                        <h5 style="color: #ef4444; margin: 0;">고난도테스트</h5>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin: 8px 0;">24문항 • 약 40분</p>
                    <p style="font-size: 0.85rem; color: #777;">고급 논리추론과 복합 패턴 분석</p>
                </div>

                <!-- 종합테스트 (마지막 배치) -->
                <div class="test-type-card selected" onclick="selectTestType('comprehensive')"
                    style="border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 1.5rem;">🧠</span>
                        <h5 style="color: #00d4ff; margin: 0;">종합테스트</h5>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin: 8px 0;">25문항 • 약 25분</p>
                    <p style="font-size: 0.85rem; color: #777;">CHC 이론 기반 5개 인지 영역 종합 평가</p>
                </div>
            </div>
        </div>

    </div>

    <!-- 평가 방식 설명 섹션 -->
    <div class="intro-section" id="evaluationSection" style="margin-top: 20px;">
        <h2>📊 평가 방식</h2>
        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">

            <div
                style="background: rgba(16, 185, 129, 0.05); border-radius: 12px; padding: 20px; border: 1px solid rgba(16, 185, 129, 0.2);">
                <h4 style="color: #059669; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                    🧠 다차원 분석
                </h4>
                <p style="color: #555555; font-size: 0.9rem; line-height: 1.5;">
                    CHC 이론 기반 5개 영역: 유동성 추론, 결정성 지식, 수리 논리, 패턴 인식, 시공간 처리 능력을 종합 평가합니다.
                </p>
            </div>

            <div
                style="background: rgba(245, 158, 11, 0.05); border-radius: 12px; padding: 20px; border: 1px solid rgba(245, 158, 11, 0.2);">
                <h4 style="color: #d97706; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                    📈 IRT 기반 평가
                </h4>
                <p style="color: #555555; font-size: 0.9rem; line-height: 1.5;">
                    문항반응이론(IRT) 3모수 로지스틱 모형과 최우추정법(MLE)을 사용하여 과학적으로 능력을 측정합니다.
                </p>
            </div>

            <div
                style="background: rgba(139, 92, 246, 0.05); border-radius: 12px; padding: 20px; border: 1px solid rgba(139, 92, 246, 0.2);">
                <h4 style="color: #8b5cf6; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                    👶 나이별 보정
                </h4>
                <p style="color: #555555; font-size: 0.9rem; line-height: 1.5;">
                    WAIS-IV/WISC-V 국제 규준과 Flynn Effect 보정(-0.3점/년)을 적용하여 과학적으로 나이를 보정합니다.
                </p>
            </div>

            <div
                style="background: rgba(239, 68, 68, 0.05); border-radius: 12px; padding: 20px; border: 1px solid rgba(239, 68, 68, 0.2);">
                <h4 style="color: #dc2626; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                    📏 국제 척도
                </h4>
                <p style="color: #555555; font-size: 0.9rem; line-height: 1.5;">
                    국제 표준 IQ 척도(평균 100, 표준편차 15)를 기반으로 점수를 산출합니다.
                </p>
            </div>

        </div>

        <div
            style="background: rgba(0, 212, 255, 0.03); border-radius: 12px; padding: 20px; margin-top: 20px; border: 1px solid rgba(0, 212, 255, 0.15);">
            <h4 style="color: #00d4ff; margin-bottom: 12px;">📊 평가 기준</h4>
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 0.85rem;">
                <div><span style="color: #059669;">● 130+ 매우 우수</span> (상위 2%)</div>
                <div><span style="color: #d97706;">● 120-129 우수</span> (상위 10%)</div>
                <div><span style="color: #8b5cf6;">● 110-119 평균 상</span> (상위 25%)</div>
                <div><span style="color: #6b7280;">● 90-109 평균</span> (50%)</div>
            </div>
        </div>
    </div>


    <!-- 테스트 화면 -->
    <div class="test-section" id="test">
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>

        <div class="question-card">
            <div class="question-header">
                <span class="question-number" id="questionNum">문제 1/25</span>
                <div>
                    <span class="category-badge" id="categoryBadge">패턴 인식</span>
                    <span class="difficulty-badge" id="difficultyBadge">쉬움</span>
                </div>
                <span class="timer" id="timer">60초</span>
            </div>

            <div id="questionContent">
                <!-- 문제 내용이 동적으로 삽입됨 -->
            </div>

            <div class="options-grid" id="optionsGrid">
                <!-- 선택지가 동적으로 삽입됨 -->
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="skipQuestion()">건너뛰기</button>
                <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>다음 문제</button>
            </div>
        </div>
    </div>

    <!-- 결과 화면 -->
    <div class="results-section" id="results">
        <h2>테스트 완료!</h2>

        <div class="score-circle">
            <span class="score-number" id="iqScore">--</span>
            <span class="score-label">IQ 점수</span>
        </div>

        <div class="iq-classification" id="iqClass">
            <h3 id="classLabel">분류</h3>
            <p id="classDesc">설명</p>
            <p class="percentile-info" id="percentile">상위 %</p>
            <p id="measurementInfo" style="font-size: 0.8rem; color: #888; margin-top: 5px;"></p>
        </div>

        <!-- 영역별 분석은 JavaScript에서 동적으로 생성됨 -->
        <div id="categoryAnalysis" style="display: none;"></div>

        <div
            style="text-align: center; margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <button class="btn" onclick="location.reload()">다시 테스트하기</button>
            <button class="btn" onclick="showRankingPage()"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">랭킹 보기</button>
        </div>
    </div>

    <!-- 랭킹 페이지 -->
    <div class="ranking-page" id="rankingPage" style="display: none;">
        <h2>🏆 IQ 랭킹</h2>

        <!-- 랭킹 탭 메뉴 -->
        <div style="display: flex; justify-content: center; margin-bottom: 30px; gap: 10px; flex-wrap: wrap;">
            <button id="comprehensiveTab" class="ranking-tab active" onclick="showTestRanking('comprehensive')">🧠
                종합테스트</button>
            <button id="easyTab" class="ranking-tab" onclick="showTestRanking('easy')">🟢 쉬움</button>
            <button id="mediumTab" class="ranking-tab" onclick="showTestRanking('medium')">🟡 중간</button>
            <button id="hardTab" class="ranking-tab" onclick="showTestRanking('hard')">🔴 고난도</button>
        </div>

        <!-- 종합테스트 랭킹 섹션 -->
        <div id="comprehensiveRanking" class="ranking-section">
            <div class="ranking-header">
                <h3 style="color: #00d4ff; margin: 0; text-align: center; margin-bottom: 20px;">
                    🧠 종합테스트 랭킹 TOP 10
                </h3>
                <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;">
                    25문항 • 정확도 + 시간 기반 점수
                </p>
            </div>
            <div id="comprehensiveRankingList" class="ranking-list"></div>
            <div id="myComprehensiveRank" class="my-rank-section"></div>
        </div>

        <!-- 쉬움테스트 랭킹 섹션 -->
        <div id="easyRanking" class="ranking-section" style="display: none;">
            <div class="ranking-header">
                <h3 style="color: #22c55e; margin: 0; text-align: center; margin-bottom: 20px;">
                    🟢 쉬움테스트 랭킹 TOP 10
                </h3>
                <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;">
                    10문항 • 정확도 + 시간 기반 점수
                </p>
            </div>
            <div id="easyRankingList" class="ranking-list"></div>
            <div id="myEasyRank" class="my-rank-section"></div>
        </div>

        <!-- 중간테스트 랭킹 섹션 -->
        <div id="mediumRanking" class="ranking-section" style="display: none;">
            <div class="ranking-header">
                <h3 style="color: #f97316; margin: 0; text-align: center; margin-bottom: 20px;">
                    🟡 중간테스트 랭킹 TOP 10
                </h3>
                <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;">
                    16문항 • 정확도 + 시간 기반 점수
                </p>
            </div>
            <div id="mediumRankingList" class="ranking-list"></div>
            <div id="myMediumRank" class="my-rank-section"></div>
        </div>

        <!-- 고난도테스트 랭킹 섹션 -->
        <div id="hardRanking" class="ranking-section" style="display: none;">
            <div class="ranking-header">
                <h3 style="color: #ef4444; margin: 0; text-align: center; margin-bottom: 20px;">
                    🔴 고난도테스트 랭킹 TOP 10
                </h3>
                <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;">
                    24문항 • 정확도 + 시간 기반 점수
                </p>
            </div>
            <div id="hardRankingList" class="ranking-list"></div>
            <div id="myHardRank" class="my-rank-section"></div>
        </div>

        <!-- 메인으로 가기 버튼 -->
        <div style="text-align: center; margin-top: 40px;">
            <button class="btn" onclick="goBackToMain()" style="background: #6c757d; color: white;">🏠 메인으로
                돌아가기</button>
        </div>
    </div>
    </div>

    <script src="new_questions.js"></script>
    <script src="new_test_types.js"></script>
    <script src="js/app.js"></script>
</body>

</html>