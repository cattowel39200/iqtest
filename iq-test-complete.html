<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COGNIQ - IQ Assessment & Mensa Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a25;
            --bg-elevated: #222230;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-gold: #fbbf24;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-subtle: rgba(255,255,255,0.06);
            --border-medium: rgba(255,255,255,0.12);
            --glow-primary: rgba(99, 102, 241, 0.4);
            --glow-gold: rgba(251, 191, 36, 0.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Outfit', 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            opacity: 0.4;
            background: radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                        radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
        }
        .bg-pattern.mensa {
            background: radial-gradient(ellipse at 20% 20%, rgba(251, 191, 36, 0.15) 0%, transparent 50%),
                        radial-gradient(ellipse at 80% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
        }
        .container { max-width: 960px; margin: 0 auto; padding: 16px; }
        
        /* Top Bar */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 1px solid var(--border-subtle); margin-bottom: 16px;
        }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo-icon {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px;
        }
        .logo-icon.gold { background: linear-gradient(135deg, var(--accent-gold), #f59e0b); }
        .logo-text { font-size: 1.4rem; font-weight: 800; }
        .top-controls { display: flex; align-items: center; gap: 10px; }
        .lang-select {
            background: var(--bg-elevated); border: 1px solid var(--border-medium);
            border-radius: 8px; padding: 8px 12px; color: var(--text-primary);
            font-family: inherit; font-size: 0.85rem; cursor: pointer;
        }
        .lang-select:focus { outline: none; border-color: var(--accent-primary); }
        
        /* Header */
        header { text-align: center; padding: 32px 0 24px; }
        header h1 {
            font-size: 2.5rem; font-weight: 800; margin-bottom: 8px;
            background: linear-gradient(135deg, #fff, #94a3b8);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        header h1.gold {
            background: linear-gradient(135deg, var(--accent-gold), #f59e0b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        header p { color: var(--text-secondary); font-size: 1rem; }
        
        /* Cards */
        .card {
            background: var(--bg-card); border: 1px solid var(--border-subtle);
            border-radius: 20px; padding: 32px; margin-bottom: 20px;
        }
        .card-glow { box-shadow: 0 0 50px -15px var(--glow-primary); }
        .card-gold { border-color: rgba(251, 191, 36, 0.3); box-shadow: 0 0 50px -15px var(--glow-gold); }
        .section-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .section-title .icon { color: var(--accent-primary); }
        .section-title.gold .icon { color: var(--accent-gold); }
        
        /* Tutorial */
        .tutorial-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin: 20px 0; }
        .tutorial-card {
            background: var(--bg-secondary); border: 1px solid var(--border-subtle);
            border-radius: 14px; padding: 20px; transition: all 0.3s;
        }
        .tutorial-card:hover { border-color: var(--accent-primary); transform: translateY(-2px); }
        .tutorial-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .tutorial-icon {
            width: 44px; height: 44px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 22px;
        }
        .tutorial-card:nth-child(1) .tutorial-icon { background: rgba(99, 102, 241, 0.2); }
        .tutorial-card:nth-child(2) .tutorial-icon { background: rgba(139, 92, 246, 0.2); }
        .tutorial-card:nth-child(3) .tutorial-icon { background: rgba(236, 72, 153, 0.2); }
        .tutorial-card:nth-child(4) .tutorial-icon { background: rgba(16, 185, 129, 0.2); }
        .tutorial-card:nth-child(5) .tutorial-icon { background: rgba(245, 158, 11, 0.2); }
        .tutorial-title { font-weight: 700; font-size: 1rem; }
        .tutorial-desc { color: var(--text-secondary); font-size: 0.875rem; line-height: 1.5; margin-bottom: 12px; }
        .tutorial-example {
            background: var(--bg-elevated); border-radius: 8px; padding: 12px;
            font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent-primary);
        }
        
        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 14px; padding: 20px; margin: 20px 0;
        }
        .info-box.gold {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            border-color: rgba(251, 191, 36, 0.3);
        }
        .info-row { display: flex; gap: 24px; flex-wrap: wrap; }
        .info-item { display: flex; align-items: center; gap: 8px; }
        .info-item .label { color: var(--text-muted); font-size: 0.8rem; }
        .info-item .value { font-weight: 600; font-family: 'JetBrains Mono', monospace; }
        
        /* Instructions */
        .instructions { background: var(--bg-secondary); border-radius: 12px; padding: 16px 20px; margin: 20px 0; }
        .instructions h4 { color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95rem; }
        .instructions ul { list-style: none; color: var(--text-secondary); font-size: 0.9rem; }
        .instructions li { padding: 6px 0 6px 24px; position: relative; }
        .instructions li::before { content: "âœ“"; position: absolute; left: 0; color: var(--accent-success); }
        
        /* Buttons */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 12px 24px; font-size: 0.95rem; font-weight: 600; font-family: inherit;
            border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white; box-shadow: 0 6px 24px var(--glow-primary);
        }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-gold {
            background: linear-gradient(135deg, var(--accent-gold), #f59e0b);
            color: #1a1a25; box-shadow: 0 6px 24px var(--glow-gold);
        }
        .btn-gold:hover { transform: translateY(-2px); }
        .btn-secondary { background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border-medium); }
        .btn-ghost { background: transparent; color: var(--text-secondary); }
        .btn-danger { background: rgba(239, 68, 68, 0.15); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-center { display: flex; justify-content: center; gap: 12px; margin-top: 24px; flex-wrap: wrap; }
        
        /* Form */
        .form-input {
            width: 100%; background: var(--bg-elevated); border: 2px solid var(--border-medium);
            border-radius: 10px; padding: 12px 16px; color: var(--text-primary);
            font-family: inherit; font-size: 0.95rem; transition: all 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--accent-primary); }
        .form-input.gold:focus { border-color: var(--accent-gold); }
        .form-input::placeholder { color: var(--text-muted); }
        .input-row { display: flex; gap: 10px; }
        .input-row .form-input { flex: 1; }
        
        /* Mensa Access Box */
        .mensa-box {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.05), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 16px; padding: 24px; margin: 20px 0;
        }
        .mensa-box h4 { color: var(--accent-gold); font-size: 1.1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .mensa-box p { color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5; font-size: 0.9rem; }
        .code-error { color: var(--accent-danger); margin-top: 10px; display: none; font-size: 0.85rem; }
        
        /* Disclaimer */
        .disclaimer {
            background: var(--bg-secondary); border-radius: 10px; padding: 14px 18px;
            margin-top: 20px; font-size: 0.8rem; color: var(--text-muted); line-height: 1.5;
        }
        .disclaimer strong { color: var(--text-secondary); }
        
        /* Progress Header */
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
        .progress-info { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .question-counter { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--text-secondary); }
        .question-counter strong { color: var(--text-primary); font-size: 1rem; }
        .badge { padding: 5px 12px; border-radius: 16px; font-size: 0.75rem; font-weight: 600; }
        .badge-category { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; }
        .badge-category.gold { background: rgba(251, 191, 36, 0.2); color: var(--accent-gold); }
        .badge-easy { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .badge-medium { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .badge-hard { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .badge-extreme { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
        
        /* Timer */
        .timer-area { display: flex; align-items: center; gap: 12px; }
        .exit-btn {
            background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);
            color: #f87171; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer;
        }
        .timer-ring { width: 48px; height: 48px; position: relative; }
        .timer-ring svg { transform: rotate(-90deg); }
        .timer-ring circle { fill: none; stroke-width: 4; }
        .timer-ring .bg { stroke: var(--bg-elevated); }
        .timer-ring .progress { stroke: var(--accent-primary); stroke-linecap: round; transition: stroke-dashoffset 1s linear; }
        .timer-ring.gold .progress { stroke: var(--accent-gold); }
        .timer-ring.warning .progress { stroke: var(--accent-warning); }
        .timer-ring.danger .progress { stroke: var(--accent-danger); }
        .timer-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; font-weight: 600;
        }
        
        /* Progress Bar */
        .progress-bar { height: 5px; background: var(--bg-elevated); border-radius: 3px; overflow: hidden; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); border-radius: 3px; transition: width 0.4s; }
        .progress-fill.gold { background: linear-gradient(90deg, var(--accent-gold), #f59e0b); }
        
        /* Question Card */
        .question-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 20px; overflow: hidden; }
        .question-content { padding: 32px; }
        .question-text { font-size: 1.15rem; font-weight: 500; line-height: 1.6; margin-bottom: 20px; }
        
        /* Visual Area */
        .visual-area { display: flex; justify-content: center; margin: 20px 0; }
        .matrix-box { background: var(--bg-secondary); border-radius: 14px; padding: 20px; }
        .matrix-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .matrix-cell {
            width: 72px; height: 72px; background: var(--bg-elevated); border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 1.6rem;
        }
        .matrix-cell.empty {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px dashed var(--accent-primary);
        }
        .matrix-cell.empty.gold {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            border-color: var(--accent-gold);
        }
        .matrix-cell.empty::after { content: '?'; font-size: 1.8rem; color: var(--accent-primary); font-weight: 700; }
        .matrix-cell.empty.gold::after { color: var(--accent-gold); }
        
        .sequence-box { display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .seq-item {
            width: 56px; height: 56px; background: var(--bg-elevated); border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 600;
        }
        .seq-item.unknown {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            border: 2px solid var(--accent-primary); color: var(--accent-primary);
        }
        .seq-arrow { color: var(--text-muted); font-size: 1.1rem; }
        
        .analogy-box { display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap; }
        .analogy-item { padding: 12px 20px; background: var(--bg-elevated); border-radius: 10px; font-size: 1.05rem; font-weight: 500; }
        .analogy-item.unknown {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            border: 2px solid var(--accent-primary); color: var(--accent-primary);
        }
        .analogy-sep { font-size: 1.2rem; color: var(--text-muted); font-weight: 600; }
        
        /* Options */
        .options-area { padding: 24px 32px 32px; background: var(--bg-secondary); border-top: 1px solid var(--border-subtle); }
        .options-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.08em; }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        .option {
            background: var(--bg-card); border: 2px solid var(--border-subtle); border-radius: 10px;
            padding: 14px 18px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px;
        }
        .option:hover { border-color: var(--accent-primary); background: rgba(99, 102, 241, 0.05); }
        .option.gold:hover { border-color: var(--accent-gold); background: rgba(251, 191, 36, 0.05); }
        .option.selected { border-color: var(--accent-primary); background: rgba(99, 102, 241, 0.1); }
        .option.selected.gold { border-color: var(--accent-gold); background: rgba(251, 191, 36, 0.1); }
        .option-marker {
            width: 28px; height: 28px; border-radius: 6px; background: var(--bg-elevated);
            display: flex; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 600; color: var(--text-muted);
        }
        .option.selected .option-marker { background: var(--accent-primary); color: white; }
        .option.selected.gold .option-marker { background: var(--accent-gold); color: var(--bg-primary); }
        .option-text { font-size: 0.95rem; font-weight: 500; }
        
        /* Nav Buttons */
        .nav-buttons { display: flex; justify-content: space-between; padding: 0 32px 24px; background: var(--bg-secondary); }
        
        /* Results */
        .results-header { text-align: center; margin-bottom: 28px; }
        .results-header h2 { font-size: 1.5rem; margin-bottom: 6px; }
        .results-header h2.gold { color: var(--accent-gold); }
        .results-header p { color: var(--text-secondary); }
        
        .score-display { display: flex; justify-content: center; margin: 32px 0; }
        .score-ring { position: relative; width: 200px; height: 200px; }
        .score-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .score-ring circle { fill: none; stroke-width: 10; }
        .score-ring .bg { stroke: var(--bg-elevated); }
        .score-ring .progress { stroke: url(#scoreGrad); stroke-linecap: round; transition: stroke-dashoffset 1.5s ease-out; }
        .score-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .score-value {
            font-size: 3rem; font-weight: 800; line-height: 1;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .score-value.gold {
            background: linear-gradient(135deg, var(--accent-gold), #f59e0b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .score-label { font-size: 0.85rem; color: var(--text-muted); margin-top: 4px; }
        
        .class-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 16px; padding: 24px; text-align: center; margin: 24px 0;
        }
        .class-box.gold {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            border-color: rgba(251, 191, 36, 0.3);
        }
        .class-label { font-size: 1.2rem; font-weight: 700; color: var(--accent-primary); margin-bottom: 6px; }
        .class-label.gold { color: var(--accent-gold); }
        .class-desc { color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }
        .percentile-badge {
            display: inline-flex; align-items: center; gap: 6px; background: var(--bg-elevated);
            padding: 8px 16px; border-radius: 20px; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
        }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin: 24px 0; }
        .stat-card { background: var(--bg-secondary); border-radius: 12px; padding: 16px; text-align: center; }
        .stat-value { font-size: 1.6rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .stat-label { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.04em; }
        
        /* Category Results */
        .category-results { margin-top: 28px; }
        .category-results h3 { font-size: 1rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .cat-item { margin-bottom: 16px; }
        .cat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .cat-name { font-weight: 500; display: flex; align-items: center; gap: 6px; font-size: 0.9rem; }
        .cat-score { font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); font-size: 0.85rem; }
        .cat-bar { height: 8px; background: var(--bg-elevated); border-radius: 4px; overflow: hidden; }
        .cat-fill { height: 100%; border-radius: 4px; transition: width 1s ease-out; }
        .cat-item:nth-child(1) .cat-fill { background: linear-gradient(90deg, #6366f1, #818cf8); }
        .cat-item:nth-child(2) .cat-fill { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
        .cat-item:nth-child(3) .cat-fill { background: linear-gradient(90deg, #ec4899, #f472b6); }
        .cat-item:nth-child(4) .cat-fill { background: linear-gradient(90deg, #10b981, #34d399); }
        .cat-item:nth-child(5) .cat-fill { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        
        /* Certificate */
        .certificate {
            background: linear-gradient(135deg, #1a1a25, #222230);
            border: 3px solid var(--accent-gold); border-radius: 20px;
            padding: 32px; text-align: center; position: relative; overflow: hidden; margin: 24px 0;
        }
        .cert-badge {
            width: 72px; height: 72px; margin: 0 auto 16px;
            background: linear-gradient(135deg, var(--accent-gold), #f59e0b); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 36px;
            box-shadow: 0 0 30px var(--glow-gold); position: relative; z-index: 1;
        }
        .cert-title { font-size: 1.5rem; font-weight: 700; color: var(--accent-gold); margin-bottom: 6px; position: relative; z-index: 1; }
        .cert-subtitle { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 16px; position: relative; z-index: 1; }
        .cert-details { display: flex; justify-content: center; gap: 28px; margin: 16px 0; flex-wrap: wrap; position: relative; z-index: 1; }
        .cert-detail { text-align: center; }
        .cert-detail-value { font-size: 1.5rem; font-weight: 800; font-family: 'JetBrains Mono', monospace; }
        .cert-detail-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; }
        .cert-code-box {
            background: var(--bg-elevated); border-radius: 10px; padding: 14px 20px;
            margin: 16px auto; max-width: 260px; position: relative; z-index: 1;
        }
        .cert-code-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 6px; }
        .cert-code-value { font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; font-weight: 700; color: var(--accent-gold); letter-spacing: 0.08em; }
        
        /* Email Form */
        .email-form { background: var(--bg-secondary); border-radius: 14px; padding: 20px; margin: 20px 0; }
        .email-form h4 { margin-bottom: 12px; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        .email-form p { color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 12px; }
        .email-success { color: var(--accent-success); margin-top: 10px; display: none; align-items: center; gap: 6px; font-size: 0.9rem; }
        
        /* Not Qualified */
        .not-qualified {
            background: rgba(100, 116, 139, 0.05); border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 14px; padding: 20px; margin: 20px 0;
        }
        .not-qualified h4 { color: var(--text-secondary); font-size: 1rem; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .not-qualified p { color: var(--text-muted); font-size: 0.9rem; line-height: 1.5; }
        
        /* Result Actions */
        .result-actions { display: flex; justify-content: center; gap: 12px; margin-top: 28px; flex-wrap: wrap; }
        
        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); display: none; align-items: center; justify-content: center;
            z-index: 1000; padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border-radius: 20px; padding: 32px; max-width: 420px; width: 100%; text-align: center; }
        .modal-icon { font-size: 40px; margin-bottom: 16px; }
        .modal h3 { font-size: 1.2rem; margin-bottom: 10px; }
        .modal p { color: var(--text-secondary); margin-bottom: 20px; line-height: 1.5; font-size: 0.9rem; }
        .modal-btns { display: flex; justify-content: center; gap: 10px; }
        
        /* Sections */
        .section { display: none; }
        .section.active { display: block; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        .animate { animation: fadeIn 0.5s ease-out; }
        
        /* Responsive */
        @media (max-width: 640px) {
            header h1 { font-size: 1.8rem; }
            .card { padding: 20px; }
            .question-content { padding: 20px; }
            .options-area { padding: 20px; }
            .nav-buttons { padding: 0 20px 20px; }
            .matrix-cell { width: 60px; height: 60px; font-size: 1.3rem; }
            .certificate { padding: 24px 16px; }
        }
    </style>
</head>
<body>
    <div class="bg-pattern" id="bgPattern"></div>
    
    <div class="container">
        <div class="top-bar">
            <div class="logo" onclick="goHome()">
                <div class="logo-icon" id="logoIcon">ğŸ§ </div>
                <span class="logo-text">COGNIQ</span>
            </div>
            <div class="top-controls">
                <select class="lang-select" id="langSelect" onchange="setLang(this.value)">
                    <option value="ko">í•œêµ­ì–´</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>
        
        <header>
            <h1 id="mainTitle">ì¸ì§€ëŠ¥ë ¥ ì¸¡ì • í…ŒìŠ¤íŠ¸</h1>
            <p id="mainSubtitle">ê³¼í•™ì  ë¬¸ì œ ì„¤ê³„ ê¸°ë°˜ IQ í‰ê°€</p>
        </header>
        
        <!-- INTRO -->
        <div class="section active" id="introSection">
            <div class="card card-glow animate">
                <h3 class="section-title"><span class="icon">ğŸ“‹</span> <span data-t="intro.title">í…ŒìŠ¤íŠ¸ ì•ˆë‚´</span></h3>
                <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 16px;" data-t="intro.desc">ë³¸ í…ŒìŠ¤íŠ¸ëŠ” 5ê°€ì§€ ì¸ì§€ ì˜ì—­ì„ ì¸¡ì •í•©ë‹ˆë‹¤. ê° ë¬¸ì œ ìœ í˜•ì„ í™•ì¸ í›„ ì‹œì‘í•˜ì„¸ìš”.</p>
                
                <div class="tutorial-grid">
                    <div class="tutorial-card">
                        <div class="tutorial-header">
                            <div class="tutorial-icon">ğŸ”·</div>
                            <div class="tutorial-title" data-t="cat.pattern">íŒ¨í„´ ì¸ì‹</div>
                        </div>
                        <p class="tutorial-desc" data-t="tut.pattern">3Ã—3 í–‰ë ¬ì—ì„œ ê°€ë¡œ, ì„¸ë¡œ ê·œì¹™ì„ ì°¾ì•„ ë¹ˆ ì¹¸ì„ ì±„ì›ë‹ˆë‹¤.</p>
                        <div class="tutorial-example">1, 2, 3 â†’ 4, 5, 6 â†’ 7, 8, <strong>?</strong></div>
                    </div>
                    <div class="tutorial-card">
                        <div class="tutorial-header">
                            <div class="tutorial-icon">ğŸ”¢</div>
                            <div class="tutorial-title" data-t="cat.numerical">ìˆ˜ë¦¬ ì¶”ë¡ </div>
                        </div>
                        <p class="tutorial-desc" data-t="tut.numerical">ìˆ˜ì—´ì˜ ê·œì¹™ì„ íŒŒì•…í•˜ì—¬ ë‹¤ìŒ ìˆ«ìë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>
                        <div class="tutorial-example">2, 4, 8, 16, <strong>?</strong> â†’ 32</div>
                    </div>
                    <div class="tutorial-card">
                        <div class="tutorial-header">
                            <div class="tutorial-icon">ğŸ“</div>
                            <div class="tutorial-title" data-t="cat.spatial">ê³µê°„ ì§€ê°</div>
                        </div>
                        <p class="tutorial-desc" data-t="tut.spatial">ë„í˜•ì˜ íšŒì „, ë°˜ì‚¬ ë“± ê³µê°„ ë³€í™˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
                        <div class="tutorial-example">â”˜ â†’ 90Â° íšŒì „ â†’ <strong>â””</strong></div>
                    </div>
                    <div class="tutorial-card">
                        <div class="tutorial-header">
                            <div class="tutorial-icon">ğŸ§©</div>
                            <div class="tutorial-title" data-t="cat.logical">ë…¼ë¦¬ ì¶”ë¡ </div>
                        </div>
                        <p class="tutorial-desc" data-t="tut.logical">ì¡°ê±´ê³¼ ëª…ì œë¥¼ ë¶„ì„í•´ ë…¼ë¦¬ì  ê²°ë¡ ì„ ë„ì¶œí•©ë‹ˆë‹¤.</p>
                        <div class="tutorial-example">A>B, B>C â†’ <strong>Cê°€ ìµœì†Œ</strong></div>
                    </div>
                    <div class="tutorial-card">
                        <div class="tutorial-header">
                            <div class="tutorial-icon">ğŸ“</div>
                            <div class="tutorial-title" data-t="cat.verbal">ì–¸ì–´ ìœ ì¶”</div>
                        </div>
                        <p class="tutorial-desc" data-t="tut.verbal">ê°œë… ê°„ ê´€ê³„ë¥¼ íŒŒì•…í•˜ì—¬ ìœ ì¶”í•©ë‹ˆë‹¤.</p>
                        <div class="tutorial-example">ì±… : ì½ë‹¤ = ìŒì•… : <strong>?</strong> â†’ ë“£ë‹¤</div>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="info-row">
                        <div class="info-item"><span>ğŸ“Š</span> <span class="label" data-t="info.questions">ë¬¸í•­</span> <span class="value">30</span></div>
                        <div class="info-item"><span>â±ï¸</span> <span class="label" data-t="info.time">ì‹œê°„</span> <span class="value" data-t="info.perQ">45ì´ˆ/ë¬¸í•­</span></div>
                        <div class="info-item"><span>ğŸ¯</span> <span class="label" data-t="info.qual">ìê²©</span> <span class="value">IQ 120+</span></div>
                    </div>
                </div>
                
                <div class="instructions">
                    <h4 data-t="inst.title">ğŸ“Œ ì§„í–‰ ì•ˆë‚´</h4>
                    <ul>
                        <li data-t="inst.1">4ê°œ ë³´ê¸° ì¤‘ ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”.</li>
                        <li data-t="inst.2">ì‹œê°„ ì´ˆê³¼ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</li>
                        <li data-t="inst.3">"ê±´ë„ˆë›°ê¸°"ë¡œ ì–´ë ¤ìš´ ë¬¸ì œë¥¼ íŒ¨ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li data-t="inst.4">IQ 120+ ë‹¬ì„± ì‹œ ë©˜ì‚¬ ë„ì „ ì½”ë“œê°€ ë°œê¸‰ë©ë‹ˆë‹¤.</li>
                    </ul>
                </div>
                
                <div class="mensa-box">
                    <h4>ğŸ† <span data-t="mensa.title">ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸</span></h4>
                    <p data-t="mensa.desc">ì´ë¯¸ ìê²© ì½”ë“œê°€ ìˆìœ¼ì‹ ê°€ìš”? ì•„ë˜ì— ì…ë ¥í•˜ì—¬ ë°”ë¡œ ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ì„¸ìš”.</p>
                    <div class="input-row">
                        <input type="text" class="form-input gold" id="codeInput" placeholder="CQ-XXXXXXXX" maxlength="12" style="text-transform: uppercase;">
                        <button class="btn btn-gold" onclick="verifyCode()" data-t="mensa.verify">ì¸ì¦</button>
                    </div>
                    <div class="code-error" id="codeError" data-t="mensa.invalid">ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œì…ë‹ˆë‹¤.</div>
                </div>
                
                <div class="disclaimer">
                    <strong>âš ï¸</strong> <span data-t="disclaimer">ë³¸ í…ŒìŠ¤íŠ¸ëŠ” ì°¸ê³ ìš©ì´ë©° ê³µì¸ëœ IQ ê²€ì‚¬ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
                </div>
                
                <div class="btn-center">
                    <button class="btn btn-primary" onclick="startBasicTest()">
                        <span data-t="btn.start">í…ŒìŠ¤íŠ¸ ì‹œì‘</span> <span>â†’</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- BASIC TEST -->
        <div class="section" id="basicTestSection">
            <div class="progress-header">
                <div class="progress-info">
                    <span class="question-counter"><span data-t="q.num">ë¬¸ì œ</span> <strong id="bCurQ">1</strong> / <span id="bTotalQ">30</span></span>
                    <span class="badge badge-category" id="bCatBadge">íŒ¨í„´</span>
                    <span class="badge badge-medium" id="bDiffBadge">ë³´í†µ</span>
                </div>
                <div class="timer-area">
                    <button class="exit-btn" onclick="showExitModal('basic')" data-t="btn.exit">ì¢…ë£Œ</button>
                    <div class="timer-ring" id="bTimerRing">
                        <svg width="48" height="48">
                            <circle class="bg" cx="24" cy="24" r="20"></circle>
                            <circle class="progress" id="bTimerProg" cx="24" cy="24" r="20" stroke-dasharray="125.66" stroke-dashoffset="0"></circle>
                        </svg>
                        <span class="timer-text" id="bTimerTxt">45</span>
                    </div>
                </div>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="bProgBar" style="width:0%"></div></div>
            
            <div class="question-card animate" id="bQCard">
                <div class="question-content">
                    <p class="question-text" id="bQText">ë¬¸ì œ</p>
                    <div class="visual-area" id="bVisual"></div>
                </div>
                <div class="options-area">
                    <p class="options-label" data-t="q.select">ë‹µì„ ì„ íƒí•˜ì„¸ìš”</p>
                    <div class="options-grid" id="bOptions"></div>
                </div>
                <div class="nav-buttons">
                    <button class="btn btn-ghost" onclick="skipBasic()" data-t="btn.skip">ê±´ë„ˆë›°ê¸°</button>
                    <button class="btn btn-primary" id="bNextBtn" onclick="nextBasic()" disabled><span data-t="btn.next">ë‹¤ìŒ</span> â†’</button>
                </div>
            </div>
        </div>
        
        <!-- BASIC RESULTS -->
        <div class="section" id="basicResultsSection">
            <div class="card card-glow animate">
                <div class="results-header">
                    <h2>ğŸ‰ <span data-t="res.complete">í…ŒìŠ¤íŠ¸ ì™„ë£Œ</span></h2>
                    <p data-t="res.analysis">ì¸ì§€ëŠ¥ë ¥ ë¶„ì„ ê²°ê³¼</p>
                </div>
                
                <div class="score-display">
                    <div class="score-ring">
                        <svg width="200" height="200">
                            <defs>
                                <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#6366f1"/>
                                    <stop offset="100%" stop-color="#8b5cf6"/>
                                </linearGradient>
                                <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#fbbf24"/>
                                    <stop offset="100%" stop-color="#f59e0b"/>
                                </linearGradient>
                            </defs>
                            <circle class="bg" cx="100" cy="100" r="88"></circle>
                            <circle class="progress" id="bScoreProg" cx="100" cy="100" r="88" stroke-dasharray="553" stroke-dashoffset="553"></circle>
                        </svg>
                        <div class="score-center">
                            <div class="score-value" id="bIQ">--</div>
                            <div class="score-label">IQ</div>
                        </div>
                    </div>
                </div>
                
                <div class="class-box" id="bClassBox">
                    <div class="class-label" id="bClassLabel">ë¶„ë¥˜</div>
                    <p class="class-desc" id="bClassDesc">ì„¤ëª…</p>
                    <div class="percentile-badge"><span>ğŸ“Š</span> <span id="bPercentile">--</span></div>
                </div>
                
                <!-- Certificate -->
                <div id="certSection" style="display:none;">
                    <div class="certificate">
                        <div class="cert-badge">ğŸ…</div>
                        <div class="cert-title" data-t="cert.title">ë©˜ì‚¬ ë„ì „ ìê²©ì¦</div>
                        <div class="cert-subtitle">MENSA Challenge Certificate</div>
                        <p style="color: var(--text-secondary); position: relative; z-index: 1; font-size: 0.9rem;" data-t="cert.desc">ê·€í•˜ëŠ” ê¸°ë³¸ í…ŒìŠ¤íŠ¸ì—ì„œ ìš°ìˆ˜í•œ ì„±ì ì„ ê±°ë‘ì–´<br>ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸ ìê²©ì„ íšë“í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
                        <div class="cert-details">
                            <div class="cert-detail"><div class="cert-detail-value" id="certIQ">--</div><div class="cert-detail-label" data-t="cert.iq">IQ</div></div>
                            <div class="cert-detail"><div class="cert-detail-value" id="certDate">--</div><div class="cert-detail-label" data-t="cert.date">ë°œê¸‰ì¼</div></div>
                        </div>
                        <div class="cert-code-box">
                            <div class="cert-code-label" data-t="cert.code">ìê²© ì½”ë“œ</div>
                            <div class="cert-code-value" id="certCode">--</div>
                        </div>
                    </div>
                    
                    <div class="email-form">
                        <h4>ğŸ“§ <span data-t="email.title">ì´ë©”ì¼ë¡œ ìê²©ì¦ ë°›ê¸°</span></h4>
                        <p data-t="email.desc">ìê²© ì½”ë“œë¥¼ ì´ë©”ì¼ë¡œ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
                        <div class="input-row">
                            <input type="email" class="form-input" id="emailInput" placeholder="example@email.com">
                            <button class="btn btn-gold" onclick="sendEmail()" data-t="email.send">ë°œì†¡</button>
                        </div>
                        <div class="email-success" id="emailOK"><span>âœ…</span> <span data-t="email.ok">ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ!</span></div>
                    </div>
                </div>
                
                <!-- Not Qualified -->
                <div id="notQualSection" style="display:none;">
                    <div class="not-qualified">
                        <h4>ğŸ”’ <span data-t="nq.title">ë©˜ì‚¬ ìê²© ë¯¸ë‹¬</span></h4>
                        <p data-t="nq.desc">IQ 120 ì´ìƒ ë‹¬ì„± ì‹œ ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="bCorrect">--</div><div class="stat-label" data-t="stat.correct">ì •ë‹µ</div></div>
                    <div class="stat-card"><div class="stat-value" id="bAccuracy">--%</div><div class="stat-label" data-t="stat.acc">ì •í™•ë„</div></div>
                    <div class="stat-card"><div class="stat-value" id="bAvgTime">--s</div><div class="stat-label" data-t="stat.avg">í‰ê· </div></div>
                    <div class="stat-card"><div class="stat-value" id="bTotalTime">--m</div><div class="stat-label" data-t="stat.total">ì´ì‹œê°„</div></div>
                </div>
                
                <div class="category-results">
                    <h3><span>ğŸ“ˆ</span> <span data-t="res.category">ì˜ì—­ë³„ ë¶„ì„</span></h3>
                    <div class="cat-item"><div class="cat-header"><span class="cat-name"><span>ğŸ”·</span> <span data-t="cat.pattern">íŒ¨í„´</span></span><span class="cat-score" id="bPatternS">0/6</span></div><div class="cat-bar"><div class="cat-fill" id="bPatternB" style="width:0%"></div></div></div>
                    <div class="cat-item"><div class="cat-header"><span class="cat-name"><span>ğŸ”¢</span> <span data-t="cat.numerical">ìˆ˜ë¦¬</span></span><span class="cat-score" id="bNumS">0/6</span></div><div class="cat-bar"><div class="cat-fill" id="bNumB" style="width:0%"></div></div></div>
                    <div class="cat-item"><div class="cat-header"><span class="cat-name"><span>ğŸ“</span> <span data-t="cat.spatial">ê³µê°„</span></span><span class="cat-score" id="bSpatialS">0/6</span></div><div class="cat-bar"><div class="cat-fill" id="bSpatialB" style="width:0%"></div></div></div>
                    <div class="cat-item"><div class="cat-header"><span class="cat-name"><span>ğŸ§©</span> <span data-t="cat.logical">ë…¼ë¦¬</span></span><span class="cat-score" id="bLogicalS">0/6</span></div><div class="cat-bar"><div class="cat-fill" id="bLogicalB" style="width:0%"></div></div></div>
                    <div class="cat-item"><div class="cat-header"><span class="cat-name"><span>ğŸ“</span> <span data-t="cat.verbal">ì–¸ì–´</span></span><span class="cat-score" id="bVerbalS">0/6</span></div><div class="cat-bar"><div class="cat-fill" id="bVerbalB" style="width:0%"></div></div></div>
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-secondary" onclick="restart()"><span>ğŸ”„</span> <span data-t="btn.retry">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</span></button>
                    <button class="btn btn-gold" id="mensaBtn" onclick="startMensaTest()" style="display:none;"><span>ğŸ†</span> <span data-t="btn.mensa">ë©˜ì‚¬ ë„ì „</span></button>
                </div>
            </div>
        </div>
        
        <!-- MENSA TEST -->
        <div class="section" id="mensaTestSection">
            <div class="progress-header">
                <div class="progress-info">
                    <span class="question-counter"><span data-t="q.num">ë¬¸ì œ</span> <strong id="mCurQ">1</strong> / <span id="mTotalQ">20</span></span>
                    <span class="badge badge-category gold" id="mCatBadge">í–‰ë ¬</span>
                    <span class="badge badge-extreme" id="mDiffBadge">ê³ ê¸‰</span>
                </div>
                <div class="timer-area">
                    <button class="exit-btn" onclick="showExitModal('mensa')" data-t="btn.exit">ì¢…ë£Œ</button>
                    <div class="timer-ring gold" id="mTimerRing">
                        <svg width="48" height="48">
                            <circle class="bg" cx="24" cy="24" r="20"></circle>
                            <circle class="progress" id="mTimerProg" cx="24" cy="24" r="20" stroke-dasharray="125.66" stroke-dashoffset="0"></circle>
                        </svg>
                        <span class="timer-text" id="mTimerTxt">60</span>
                    </div>
                </div>
            </div>
            <div class="progress-bar"><div class="progress-fill gold" id="mProgBar" style="width:0%"></div></div>
            
            <div class="question-card animate" id="mQCard">
                <div class="question-content">
                    <p class="question-text" id="mQText">ë¬¸ì œ</p>
                    <div class="visual-area" id="mVisual"></div>
                </div>
                <div class="options-area">
                    <p class="options-label" data-t="q.select">ë‹µì„ ì„ íƒí•˜ì„¸ìš”</p>
                    <div class="options-grid" id="mOptions"></div>
                </div>
                <div class="nav-buttons">
                    <button class="btn btn-ghost" onclick="skipMensa()" data-t="btn.skip">ê±´ë„ˆë›°ê¸°</button>
                    <button class="btn btn-gold" id="mNextBtn" onclick="nextMensa()" disabled><span data-t="btn.next">ë‹¤ìŒ</span> â†’</button>
                </div>
            </div>
        </div>
        
        <!-- MENSA RESULTS -->
        <div class="section" id="mensaResultsSection">
            <div class="card card-gold animate">
                <div class="results-header">
                    <h2 class="gold">ğŸ† <span data-t="mres.complete">ë©˜ì‚¬ ë„ì „ ì™„ë£Œ</span></h2>
                    <p data-t="mres.analysis">ê³ ê¸‰ ì¸ì§€ëŠ¥ë ¥ ë¶„ì„ ê²°ê³¼</p>
                </div>
                
                <div class="score-display">
                    <div class="score-ring">
                        <svg width="200" height="200">
                            <circle class="bg" cx="100" cy="100" r="88"></circle>
                            <circle class="progress" id="mScoreProg" cx="100" cy="100" r="88" stroke-dasharray="553" stroke-dashoffset="553" stroke="url(#goldGrad)"></circle>
                        </svg>
                        <div class="score-center">
                            <div class="score-value gold" id="mIQ">--</div>
                            <div class="score-label" data-t="mres.estIQ">ì¶”ì • IQ</div>
                        </div>
                    </div>
                </div>
                
                <div class="class-box gold">
                    <div class="class-label gold" id="mClassLabel">ë“±ê¸‰</div>
                    <p class="class-desc" id="mClassDesc">ì„¤ëª…</p>
                    <div class="percentile-badge"><span>ğŸ†</span> <span id="mPercentile">--</span></div>
                </div>
                
                <!-- Mensa Pass -->
                <div id="mensaPassSection" style="display:none;">
                    <div class="certificate">
                        <div class="cert-badge">ğŸ‘‘</div>
                        <div class="cert-title" data-t="mcert.title">ë©˜ì‚¬ ë ˆë²¨ ë‹¬ì„±</div>
                        <div class="cert-subtitle">MENSA Level Achievement</div>
                        <p style="color: var(--text-secondary); position: relative; z-index: 1; font-size: 0.9rem;" data-t="mcert.desc">ì¶•í•˜í•©ë‹ˆë‹¤! ìƒìœ„ 2% ì¸ì§€ëŠ¥ë ¥ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                        <div class="cert-details">
                            <div class="cert-detail"><div class="cert-detail-value" id="mCertIQ">--</div><div class="cert-detail-label" data-t="mcert.iq">IQ</div></div>
                            <div class="cert-detail"><div class="cert-detail-value" id="mCertPct">--</div><div class="cert-detail-label" data-t="mcert.pct">ë°±ë¶„ìœ„</div></div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="mCorrect">--</div><div class="stat-label" data-t="stat.correct">ì •ë‹µ</div></div>
                    <div class="stat-card"><div class="stat-value" id="mAccuracy">--%</div><div class="stat-label" data-t="stat.acc">ì •í™•ë„</div></div>
                    <div class="stat-card"><div class="stat-value" id="mAvgTime">--s</div><div class="stat-label" data-t="stat.avg">í‰ê· </div></div>
                </div>
                
                <div class="disclaimer">
                    <strong>ğŸ“Œ</strong> <span data-t="mdisclaimer">ë³¸ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©° ì‹¤ì œ ë©˜ì‚¬ ìê²©ê³¼ ë¬´ê´€í•©ë‹ˆë‹¤. ê³µì‹ í…ŒìŠ¤íŠ¸ëŠ” ë©˜ì‚¬ ì½”ë¦¬ì•„ì—ì„œ ì‘ì‹œí•˜ì„¸ìš”.</span>
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-secondary" onclick="restart()"><span>ğŸ”„</span> <span data-t="btn.startOver">ì²˜ìŒë¶€í„°</span></button>
                    <button class="btn btn-gold" onclick="retryMensa()"><span>ğŸ†</span> <span data-t="btn.retryM">ì¬ë„ì „</span></button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Exit Modal -->
    <div class="modal-overlay" id="exitModal">
        <div class="modal">
            <div class="modal-icon">âš ï¸</div>
            <h3 data-t="modal.title">í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
            <p data-t="modal.desc">ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            <div class="modal-btns">
                <button class="btn btn-secondary" onclick="closeModal()" data-t="modal.cancel">ì·¨ì†Œ</button>
                <button class="btn btn-danger" onclick="confirmExit()" data-t="modal.confirm">ì¢…ë£Œ</button>
            </div>
        </div>
    </div>

    <script>
    // ========== TRANSLATIONS ==========
    const T = {
        ko: {
            'intro.title': 'í…ŒìŠ¤íŠ¸ ì•ˆë‚´',
            'intro.desc': 'ë³¸ í…ŒìŠ¤íŠ¸ëŠ” 5ê°€ì§€ ì¸ì§€ ì˜ì—­ì„ ì¸¡ì •í•©ë‹ˆë‹¤. ê° ë¬¸ì œ ìœ í˜•ì„ í™•ì¸ í›„ ì‹œì‘í•˜ì„¸ìš”.',
            'cat.pattern': 'íŒ¨í„´ ì¸ì‹', 'cat.numerical': 'ìˆ˜ë¦¬ ì¶”ë¡ ', 'cat.spatial': 'ê³µê°„ ì§€ê°', 'cat.logical': 'ë…¼ë¦¬ ì¶”ë¡ ', 'cat.verbal': 'ì–¸ì–´ ìœ ì¶”',
            'tut.pattern': '3Ã—3 í–‰ë ¬ì—ì„œ ê°€ë¡œ, ì„¸ë¡œ ê·œì¹™ì„ ì°¾ì•„ ë¹ˆ ì¹¸ì„ ì±„ì›ë‹ˆë‹¤.',
            'tut.numerical': 'ìˆ˜ì—´ì˜ ê·œì¹™ì„ íŒŒì•…í•˜ì—¬ ë‹¤ìŒ ìˆ«ìë¥¼ ì°¾ìŠµë‹ˆë‹¤.',
            'tut.spatial': 'ë„í˜•ì˜ íšŒì „, ë°˜ì‚¬ ë“± ê³µê°„ ë³€í™˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.',
            'tut.logical': 'ì¡°ê±´ê³¼ ëª…ì œë¥¼ ë¶„ì„í•´ ë…¼ë¦¬ì  ê²°ë¡ ì„ ë„ì¶œí•©ë‹ˆë‹¤.',
            'tut.verbal': 'ê°œë… ê°„ ê´€ê³„ë¥¼ íŒŒì•…í•˜ì—¬ ìœ ì¶”í•©ë‹ˆë‹¤.',
            'info.questions': 'ë¬¸í•­', 'info.time': 'ì‹œê°„', 'info.perQ': '45ì´ˆ/ë¬¸í•­', 'info.qual': 'ìê²©',
            'inst.title': 'ğŸ“Œ ì§„í–‰ ì•ˆë‚´',
            'inst.1': '4ê°œ ë³´ê¸° ì¤‘ ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”.',
            'inst.2': 'ì‹œê°„ ì´ˆê³¼ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.',
            'inst.3': '"ê±´ë„ˆë›°ê¸°"ë¡œ ì–´ë ¤ìš´ ë¬¸ì œë¥¼ íŒ¨ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
            'inst.4': 'IQ 120+ ë‹¬ì„± ì‹œ ë©˜ì‚¬ ë„ì „ ì½”ë“œê°€ ë°œê¸‰ë©ë‹ˆë‹¤.',
            'mensa.title': 'ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸', 'mensa.desc': 'ì´ë¯¸ ìê²© ì½”ë“œê°€ ìˆìœ¼ì‹ ê°€ìš”? ì•„ë˜ì— ì…ë ¥í•˜ì—¬ ë°”ë¡œ ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ì„¸ìš”.',
            'mensa.verify': 'ì¸ì¦', 'mensa.invalid': 'ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œì…ë‹ˆë‹¤.',
            'disclaimer': 'ë³¸ í…ŒìŠ¤íŠ¸ëŠ” ì°¸ê³ ìš©ì´ë©° ê³µì¸ëœ IQ ê²€ì‚¬ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
            'btn.start': 'í…ŒìŠ¤íŠ¸ ì‹œì‘', 'btn.exit': 'ì¢…ë£Œ', 'btn.skip': 'ê±´ë„ˆë›°ê¸°', 'btn.next': 'ë‹¤ìŒ',
            'btn.retry': 'ë‹¤ì‹œ í…ŒìŠ¤íŠ¸', 'btn.mensa': 'ë©˜ì‚¬ ë„ì „', 'btn.startOver': 'ì²˜ìŒë¶€í„°', 'btn.retryM': 'ì¬ë„ì „',
            'q.num': 'ë¬¸ì œ', 'q.select': 'ë‹µì„ ì„ íƒí•˜ì„¸ìš”',
            'diff.easy': 'ì‰¬ì›€', 'diff.medium': 'ë³´í†µ', 'diff.hard': 'ì–´ë ¤ì›€', 'diff.extreme': 'ê³ ê¸‰',
            'res.complete': 'í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'res.analysis': 'ì¸ì§€ëŠ¥ë ¥ ë¶„ì„ ê²°ê³¼', 'res.category': 'ì˜ì—­ë³„ ë¶„ì„',
            'stat.correct': 'ì •ë‹µ', 'stat.acc': 'ì •í™•ë„', 'stat.avg': 'í‰ê· ', 'stat.total': 'ì´ì‹œê°„',
            'cert.title': 'ë©˜ì‚¬ ë„ì „ ìê²©ì¦', 'cert.desc': 'ê·€í•˜ëŠ” ê¸°ë³¸ í…ŒìŠ¤íŠ¸ì—ì„œ ìš°ìˆ˜í•œ ì„±ì ì„ ê±°ë‘ì–´<br>ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸ ìê²©ì„ íšë“í•˜ì˜€ìŠµë‹ˆë‹¤.',
            'cert.iq': 'IQ', 'cert.date': 'ë°œê¸‰ì¼', 'cert.code': 'ìê²© ì½”ë“œ',
            'email.title': 'ì´ë©”ì¼ë¡œ ìê²©ì¦ ë°›ê¸°', 'email.desc': 'ìê²© ì½”ë“œë¥¼ ì´ë©”ì¼ë¡œ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.', 'email.send': 'ë°œì†¡', 'email.ok': 'ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ!',
            'nq.title': 'ë©˜ì‚¬ ìê²© ë¯¸ë‹¬', 'nq.desc': 'IQ 120 ì´ìƒ ë‹¬ì„± ì‹œ ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
            'mres.complete': 'ë©˜ì‚¬ ë„ì „ ì™„ë£Œ', 'mres.analysis': 'ê³ ê¸‰ ì¸ì§€ëŠ¥ë ¥ ë¶„ì„ ê²°ê³¼', 'mres.estIQ': 'ì¶”ì • IQ',
            'mcert.title': 'ë©˜ì‚¬ ë ˆë²¨ ë‹¬ì„±', 'mcert.desc': 'ì¶•í•˜í•©ë‹ˆë‹¤! ìƒìœ„ 2% ì¸ì§€ëŠ¥ë ¥ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.', 'mcert.iq': 'IQ', 'mcert.pct': 'ë°±ë¶„ìœ„',
            'mdisclaimer': 'ë³¸ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©° ì‹¤ì œ ë©˜ì‚¬ ìê²©ê³¼ ë¬´ê´€í•©ë‹ˆë‹¤. ê³µì‹ í…ŒìŠ¤íŠ¸ëŠ” ë©˜ì‚¬ ì½”ë¦¬ì•„ì—ì„œ ì‘ì‹œí•˜ì„¸ìš”.',
            'modal.title': 'í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 'modal.desc': 'ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'modal.cancel': 'ì·¨ì†Œ', 'modal.confirm': 'ì¢…ë£Œ',
            'title.main': 'ì¸ì§€ëŠ¥ë ¥ ì¸¡ì • í…ŒìŠ¤íŠ¸', 'title.sub': 'ê³¼í•™ì  ë¬¸ì œ ì„¤ê³„ ê¸°ë°˜ IQ í‰ê°€',
            'title.mensa': 'ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸', 'title.mensaSub': 'ìƒìœ„ 2% ì¸ì§€ëŠ¥ë ¥ ë„ì „',
            'class.veryS': 'ë§¤ìš° ìš°ìˆ˜', 'class.sup': 'ìš°ìˆ˜', 'class.hAvg': 'í‰ê·  ìƒ', 'class.avg': 'í‰ê· ', 'class.lAvg': 'í‰ê·  í•˜', 'class.border': 'ê²½ê³„ì„ ',
            'class.genius': 'ì²œì¬ ë ˆë²¨', 'class.hGift': 'ë§¤ìš° ì˜ì¬', 'class.mensa': 'ë©˜ì‚¬ í•©ê²©ê¶Œ'
        },
        en: {
            'intro.title': 'Test Guide',
            'intro.desc': 'This test measures 5 cognitive areas. Review each question type before starting.',
            'cat.pattern': 'Pattern Recognition', 'cat.numerical': 'Numerical Reasoning', 'cat.spatial': 'Spatial Perception', 'cat.logical': 'Logical Reasoning', 'cat.verbal': 'Verbal Analogies',
            'tut.pattern': 'Find rules in rows and columns of a 3Ã—3 matrix to fill the blank.',
            'tut.numerical': 'Identify sequence patterns to find the next number.',
            'tut.spatial': 'Perform spatial transformations like rotation and reflection.',
            'tut.logical': 'Analyze conditions to derive logical conclusions.',
            'tut.verbal': 'Identify relationships between concepts.',
            'info.questions': 'Questions', 'info.time': 'Time', 'info.perQ': '45s/question', 'info.qual': 'Qualification',
            'inst.title': 'ğŸ“Œ Instructions',
            'inst.1': 'Select the correct answer from 4 options.',
            'inst.2': 'Auto-advances when time runs out.',
            'inst.3': 'Use "Skip" for difficult questions.',
            'inst.4': 'Achieve IQ 120+ to get Mensa challenge code.',
            'mensa.title': 'Mensa Challenge Test', 'mensa.desc': 'Already have a code? Enter it below to access the Mensa test directly.',
            'mensa.verify': 'Verify', 'mensa.invalid': 'Invalid code.',
            'disclaimer': 'This test is for reference only and does not replace certified IQ tests.',
            'btn.start': 'Start Test', 'btn.exit': 'Exit', 'btn.skip': 'Skip', 'btn.next': 'Next',
            'btn.retry': 'Retry', 'btn.mensa': 'Mensa Challenge', 'btn.startOver': 'Start Over', 'btn.retryM': 'Retry Mensa',
            'q.num': 'Question', 'q.select': 'Select your answer',
            'diff.easy': 'Easy', 'diff.medium': 'Medium', 'diff.hard': 'Hard', 'diff.extreme': 'Expert',
            'res.complete': 'Test Complete', 'res.analysis': 'Cognitive Analysis Results', 'res.category': 'Category Analysis',
            'stat.correct': 'Correct', 'stat.acc': 'Accuracy', 'stat.avg': 'Average', 'stat.total': 'Total',
            'cert.title': 'Mensa Challenge Certificate', 'cert.desc': 'You have earned qualification to access<br>the Mensa-style advanced test.',
            'cert.iq': 'IQ', 'cert.date': 'Issue Date', 'cert.code': 'Access Code',
            'email.title': 'Receive Certificate via Email', 'email.desc': 'We will send the access code to your email.', 'email.send': 'Send', 'email.ok': 'Email sent!',
            'nq.title': 'Not Qualified', 'nq.desc': 'Achieve IQ 120+ to access the Mensa Challenge Test.',
            'mres.complete': 'Mensa Challenge Complete', 'mres.analysis': 'Advanced Cognitive Analysis', 'mres.estIQ': 'Estimated IQ',
            'mcert.title': 'Mensa Level Achieved', 'mcert.desc': 'Congratulations! You demonstrate top 2% cognitive ability.', 'mcert.iq': 'IQ', 'mcert.pct': 'Percentile',
            'mdisclaimer': 'Results are for reference only. For official Mensa membership, take the official test.',
            'modal.title': 'Exit the test?', 'modal.desc': 'Your progress will not be saved.', 'modal.cancel': 'Cancel', 'modal.confirm': 'Exit',
            'title.main': 'Cognitive Intelligence Test', 'title.sub': 'Scientific IQ Assessment',
            'title.mensa': 'Mensa Challenge Test', 'title.mensaSub': 'Top 2% Cognitive Challenge',
            'class.veryS': 'Very Superior', 'class.sup': 'Superior', 'class.hAvg': 'High Average', 'class.avg': 'Average', 'class.lAvg': 'Low Average', 'class.border': 'Borderline',
            'class.genius': 'Genius Level', 'class.hGift': 'Highly Gifted', 'class.mensa': 'Mensa Level'
        }
    };
    
    let lang = 'ko';
    function t(k) { return T[lang][k] || k; }
    function setLang(l) {
        lang = l;
        document.querySelectorAll('[data-t]').forEach(el => {
            const k = el.getAttribute('data-t');
            if (T[l][k]) el.innerHTML = T[l][k];
        });
        document.getElementById('mainTitle').textContent = t('title.main');
        document.getElementById('mainSubtitle').textContent = t('title.sub');
    }
    
    // ========== QUESTIONS ==========
    const basicQ = {
        pattern: [
            {id:'p1',cat:'pattern',catN:{ko:'íŒ¨í„´',en:'Pattern'},diff:1,q:{ko:'ê·œì¹™ì„ ì°¾ì•„ ë¹ˆ ì¹¸ì„ ì±„ìš°ì„¸ìš”.',en:'Find the pattern.'},type:'matrix',matrix:['â—','â—â—','â—â—â—','â– ','â– â– ','â– â– â– ','â–²','â–²â–²','?'],opts:['â–²','â–²â–²â–²','â– â– â– ','â—â—â—'],ans:1},
            {id:'p2',cat:'pattern',catN:{ko:'íŒ¨í„´',en:'Pattern'},diff:1,q:{ko:'ìˆ«ì íŒ¨í„´ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find the number pattern.'},type:'matrix',matrix:['1','2','3','4','5','6','7','8','?'],opts:['9','10','0','7'],ans:0},
            {id:'p3',cat:'pattern',catN:{ko:'íŒ¨í„´',en:'Pattern'},diff:2,q:{ko:'í–‰ê³¼ ì—´ì˜ ê·œì¹™ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find row and column rules.'},type:'matrix',matrix:['2','4','6','3','6','9','4','8','?'],opts:['10','12','14','16'],ans:1},
            {id:'p4',cat:'pattern',catN:{ko:'íŒ¨í„´',en:'Pattern'},diff:2,q:{ko:'ë„í˜• ë³€í™” ê·œì¹™ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find shape change pattern.'},type:'matrix',matrix:['â—‹','â—','â—','â–¡','â—§','â– ','â–³','â—®','?'],opts:['â–³','â–²','â—®','â—‹'],ans:1},
            {id:'p5',cat:'pattern',catN:{ko:'íŒ¨í„´',en:'Pattern'},diff:3,q:{ko:'ë³µì¡í•œ ê·œì¹™ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find complex pattern.'},type:'matrix',matrix:['1','1','1','2','4','8','3','9','?'],opts:['12','18','27','36'],ans:2},
            {id:'p6',cat:'pattern',catN:{ko:'íŒ¨í„´',en:'Pattern'},diff:3,q:{ko:'ì•ŒíŒŒë²³ íŒ¨í„´ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find alphabet pattern.'},type:'matrix',matrix:['A','C','E','B','D','F','C','E','?'],opts:['F','G','H','I'],ans:1}
        ],
        numerical: [
            {id:'n1',cat:'numerical',catN:{ko:'ìˆ˜ë¦¬',en:'Numerical'},diff:1,q:{ko:'ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”.',en:'Find the next term.'},type:'seq',seq:[2,4,6,8,'?'],opts:['9','10','11','12'],ans:1},
            {id:'n2',cat:'numerical',catN:{ko:'ìˆ˜ë¦¬',en:'Numerical'},diff:1,q:{ko:'ìˆ˜ì—´ì˜ ê·œì¹™ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find sequence pattern.'},type:'seq',seq:[5,10,15,20,'?'],opts:['22','25','30','35'],ans:1},
            {id:'n3',cat:'numerical',catN:{ko:'ìˆ˜ë¦¬',en:'Numerical'},diff:2,q:{ko:'í”¼ë³´ë‚˜ì¹˜ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Fibonacci sequence.'},type:'seq',seq:[1,1,2,3,5,8,'?'],opts:['11','12','13','15'],ans:2},
            {id:'n4',cat:'numerical',catN:{ko:'ìˆ˜ë¦¬',en:'Numerical'},diff:2,q:{ko:'ë“±ë¹„ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Geometric sequence.'},type:'seq',seq:[3,6,12,24,'?'],opts:['36','48','30','42'],ans:1},
            {id:'n5',cat:'numerical',catN:{ko:'ìˆ˜ë¦¬',en:'Numerical'},diff:3,q:{ko:'ì œê³±ìˆ˜ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Square number sequence.'},type:'seq',seq:[1,4,9,16,25,'?'],opts:['30','35','36','49'],ans:2},
            {id:'n6',cat:'numerical',catN:{ko:'ìˆ˜ë¦¬',en:'Numerical'},diff:3,q:{ko:'ì°¨ì´ê°€ ì¦ê°€í•˜ëŠ” ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Increasing difference sequence.'},type:'seq',seq:[2,6,12,20,30,'?'],opts:['40','42','44','56'],ans:1}
        ],
        spatial: [
            {id:'s1',cat:'spatial',catN:{ko:'ê³µê°„',en:'Spatial'},diff:1,q:{ko:'â”˜ë¥¼ ì‹œê³„ë°©í–¥ 90Â° íšŒì „í•˜ë©´?',en:'Rotate â”˜ clockwise 90Â°?'},type:'text',opts:['â””','â”','â”Œ','â”€'],ans:0},
            {id:'s2',cat:'spatial',catN:{ko:'ê³µê°„',en:'Spatial'},diff:1,q:{ko:'ê±°ìš¸ì— ë¹„ì¹œ "F"ëŠ”?',en:'Mirror image of "F"?'},type:'text',opts:{ko:['F','á¸ (ë°˜ì „)','d','ã…‹'],en:['F','á¸ (flipped)','d','K']},ans:1},
            {id:'s3',cat:'spatial',catN:{ko:'ê³µê°„',en:'Spatial'},diff:2,q:{ko:'ì •ìœ¡ë©´ì²´ ì „ê°œë„ì—ì„œ 1ì˜ ë§ì€í¸ì€?',en:'Opposite face of 1 in cube net?'},type:'text',opts:['2','4','5','6'],ans:3},
            {id:'s4',cat:'spatial',catN:{ko:'ê³µê°„',en:'Spatial'},diff:2,q:{ko:'ì™¼ìª½ìœ„ì— ì›ì´ ìˆëŠ” ì‚¬ê°í˜•ì„ 180Â° íšŒì „í•˜ë©´?',en:'Rotate square (circle top-left) 180Â°?'},type:'text',opts:{ko:['ì™¼ìª½ ìœ„','ì˜¤ë¥¸ìª½ ìœ„','ì™¼ìª½ ì•„ë˜','ì˜¤ë¥¸ìª½ ì•„ë˜'],en:['Top-left','Top-right','Bottom-left','Bottom-right']},ans:3},
            {id:'s5',cat:'spatial',catN:{ko:'ê³µê°„',en:'Spatial'},diff:3,q:{ko:'ì§ê°ì‚¼ê°í˜• 2ê°œ + ì •ì‚¬ê°í˜• 1ê°œ = ?',en:'2 right triangles + 1 square = ?'},type:'text',opts:{ko:['ì •ì‚¬ê°í˜•','ì§ì‚¬ê°í˜•','í‰í–‰ì‚¬ë³€í˜•','ì‚¬ë‹¤ë¦¬ê¼´'],en:['Square','Rectangle','Parallelogram','Trapezoid']},ans:1},
            {id:'s6',cat:'spatial',catN:{ko:'ê³µê°„',en:'Spatial'},diff:3,q:{ko:'ì •ìœ¡ë©´ì²´ ëŒ€ê°ì„  ì ˆë‹¨ ë‹¨ë©´ì€?',en:'Cross-section of diagonal cube cut?'},type:'text',opts:{ko:['ì •ì‚¼ê°í˜•','ì •ì‚¬ê°í˜•','ì§ì‚¬ê°í˜•','ì •ìœ¡ê°í˜•'],en:['Equilateral triangle','Square','Rectangle','Regular hexagon']},ans:3}
        ],
        logical: [
            {id:'l1',cat:'logical',catN:{ko:'ë…¼ë¦¬',en:'Logic'},diff:1,q:{ko:'ëª¨ë“  ê°œëŠ” ë™ë¬¼. ë°”ë‘‘ì´ëŠ” ê°œ. ì°¸ì¸ ê²ƒì€?',en:'All dogs are animals. Baduk is a dog. True statement?'},type:'text',opts:{ko:['ëª¨ë“  ë™ë¬¼ì€ ê°œ','ë°”ë‘‘ì´ëŠ” ë™ë¬¼','ë°”ë‘‘ì´ëŠ” ê³ ì–‘ì´ ì•„ë‹˜','ëª¨ë“  ë™ë¬¼ì€ ë°”ë‘‘ì´'],en:['All animals are dogs','Baduk is animal','Baduk is not cat','All animals are Baduk']},ans:1},
            {id:'l2',cat:'logical',catN:{ko:'ë…¼ë¦¬',en:'Logic'},diff:1,q:{ko:'A>B, B>C. ê°€ì¥ ì‘ì€ ê²ƒì€?',en:'A>B, B>C. Smallest?'},type:'text',opts:['A','B','C',{ko:'ì•Œ ìˆ˜ ì—†ìŒ',en:'Unknown'}],ans:2},
            {id:'l3',cat:'logical',catN:{ko:'ë…¼ë¦¬',en:'Logic'},diff:2,q:{ko:'"ë¹„ê°€ ì˜¤ë©´ ë•…ì´ ì –ëŠ”ë‹¤"ì˜ ëŒ€ìš°ëŠ”?',en:'Contrapositive of "If rain, ground wet"?'},type:'text',opts:{ko:['ì –ìœ¼ë©´ ë¹„','ì•ˆ ì˜¤ë©´ ì•ˆ ì –ìŒ','ì•ˆ ì –ìœ¼ë©´ ì•ˆ ì˜´','ì –ì–´ë„ ì•ˆ ì˜¬ ìˆ˜ ìˆìŒ'],en:['Wet then rain','No rain no wet','Not wet no rain','Wet without rain']},ans:2},
            {id:'l4',cat:'logical',catN:{ko:'ë…¼ë¦¬',en:'Logic'},diff:2,q:{ko:'A>B, C>A, D<B. ê°€ì¥ í° ê²ƒì€?',en:'A>B, C>A, D<B. Largest?'},type:'text',opts:['A','B','C','D'],ans:2},
            {id:'l5',cat:'logical',catN:{ko:'ë…¼ë¦¬',en:'Logic'},diff:3,q:{ko:'(x+5)Ã·3=4. xëŠ”?',en:'(x+5)Ã·3=4. x=?'},type:'text',opts:['5','6','7','8'],ans:2},
            {id:'l6',cat:'logical',catN:{ko:'ë…¼ë¦¬',en:'Logic'},diff:3,q:{ko:'5ëª… ì¤„ì„œê¸°: Aâ‰ ë§¨ì•, BëŠ” Cë’¤, D=ë§¨ë’¤, EëŠ” Aì•. ë§¨ì•ì€?',en:'5 people line: Aâ‰ first, B behind C, D=last, E before A. First?'},type:'text',opts:['A','B','C','E'],ans:3}
        ],
        verbal: [
            {id:'v1',cat:'verbal',catN:{ko:'ì–¸ì–´',en:'Verbal'},diff:1,q:{ko:'ì±…:ì½ë‹¤ = ìŒì•…:?',en:'Book:Read = Music:?'},type:'analogy',an:{ko:['ì±…','ì½ë‹¤','ìŒì•…','?'],en:['Book','Read','Music','?']},opts:{ko:['ì•…ê¸°','ë“£ë‹¤','ê°€ìˆ˜','ì½˜ì„œíŠ¸'],en:['Instrument','Listen','Singer','Concert']},ans:1},
            {id:'v2',cat:'verbal',catN:{ko:'ì–¸ì–´',en:'Verbal'},diff:1,q:{ko:'ì—¬ë¦„:ë¥ë‹¤ = ê²¨ìš¸:?',en:'Summer:Hot = Winter:?'},type:'analogy',an:{ko:['ì—¬ë¦„','ë¥ë‹¤','ê²¨ìš¸','?'],en:['Summer','Hot','Winter','?']},opts:{ko:['ëˆˆ','ì¶¥ë‹¤','ì½”íŠ¸','ë‚œë°©'],en:['Snow','Cold','Coat','Heating']},ans:1},
            {id:'v3',cat:'verbal',catN:{ko:'ì–¸ì–´',en:'Verbal'},diff:2,q:{ko:'ì˜ì‚¬:ë³‘ì› = êµì‚¬:?',en:'Doctor:Hospital = Teacher:?'},type:'analogy',an:{ko:['ì˜ì‚¬','ë³‘ì›','êµì‚¬','?'],en:['Doctor','Hospital','Teacher','?']},opts:{ko:['í•™ìƒ','í•™êµ','êµì‹¤','êµìœ¡'],en:['Student','School','Classroom','Education']},ans:1},
            {id:'v4',cat:'verbal',catN:{ko:'ì–¸ì–´',en:'Verbal'},diff:2,q:{ko:'ì†:ì¥ê°‘ = ë¨¸ë¦¬:?',en:'Hand:Glove = Head:?'},type:'analogy',an:{ko:['ì†','ì¥ê°‘','ë¨¸ë¦¬','?'],en:['Hand','Glove','Head','?']},opts:{ko:['ëª¨ì','ì–¼êµ´','ë‘ë‡Œ','ë¨¸ë¦¬ì¹´ë½'],en:['Hat','Face','Brain','Hair']},ans:0},
            {id:'v5',cat:'verbal',catN:{ko:'ì–¸ì–´',en:'Verbal'},diff:3,q:{ko:'ë¹›:ì–´ë‘  = ì§€ì‹:?',en:'Light:Darkness = Knowledge:?'},type:'analogy',an:{ko:['ë¹›','ì–´ë‘ ','ì§€ì‹','?'],en:['Light','Darkness','Knowledge','?']},opts:{ko:['í•™êµ','ë¬´ì§€','ì±…','ê³µë¶€'],en:['School','Ignorance','Book','Study']},ans:1},
            {id:'v6',cat:'verbal',catN:{ko:'ì–¸ì–´',en:'Verbal'},diff:3,q:{ko:'ë‚˜ë¬´:ìˆ² = ë³„:?',en:'Tree:Forest = Star:?'},type:'analogy',an:{ko:['ë‚˜ë¬´','ìˆ²','ë³„','?'],en:['Tree','Forest','Star','?']},opts:{ko:['í•˜ëŠ˜','ì€í•˜','ë‹¬','ìš°ì£¼'],en:['Sky','Galaxy','Moon','Universe']},ans:1}
        ]
    };
    
    const mensaQ = [
        {id:'m1',diff:2,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ê·œì¹™ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find pattern.'},type:'matrix',matrix:['â—','â—â—','â—â—â—','â– ','â– â– ','â– â– â– ','â–²','â–²â–²','?'],opts:['â–²','â–²â–²â–²','â– â– â– ','â—â—â—'],ans:1},
        {id:'m2',diff:2,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ë„í˜• ë³€í™” ê·œì¹™ì„ ì°¾ìœ¼ì„¸ìš”.',en:'Find shape changes.'},type:'matrix',matrix:['â—‹','â—','â—','â–¡','â—§','â– ','â–³','â—®','?'],opts:['â–³','â–²','â—®','â—‹'],ans:1},
        {id:'m3',diff:3,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'ì œê³±ìˆ˜ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Square sequence.'},type:'seq',seq:[1,4,9,16,25,'?'],opts:['30','36','42','49'],ans:1},
        {id:'m4',diff:3,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ê±°ë“­ì œê³± íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Power pattern.'},type:'matrix',matrix:['2','4','8','3','9','27','4','16','?'],opts:['32','48','64','256'],ans:2},
        {id:'m5',diff:3,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ìˆ«ì íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Number pattern.'},type:'matrix',matrix:['1','2','3','4','5','6','7','8','?'],opts:['9','10','0','12'],ans:0},
        {id:'m6',diff:4,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'ì‚¼ê°ìˆ˜ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Triangular numbers.'},type:'seq',seq:[1,3,6,10,15,'?'],opts:['18','20','21','25'],ans:2},
        {id:'m7',diff:4,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'ì†Œìˆ˜ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Prime numbers.'},type:'seq',seq:[2,3,5,7,11,13,'?'],opts:['15','17','19','21'],ans:1},
        {id:'m8',diff:4,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ì•ŒíŒŒë²³-ìˆ«ì íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Alphanumeric pattern.'},type:'matrix',matrix:['A1','B2','C3','D4','E5','F6','G7','H8','?'],opts:['I9','J9','I10','J10'],ans:0},
        {id:'m9',diff:4,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ìƒ‰ìƒ íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Color pattern.'},type:'matrix',matrix:['ğŸ”´','ğŸ”µ','ğŸŸ¢','ğŸ”µ','ğŸŸ¢','ğŸ”´','ğŸŸ¢','ğŸ”´','?'],opts:['ğŸ”´','ğŸ”µ','ğŸŸ¢','ğŸŸ¡'],ans:1},
        {id:'m10',diff:4,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'í”¼ë³´ë‚˜ì¹˜ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Fibonacci sequence.'},type:'seq',seq:[1,1,2,3,5,8,13,21,'?'],opts:['29','34','36','42'],ans:1},
        {id:'m11',diff:5,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ê³±ì…ˆ ê·œì¹™ì…ë‹ˆë‹¤.',en:'Multiplication rule.'},type:'matrix',matrix:['2','3','6','4','5','20','6','7','?'],opts:['13','36','42','48'],ans:2},
        {id:'m12',diff:5,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'n^n ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'n^n sequence.'},type:'seq',seq:[1,4,27,256,'?'],opts:['625','1024','3125','4096'],ans:2},
        {id:'m13',diff:5,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ì„¸ì œê³±ìˆ˜ì…ë‹ˆë‹¤.',en:'Cube numbers.'},type:'matrix',matrix:['1','8','27','64','125','216','343','512','?'],opts:['625','729','1000','1024'],ans:1},
        {id:'m14',diff:5,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ë§ì…ˆ ê·œì¹™ì…ë‹ˆë‹¤.',en:'Addition rule.'},type:'matrix',matrix:['1','2','3','4','5','9','5','7','?'],opts:['10','11','12','14'],ans:2},
        {id:'m15',diff:5,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'ë³µì¡í•œ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Complex sequence.'},type:'seq',seq:[0,1,1,2,4,7,13,'?'],opts:['20','22','24','26'],ans:2},
        {id:'m16',diff:4,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'í¬ê¸° ë³€í™” íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Size change pattern.'},type:'matrix',matrix:['â€¢','â—','â¬¤','â–ª','â– ','â¬›','â–´','â–²','?'],opts:['â–´','â–²','â¶','â–³'],ans:2},
        {id:'m17',diff:4,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'ì°¨ì´ ì¦ê°€ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Increasing difference.'},type:'seq',seq:[2,3,5,8,12,17,'?'],opts:['22','23','24','25'],ans:1},
        {id:'m18',diff:5,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ëŒ€ê°ì„  íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Diagonal pattern.'},type:'matrix',matrix:['1','3','6','2','5','9','4','8','?'],opts:['10','12','13','15'],ans:2},
        {id:'m19',diff:5,catN:{ko:'ìˆ˜ì—´',en:'Series'},q:{ko:'íŒ©í† ë¦¬ì–¼ ìˆ˜ì—´ì…ë‹ˆë‹¤.',en:'Factorial sequence.'},type:'seq',seq:[1,2,6,24,120,'?'],opts:['240','480','720','840'],ans:2},
        {id:'m20',diff:5,catN:{ko:'í–‰ë ¬',en:'Matrix'},q:{ko:'ì¢…í•© íŒ¨í„´ì…ë‹ˆë‹¤.',en:'Comprehensive pattern.'},type:'matrix',matrix:['2','6','18','4','12','36','8','24','?'],opts:['48','64','72','96'],ans:2}
    ];
    
    // ========== STATE ==========
    let bIdx=0, bQs=[], bAns=[], bTimes=[], bTimer=null, bTimeLeft=45, bStart=null, bTestStart=null;
    const B_MAX=45, B_TOTAL=30;
    let mIdx=0, mQs=[], mAns=[], mTimes=[], mTimer=null, mTimeLeft=60, mStart=null, mTestStart=null;
    const M_MAX=60, M_TOTAL=20;
    let qualCode='', qualIQ=0, validCodes=[], exitMode='';
    
    // ========== UTILS ==========
    function shuffle(a){const n=[...a];for(let i=n.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[n[i],n[j]]=[n[j],n[i]];}return n;}
    function show(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
    function genCode(){const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';let r='CQ-';for(let i=0;i<8;i++)r+=c[Math.floor(Math.random()*c.length)];return r;}
    function fmtDate(d){return `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;}
    function getLoc(o){return typeof o==='string'?o:(o[lang]||o.ko||o);}
    function getOpts(o){return Array.isArray(o)?o.map(x=>getLoc(x)):getLoc(o);}
    
    // ========== NAV ==========
    function goHome(){
        if(document.getElementById('basicTestSection').classList.contains('active')||document.getElementById('mensaTestSection').classList.contains('active')){
            showExitModal(document.getElementById('mensaTestSection').classList.contains('active')?'mensa':'basic');
        }else restart();
    }
    function showExitModal(m){exitMode=m;document.getElementById('exitModal').classList.add('active');}
    function closeModal(){document.getElementById('exitModal').classList.remove('active');}
    function confirmExit(){closeModal();clearInterval(bTimer);clearInterval(mTimer);restart();}
    function restart(){
        clearInterval(bTimer);clearInterval(mTimer);
        document.getElementById('bgPattern').classList.remove('mensa');
        document.getElementById('logoIcon').classList.remove('gold');
        document.getElementById('mainTitle').textContent=t('title.main');
        document.getElementById('mainTitle').classList.remove('gold');
        document.getElementById('mainSubtitle').textContent=t('title.sub');
        show('introSection');
    }
    
    // ========== CODE VERIFY ==========
    function verifyCode(){
        const inp=document.getElementById('codeInput').value.trim().toUpperCase();
        const err=document.getElementById('codeError');
        if(validCodes.includes(inp)||inp==='CQ-TESTCODE'){
            err.style.display='none';qualCode=inp;startMensaTest();
        }else err.style.display='block';
    }
    
    // ========== BASIC TEST ==========
    function startBasicTest(){
        const cats=['pattern','numerical','spatial','logical','verbal'];
        bQs=[];cats.forEach(c=>bQs.push(...shuffle([...basicQ[c]])));
        bQs=shuffle(bQs).slice(0,B_TOTAL);
        bAns=Array(B_TOTAL).fill(null);bTimes=Array(B_TOTAL).fill(null);bTestStart=Date.now();
        document.getElementById('bTotalQ').textContent=B_TOTAL;
        show('basicTestSection');loadBasicQ(0);
    }
    function loadBasicQ(i){
        bIdx=i;const q=bQs[i];
        document.getElementById('bCurQ').textContent=i+1;
        document.getElementById('bProgBar').style.width=`${((i+1)/B_TOTAL)*100}%`;
        document.getElementById('bCatBadge').textContent=getLoc(q.catN);
        const db=document.getElementById('bDiffBadge');db.className='badge';
        if(q.diff===1){db.classList.add('badge-easy');db.textContent=t('diff.easy');}
        else if(q.diff===2){db.classList.add('badge-medium');db.textContent=t('diff.medium');}
        else{db.classList.add('badge-hard');db.textContent=t('diff.hard');}
        document.getElementById('bQText').textContent=getLoc(q.q);
        document.getElementById('bVisual').innerHTML=renderVisual(q);
        const opts=getOpts(q.opts);
        const mk=['A','B','C','D'];
        document.getElementById('bOptions').innerHTML=opts.map((o,j)=>`<div class="option" onclick="selBasic(${j})" data-i="${j}"><span class="option-marker">${mk[j]}</span><span class="option-text">${o}</span></div>`).join('');
        if(bAns[i]!==null){document.querySelector(`#bOptions [data-i="${bAns[i]}"]`)?.classList.add('selected');document.getElementById('bNextBtn').disabled=false;}
        else document.getElementById('bNextBtn').disabled=true;
        startBTimer();bStart=Date.now();
    }
    function renderVisual(q){
        if(q.type==='matrix'&&q.matrix){
            return `<div class="matrix-box"><div class="matrix-grid">${q.matrix.map(c=>`<div class="matrix-cell ${c==='?'?'empty':''}">${c==='?'?'':c}</div>`).join('')}</div></div>`;
        }
        if(q.type==='seq'&&q.seq){
            return `<div class="sequence-box">${q.seq.map((s,i)=>`<div class="seq-item ${s==='?'?'unknown':''}">${s}</div>${i<q.seq.length-1?'<span class="seq-arrow">â†’</span>':''}`).join('')}</div>`;
        }
        if(q.type==='analogy'&&q.an){
            const a=getOpts(q.an);
            return `<div class="analogy-box"><span class="analogy-item">${a[0]}</span><span class="analogy-sep">:</span><span class="analogy-item">${a[1]}</span><span class="analogy-sep">=</span><span class="analogy-item">${a[2]}</span><span class="analogy-sep">:</span><span class="analogy-item unknown">?</span></div>`;
        }
        return '';
    }
    function startBTimer(){
        clearInterval(bTimer);bTimeLeft=B_MAX;
        document.getElementById('bTimerTxt').textContent=bTimeLeft;
        document.getElementById('bTimerProg').style.strokeDashoffset=0;
        const circ=2*Math.PI*20;
        bTimer=setInterval(()=>{
            bTimeLeft--;
            document.getElementById('bTimerTxt').textContent=bTimeLeft;
            document.getElementById('bTimerProg').style.strokeDashoffset=(1-bTimeLeft/B_MAX)*circ;
            const ring=document.getElementById('bTimerRing');
            ring.classList.remove('warning','danger');
            if(bTimeLeft<=10)ring.classList.add('danger');
            else if(bTimeLeft<=20)ring.classList.add('warning');
            if(bTimeLeft<=0){clearInterval(bTimer);autoNextB();}
        },1000);
    }
    function selBasic(j){
        document.querySelectorAll('#bOptions .option').forEach(o=>o.classList.remove('selected'));
        document.querySelector(`#bOptions [data-i="${j}"]`).classList.add('selected');
        bAns[bIdx]=j;bTimes[bIdx]=Date.now()-bStart;
        document.getElementById('bNextBtn').disabled=false;
    }
    function nextBasic(){clearInterval(bTimer);if(bIdx<B_TOTAL-1)loadBasicQ(bIdx+1);else showBasicRes();}
    function skipBasic(){clearInterval(bTimer);bTimes[bIdx]=B_MAX*1000;if(bIdx<B_TOTAL-1)loadBasicQ(bIdx+1);else showBasicRes();}
    function autoNextB(){bTimes[bIdx]=B_MAX*1000;if(bIdx<B_TOTAL-1)loadBasicQ(bIdx+1);else showBasicRes();}
    
    function calcBasicRes(){
        const cs={pattern:{c:0,t:0},numerical:{c:0,t:0},spatial:{c:0,t:0},logical:{c:0,t:0},verbal:{c:0,t:0}};
        let tc=0,ws=0,mw=0;
        bQs.forEach((q,i)=>{
            cs[q.cat].t++;mw+=q.diff;
            if(bAns[i]===q.ans){
                cs[q.cat].c++;tc++;
                const tr=Math.max(0,1-(bTimes[i]/(B_MAX*1000)));
                ws+=q.diff*(1+tr*0.15);
            }
        });
        const rr=ws/mw,z=(rr-0.45)*4.5;
        let iq=Math.round(100+z*15);iq=Math.max(55,Math.min(145,iq));
        const vt=bTimes.filter(x=>x&&x<B_MAX*1000);
        const avg=vt.length?Math.round(vt.reduce((a,b)=>a+b,0)/vt.length/1000):0;
        const tot=Math.round((Date.now()-bTestStart)/60000);
        return {iq,cs,tc,acc:Math.round((tc/B_TOTAL)*100),avg,tot};
    }
    function getIQClass(iq){
        if(iq>=130)return{l:t('class.veryS'),d:lang==='ko'?'ìƒìœ„ 2% ì´ë‚´ì˜ ë›°ì–´ë‚œ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Outstanding cognitive ability (top 2%).',p:98};
        if(iq>=120)return{l:t('class.sup'),d:lang==='ko'?'ìƒìœ„ 10% ì´ë‚´ì˜ ìš°ìˆ˜í•œ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Excellent cognitive ability (top 10%).',p:91};
        if(iq>=110)return{l:t('class.hAvg'),d:lang==='ko'?'í‰ê·  ì´ìƒì˜ ì¢‹ì€ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Good cognitive ability above average.',p:75};
        if(iq>=90)return{l:t('class.avg'),d:lang==='ko'?'ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì˜ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Normal cognitive ability level.',p:50};
        if(iq>=80)return{l:t('class.lAvg'),d:lang==='ko'?'í‰ê· ë³´ë‹¤ ì•½ê°„ ë‚®ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤.':'Slightly below average.',p:25};
        return{l:t('class.border'),d:lang==='ko'?'ê²½ê³„ì„  ìˆ˜ì¤€ì…ë‹ˆë‹¤.':'Borderline level.',p:9};
    }
    function showBasicRes(){
        show('basicResultsSection');
        const r=calcBasicRes(),cl=getIQClass(r.iq);
        document.getElementById('bIQ').textContent=r.iq;
        const norm=Math.min(Math.max((r.iq-55)/90,0),1);
        const circ=2*Math.PI*88;
        setTimeout(()=>document.getElementById('bScoreProg').style.strokeDashoffset=circ*(1-norm),100);
        document.getElementById('bClassLabel').textContent=cl.l;
        document.getElementById('bClassDesc').textContent=cl.d;
        document.getElementById('bPercentile').textContent=lang==='ko'?`ìƒìœ„ ${100-cl.p}% (ë°±ë¶„ìœ„ ${cl.p})`:`Top ${100-cl.p}% (Percentile ${cl.p})`;
        document.getElementById('bCorrect').textContent=r.tc;
        document.getElementById('bAccuracy').textContent=r.acc+'%';
        document.getElementById('bAvgTime').textContent=r.avg+'s';
        document.getElementById('bTotalTime').textContent=r.tot+'m';
        setTimeout(()=>{
            ['pattern','numerical','spatial','logical','verbal'].forEach((c,i)=>{
                const s=r.cs[c],pct=s.t?(s.c/s.t)*100:0;
                const ids=['bPatternB','bNumB','bSpatialB','bLogicalB','bVerbalB'];
                const sids=['bPatternS','bNumS','bSpatialS','bLogicalS','bVerbalS'];
                document.getElementById(ids[i]).style.width=pct+'%';
                document.getElementById(sids[i]).textContent=`${s.c}/${s.t} (${Math.round(pct)}%)`;
            });
        },300);
        if(r.iq>=120){
            qualCode=genCode();qualIQ=r.iq;validCodes.push(qualCode);
            document.getElementById('certSection').style.display='block';
            document.getElementById('notQualSection').style.display='none';
            document.getElementById('mensaBtn').style.display='inline-flex';
            document.getElementById('certIQ').textContent=r.iq;
            document.getElementById('certDate').textContent=fmtDate(new Date());
            document.getElementById('certCode').textContent=qualCode;
            document.getElementById('bClassBox').classList.add('gold');
            document.getElementById('bClassLabel').classList.add('gold');
            document.getElementById('bIQ').classList.add('gold');
            document.getElementById('bScoreProg').setAttribute('stroke','url(#goldGrad)');
        }else{
            document.getElementById('certSection').style.display='none';
            document.getElementById('notQualSection').style.display='block';
            document.getElementById('mensaBtn').style.display='none';
            document.getElementById('bClassBox').classList.remove('gold');
            document.getElementById('bClassLabel').classList.remove('gold');
            document.getElementById('bIQ').classList.remove('gold');
        }
    }
    function sendEmail(){
        const em=document.getElementById('emailInput').value.trim();
        if(!em||!em.includes('@')){alert(lang==='ko'?'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.':'Please enter valid email.');return;}
        console.log('Email:',em,'Code:',qualCode,'IQ:',qualIQ);
        document.getElementById('emailOK').style.display='flex';
        setTimeout(()=>document.getElementById('emailOK').style.display='none',4000);
    }
    
    // ========== MENSA TEST ==========
    function startMensaTest(){
        document.getElementById('bgPattern').classList.add('mensa');
        document.getElementById('logoIcon').classList.add('gold');
        document.getElementById('mainTitle').textContent=t('title.mensa');
        document.getElementById('mainTitle').classList.add('gold');
        document.getElementById('mainSubtitle').textContent=t('title.mensaSub');
        mQs=shuffle([...mensaQ]).slice(0,M_TOTAL);
        mAns=Array(M_TOTAL).fill(null);mTimes=Array(M_TOTAL).fill(null);mTestStart=Date.now();
        document.getElementById('mTotalQ').textContent=M_TOTAL;
        show('mensaTestSection');loadMensaQ(0);
    }
    function loadMensaQ(i){
        mIdx=i;const q=mQs[i];
        document.getElementById('mCurQ').textContent=i+1;
        document.getElementById('mProgBar').style.width=`${((i+1)/M_TOTAL)*100}%`;
        document.getElementById('mCatBadge').textContent=getLoc(q.catN);
        const db=document.getElementById('mDiffBadge');db.className='badge';
        if(q.diff<=3){db.classList.add('badge-hard');db.textContent=t('diff.hard');}
        else{db.classList.add('badge-extreme');db.textContent=t('diff.extreme');}
        document.getElementById('mQText').textContent=getLoc(q.q);
        document.getElementById('mVisual').innerHTML=renderMVisual(q);
        const mk=['A','B','C','D'];
        document.getElementById('mOptions').innerHTML=q.opts.map((o,j)=>`<div class="option gold" onclick="selMensa(${j})" data-i="${j}"><span class="option-marker">${mk[j]}</span><span class="option-text">${o}</span></div>`).join('');
        if(mAns[i]!==null){document.querySelector(`#mOptions [data-i="${mAns[i]}"]`)?.classList.add('selected');document.getElementById('mNextBtn').disabled=false;}
        else document.getElementById('mNextBtn').disabled=true;
        startMTimer();mStart=Date.now();
    }
    function renderMVisual(q){
        if(q.type==='matrix'&&q.matrix){
            return `<div class="matrix-box"><div class="matrix-grid">${q.matrix.map(c=>`<div class="matrix-cell ${c==='?'?'empty gold':''}">${c==='?'?'':c}</div>`).join('')}</div></div>`;
        }
        if(q.type==='seq'&&q.seq){
            return `<div class="sequence-box">${q.seq.map((s,i)=>`<div class="seq-item ${s==='?'?'unknown':''}">${s}</div>${i<q.seq.length-1?'<span class="seq-arrow">â†’</span>':''}`).join('')}</div>`;
        }
        return '';
    }
    function startMTimer(){
        clearInterval(mTimer);mTimeLeft=M_MAX;
        document.getElementById('mTimerTxt').textContent=mTimeLeft;
        document.getElementById('mTimerProg').style.strokeDashoffset=0;
        const circ=2*Math.PI*20;
        mTimer=setInterval(()=>{
            mTimeLeft--;
            document.getElementById('mTimerTxt').textContent=mTimeLeft;
            document.getElementById('mTimerProg').style.strokeDashoffset=(1-mTimeLeft/M_MAX)*circ;
            const ring=document.getElementById('mTimerRing');
            ring.classList.remove('warning','danger');
            if(mTimeLeft<=15)ring.classList.add('danger');
            else if(mTimeLeft<=30)ring.classList.add('warning');
            if(mTimeLeft<=0){clearInterval(mTimer);autoNextM();}
        },1000);
    }
    function selMensa(j){
        document.querySelectorAll('#mOptions .option').forEach(o=>o.classList.remove('selected'));
        document.querySelector(`#mOptions [data-i="${j}"]`).classList.add('selected');
        mAns[mIdx]=j;mTimes[mIdx]=Date.now()-mStart;
        document.getElementById('mNextBtn').disabled=false;
    }
    function nextMensa(){clearInterval(mTimer);if(mIdx<M_TOTAL-1)loadMensaQ(mIdx+1);else showMensaRes();}
    function skipMensa(){clearInterval(mTimer);mTimes[mIdx]=M_MAX*1000;if(mIdx<M_TOTAL-1)loadMensaQ(mIdx+1);else showMensaRes();}
    function autoNextM(){mTimes[mIdx]=M_MAX*1000;if(mIdx<M_TOTAL-1)loadMensaQ(mIdx+1);else showMensaRes();}
    
    function calcMensaRes(){
        let tc=0,ws=0,mw=0;
        mQs.forEach((q,i)=>{
            mw+=q.diff;
            if(mAns[i]===q.ans){
                tc++;
                const tr=Math.max(0,1-(mTimes[i]/(M_MAX*1000)));
                ws+=q.diff*(1+tr*0.1);
            }
        });
        const rr=ws/mw,z=(rr-0.35)*5;
        let iq=Math.round(115+z*15);iq=Math.max(100,Math.min(160,iq));
        const vt=mTimes.filter(x=>x&&x<M_MAX*1000);
        const avg=vt.length?Math.round(vt.reduce((a,b)=>a+b,0)/vt.length/1000):0;
        return{iq,tc,acc:Math.round((tc/M_TOTAL)*100),avg};
    }
    function getMensaClass(iq){
        if(iq>=148)return{l:t('class.genius'),d:lang==='ko'?'ìƒìœ„ 0.1%ì˜ ê·¹íˆ í¬ê·€í•œ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Extremely rare (top 0.1%).',p:99.9};
        if(iq>=140)return{l:t('class.hGift'),d:lang==='ko'?'ìƒìœ„ 0.5%ì˜ ë›°ì–´ë‚œ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Outstanding (top 0.5%).',p:99.5};
        if(iq>=130)return{l:t('class.mensa'),d:lang==='ko'?'ì¶•í•˜í•©ë‹ˆë‹¤! ìƒìœ„ 2%ë¡œ ë©˜ì‚¬ ìê²©ì— í•´ë‹¹í•©ë‹ˆë‹¤.':'Congratulations! Mensa qualification (top 2%).',p:98};
        if(iq>=120)return{l:t('class.sup'),d:lang==='ko'?'ìƒìœ„ 10%ì˜ ìš°ìˆ˜í•œ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Excellent (top 10%).',p:91};
        if(iq>=110)return{l:t('class.hAvg'),d:lang==='ko'?'í‰ê·  ì´ìƒì˜ ì¢‹ì€ ì¸ì§€ëŠ¥ë ¥ì…ë‹ˆë‹¤.':'Good, above average.',p:75};
        return{l:t('class.avg'),d:lang==='ko'?'ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì…ë‹ˆë‹¤.':'Normal level.',p:50};
    }
    function showMensaRes(){
        show('mensaResultsSection');
        const r=calcMensaRes(),cl=getMensaClass(r.iq);
        document.getElementById('mIQ').textContent=r.iq;
        const norm=Math.min(Math.max((r.iq-100)/60,0),1);
        const circ=2*Math.PI*88;
        setTimeout(()=>document.getElementById('mScoreProg').style.strokeDashoffset=circ*(1-norm),100);
        document.getElementById('mClassLabel').textContent=cl.l;
        document.getElementById('mClassDesc').textContent=cl.d;
        document.getElementById('mPercentile').textContent=lang==='ko'?`ìƒìœ„ ${(100-cl.p).toFixed(1)}% (ë°±ë¶„ìœ„ ${cl.p})`:`Top ${(100-cl.p).toFixed(1)}% (Percentile ${cl.p})`;
        document.getElementById('mCorrect').textContent=r.tc;
        document.getElementById('mAccuracy').textContent=r.acc+'%';
        document.getElementById('mAvgTime').textContent=r.avg+'s';
        if(r.iq>=130){
            document.getElementById('mensaPassSection').style.display='block';
            document.getElementById('mCertIQ').textContent=r.iq;
            document.getElementById('mCertPct').textContent=cl.p+'%';
        }else document.getElementById('mensaPassSection').style.display='none';
    }
    function retryMensa(){if(qualCode||validCodes.length)startMensaTest();}
    </script>
</body>
</html>
