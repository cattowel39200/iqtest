<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COGNIQ - Official IQ Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
        }
        
        body {
            font-family: 'Noto Sans KR', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #94a3b8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Cards */
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #f1f5f9;
        }
        
        /* Buttons */
        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e2e8f0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        /* Age Input Section */
        .age-section {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .age-input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .age-input-group label {
            font-weight: 500;
            color: #94a3b8;
            font-size: 1.1rem;
        }
        
        .age-input-group input {
            width: 100px;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            background: rgba(0,0,0,0.2);
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .age-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .age-note {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        /* Info Box */
        .info-box {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info-box.highlight {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(124, 58, 237, 0.15));
            border-color: rgba(124, 58, 237, 0.3);
        }
        
        /* Test Info Grid */
        .test-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .test-info-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .test-info-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .test-info-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }
        
        .test-info-label {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-top: 5px;
        }
        
        /* Progress Bar */
        .progress-container {
            margin-bottom: 25px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        /* Domain Indicator */
        .domain-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.85rem;
            color: #94a3b8;
        }
        
        /* Timer */
        .timer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 20px;
        }
        
        .timer.warning {
            color: var(--warning);
            animation: pulse 1s infinite;
        }
        
        .timer.danger {
            color: var(--danger);
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Question */
        .question-container {
            margin-bottom: 30px;
        }
        
        .question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 20px;
            color: #f1f5f9;
            line-height: 1.8;
        }
        
        .question-visual {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .matrix-grid {
            display: inline-grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 0 auto;
        }
        
        .matrix-cell {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .matrix-cell.highlight {
            background: rgba(37, 99, 235, 0.3);
            border: 2px solid var(--primary);
        }
        
        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .option-btn {
            padding: 18px 20px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #e2e8f0;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
        }
        
        .option-btn.selected {
            background: rgba(37, 99, 235, 0.2);
            border-color: var(--primary);
        }
        
        /* Results */
        .result-container {
            text-align: center;
        }
        
        .iq-display {
            margin: 30px 0;
        }
        
        .iq-score {
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }
        
        .iq-label {
            font-size: 1.5rem;
            color: #94a3b8;
            margin-top: 10px;
        }
        
        .confidence-interval {
            font-size: 1.1rem;
            color: #60a5fa;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(37, 99, 235, 0.1);
            border-radius: 8px;
            display: inline-block;
        }
        
        .classification {
            margin: 25px 0;
        }
        
        .class-label {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--success);
        }
        
        .percentile {
            font-size: 1rem;
            color: #94a3b8;
            margin-top: 5px;
        }
        
        /* Domain Results Chart */
        .domain-chart {
            margin: 30px 0;
            text-align: left;
        }
        
        .domain-chart h3 {
            margin-bottom: 20px;
            color: #f1f5f9;
        }
        
        .domain-bar-item {
            margin-bottom: 18px;
        }
        
        .domain-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .domain-bar-name {
            color: #e2e8f0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .domain-bar-score {
            color: #60a5fa;
            font-weight: 600;
        }
        
        .domain-bar-track {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .domain-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-out;
        }
        
        .fill-excellent { background: linear-gradient(90deg, #10b981, #34d399); }
        .fill-good { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .fill-average { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .fill-below { background: linear-gradient(90deg, #ef4444, #f87171); }
        
        /* Analysis Section */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
            text-align: left;
        }
        
        .analysis-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
        }
        
        .analysis-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #f1f5f9;
        }
        
        .analysis-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .strength-item {
            border-left: 3px solid var(--success);
        }
        
        .weakness-item {
            border-left: 3px solid var(--warning);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 5px;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: #1e293b;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #f1f5f9;
        }
        
        .modal-body {
            color: #94a3b8;
            margin-bottom: 25px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* Screen visibility */
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
            }
            .btn, .lang-toggle {
                display: none;
            }
            .card {
                background: white;
                border: 1px solid #ddd;
            }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .iq-score {
                font-size: 4rem;
            }
            
            .matrix-cell {
                width: 50px;
                height: 50px;
                font-size: 1.1rem;
            }
            
            .test-info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="lang-toggle">
        <button class="lang-btn active" onclick="setLanguage('ko')">í•œêµ­ì–´</button>
        <button class="lang-btn" onclick="setLanguage('en')">English</button>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo">COGNIQ</div>
            <p class="tagline" data-i18n="tagline">Official Intelligence Quotient Assessment</p>
        </header>

        <!-- Screen 1: Intro -->
        <div id="screen-intro" class="screen active">
            <div class="card">
                <h2 class="card-title" data-i18n="intro.title">ğŸ“Š ì¢…í•© ì¸ì§€ëŠ¥ë ¥ í‰ê°€</h2>
                
                <div class="info-box highlight">
                    <p style="text-align: center; color: #e2e8f0;" data-i18n="intro.desc">
                        ë³¸ ê²€ì‚¬ëŠ” <strong>ë¬¸í•­ë°˜ì‘ì´ë¡ (IRT)</strong>ì— ê¸°ë°˜í•œ í‘œì¤€í™”ëœ ì¸ì§€ëŠ¥ë ¥ í‰ê°€ì…ë‹ˆë‹¤.<br>
                        5ê°œ ì˜ì—­ì„ ì¢…í•©ì ìœ¼ë¡œ ì¸¡ì •í•˜ì—¬ ì •í™•í•œ IQë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
                    </p>
                </div>
                
                <!-- Test Info -->
                <div class="test-info-grid">
                    <div class="test-info-item">
                        <div class="test-info-icon">ğŸ“</div>
                        <div class="test-info-value">30</div>
                        <div class="test-info-label" data-i18n="intro.totalItems">ë¬¸í•­</div>
                    </div>
                    <div class="test-info-item">
                        <div class="test-info-icon">â±ï¸</div>
                        <div class="test-info-value">45</div>
                        <div class="test-info-label" data-i18n="intro.timePerItem">ì´ˆ/ë¬¸í•­</div>
                    </div>
                    <div class="test-info-item">
                        <div class="test-info-icon">ğŸ§ </div>
                        <div class="test-info-value">5</div>
                        <div class="test-info-label" data-i18n="intro.domains">í‰ê°€ ì˜ì—­</div>
                    </div>
                    <div class="test-info-item">
                        <div class="test-info-icon">ğŸ“ˆ</div>
                        <div class="test-info-value">IRT</div>
                        <div class="test-info-label" data-i18n="intro.method">3PL ëª¨ë¸</div>
                    </div>
                </div>
                
                <!-- Age Input -->
                <div class="age-section">
                    <div class="age-input-group">
                        <label data-i18n="intro.age">ë‚˜ì´ (ë§Œ):</label>
                        <input type="number" id="userAge" min="13" max="99" value="25" placeholder="25">
                        <span data-i18n="intro.ageUnit">ì„¸</span>
                    </div>
                    <p class="age-note" data-i18n="intro.ageNote">* ì—°ë ¹ë³„ ê·œì¤€ì„ ì ìš©í•˜ì—¬ ì •í™•í•œ IQë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.</p>
                </div>
                
                <div class="info-box" style="text-align: left;">
                    <p style="font-weight: 600; margin-bottom: 10px;" data-i18n="intro.domainsTitle">ğŸ“‹ í‰ê°€ ì˜ì—­</p>
                    <ul style="color: #94a3b8; padding-left: 20px; line-height: 1.8;">
                        <li><strong data-i18n="domain.pattern">íŒ¨í„´ ì¸ì‹</strong> - <span data-i18n="domain.patternDesc">ì‹œê°ì  ê·œì¹™ ë°œê²¬</span></li>
                        <li><strong data-i18n="domain.numerical">ìˆ˜ë¦¬ ì¶”ë¡ </strong> - <span data-i18n="domain.numericalDesc">ìˆ˜í•™ì  ê´€ê³„ íŒŒì•…</span></li>
                        <li><strong data-i18n="domain.spatial">ê³µê°„ ì§€ê°</strong> - <span data-i18n="domain.spatialDesc">ê³µê°„ ê´€ê³„ ì´í•´</span></li>
                        <li><strong data-i18n="domain.logical">ë…¼ë¦¬ ì¶”ë¡ </strong> - <span data-i18n="domain.logicalDesc">ë…¼ë¦¬ì  ë¶„ì„ ëŠ¥ë ¥</span></li>
                        <li><strong data-i18n="domain.verbal">ì–¸ì–´ ìœ ì¶”</strong> - <span data-i18n="domain.verbalDesc">ê°œë… ê°„ ê´€ê³„ íŒŒì•…</span></li>
                    </ul>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="startTest()" data-i18n="intro.start">
                        ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œì‘
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 15px; color: #f1f5f9;" data-i18n="intro.methodTitle">ğŸ”¬ í‰ê°€ ë°©ë²•ë¡ </h3>
                <ul style="color: #94a3b8; padding-left: 20px; line-height: 1.8;">
                    <li data-i18n="intro.method1">ë¬¸í•­ë°˜ì‘ì´ë¡ (IRT) 3ëª¨ìˆ˜ ë¡œì§€ìŠ¤í‹± ëª¨ë¸</li>
                    <li data-i18n="intro.method2">ìµœëŒ€ìš°ë„ì¶”ì •(MLE) ë° ê¸°ëŒ€ì‚¬í›„ì¶”ì •(EAP)</li>
                    <li data-i18n="intro.method3">95% ì‹ ë¢°êµ¬ê°„ ë° ì¸¡ì • í‘œì¤€ì˜¤ì°¨(SEM) ì œê³µ</li>
                    <li data-i18n="intro.method4">ì—°ë ¹ë³„ ê·œì¤€ ì ìš© (13-99ì„¸)</li>
                    <li data-i18n="intro.method5">ì˜ì—­ë³„ ìƒì„¸ ë¶„ì„ ë° ê°•ì•½ì  ì§„ë‹¨</li>
                </ul>
            </div>
        </div>

        <!-- Screen 2: Test -->
        <div id="screen-test" class="screen">
            <div class="card">
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="progressText">1 / 30</span>
                        <span class="domain-indicator" id="domainIndicator">
                            <span id="domainIcon">ğŸ”·</span>
                            <span id="domainLabel">íŒ¨í„´ ì¸ì‹</span>
                        </span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 3.33%"></div>
                    </div>
                </div>
                
                <div class="timer" id="timer">
                    â±ï¸ <span id="timerValue">45</span>
                </div>
                
                <div class="question-container">
                    <p class="question-text" id="questionText"></p>
                    <div class="question-visual" id="questionVisual"></div>
                </div>
                
                <div class="options-grid" id="optionsContainer"></div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 25px;">
                    <button class="btn btn-danger" onclick="confirmExit()" data-i18n="test.exit">
                        âœ• ì¢…ë£Œ
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>
                        <span data-i18n="test.next">ë‹¤ìŒ</span> â†’
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 3: Results -->
        <div id="screen-result" class="screen">
            <div class="card result-container">
                <h2 class="card-title" data-i18n="result.title">ğŸ“Š ì¢…í•© ì¸ì§€ëŠ¥ë ¥ í‰ê°€ ê²°ê³¼</h2>
                
                <div class="iq-display">
                    <div class="iq-score" id="resultIQ">--</div>
                    <div class="iq-label" data-i18n="result.iqLabel">ì¢…í•© IQ (ì—°ë ¹ ë³´ì •)</div>
                    <div class="confidence-interval" id="resultCI">
                        95% CI: -- ~ --
                    </div>
                </div>
                
                <div class="classification">
                    <div class="class-label" id="resultClass">--</div>
                    <div class="percentile" id="resultPercentile">ë°±ë¶„ìœ„ --%</div>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="statCorrect">--</div>
                        <div class="stat-label" data-i18n="result.correct">ì •ë‹µ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statAccuracy">--%</div>
                        <div class="stat-label" data-i18n="result.accuracy">ì •ë‹µë¥ </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statTime">--</div>
                        <div class="stat-label" data-i18n="result.avgTime">í‰ê·  ì‘ë‹µì‹œê°„</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statSEM">Â±--</div>
                        <div class="stat-label" data-i18n="result.sem">ì¸¡ì •ì˜¤ì°¨(SEM)</div>
                    </div>
                </div>
                
                <!-- Domain Analysis -->
                <div class="domain-chart" id="domainChart">
                    <h3 data-i18n="result.domainTitle">ğŸ“ˆ ì˜ì—­ë³„ ë¶„ì„</h3>
                    <div id="domainBars"></div>
                </div>
                
                <!-- Strengths & Weaknesses -->
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4><span style="color: var(--success);">ğŸ’ª</span> <span data-i18n="result.strengths">ê°•ì  ì˜ì—­</span></h4>
                        <div id="strengthsList"></div>
                    </div>
                    <div class="analysis-card">
                        <h4><span style="color: var(--warning);">ğŸ“ˆ</span> <span data-i18n="result.weaknesses">ê°œì„  ì˜ì—­</span></h4>
                        <div id="weaknessesList"></div>
                    </div>
                </div>
                
                <!-- Age Interpretation -->
                <div class="info-box" id="ageInterpretation" style="text-align: left;"></div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="location.reload()" data-i18n="result.restart">
                        ğŸ”„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸
                    </button>
                    <button class="btn btn-primary" onclick="printReport()" data-i18n="result.print">
                        ğŸ“„ ê²°ê³¼ ì¶œë ¥
                    </button>
                </div>
            </div>
        </div>

        <!-- Exit Confirmation Modal -->
        <div class="modal-overlay" id="exitModal">
            <div class="modal">
                <h3 class="modal-title" data-i18n="modal.exitTitle">âš ï¸ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ</h3>
                <div class="modal-body" data-i18n="modal.exitBody">
                    ì •ë§ í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="hideExitModal()" data-i18n="modal.continue">ê³„ì†í•˜ê¸°</button>
                    <button class="btn btn-danger" onclick="exitTest()" data-i18n="modal.exitConfirm">ì¢…ë£Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë‹¤êµ­ì–´ ì§€ì›
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const i18n = {
        ko: {
            tagline: "ê³µì‹ ì§€ëŠ¥ì§€ìˆ˜ í‰ê°€",
            "intro.title": "ğŸ“Š ì¢…í•© ì¸ì§€ëŠ¥ë ¥ í‰ê°€",
            "intro.desc": "ë³¸ ê²€ì‚¬ëŠ” <strong>ë¬¸í•­ë°˜ì‘ì´ë¡ (IRT)</strong>ì— ê¸°ë°˜í•œ í‘œì¤€í™”ëœ ì¸ì§€ëŠ¥ë ¥ í‰ê°€ì…ë‹ˆë‹¤.<br>5ê°œ ì˜ì—­ì„ ì¢…í•©ì ìœ¼ë¡œ ì¸¡ì •í•˜ì—¬ ì •í™•í•œ IQë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.",
            "intro.totalItems": "ë¬¸í•­",
            "intro.timePerItem": "ì´ˆ/ë¬¸í•­",
            "intro.domains": "í‰ê°€ ì˜ì—­",
            "intro.method": "3PL ëª¨ë¸",
            "intro.age": "ë‚˜ì´ (ë§Œ):",
            "intro.ageUnit": "ì„¸",
            "intro.ageNote": "* ì—°ë ¹ë³„ ê·œì¤€ì„ ì ìš©í•˜ì—¬ ì •í™•í•œ IQë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.",
            "intro.domainsTitle": "ğŸ“‹ í‰ê°€ ì˜ì—­",
            "intro.start": "ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œì‘",
            "intro.methodTitle": "ğŸ”¬ í‰ê°€ ë°©ë²•ë¡ ",
            "intro.method1": "ë¬¸í•­ë°˜ì‘ì´ë¡ (IRT) 3ëª¨ìˆ˜ ë¡œì§€ìŠ¤í‹± ëª¨ë¸",
            "intro.method2": "ìµœëŒ€ìš°ë„ì¶”ì •(MLE) ë° ê¸°ëŒ€ì‚¬í›„ì¶”ì •(EAP)",
            "intro.method3": "95% ì‹ ë¢°êµ¬ê°„ ë° ì¸¡ì • í‘œì¤€ì˜¤ì°¨(SEM) ì œê³µ",
            "intro.method4": "ì—°ë ¹ë³„ ê·œì¤€ ì ìš© (13-99ì„¸)",
            "intro.method5": "ì˜ì—­ë³„ ìƒì„¸ ë¶„ì„ ë° ê°•ì•½ì  ì§„ë‹¨",
            "domain.pattern": "íŒ¨í„´ ì¸ì‹",
            "domain.patternDesc": "ì‹œê°ì  ê·œì¹™ ë°œê²¬",
            "domain.numerical": "ìˆ˜ë¦¬ ì¶”ë¡ ",
            "domain.numericalDesc": "ìˆ˜í•™ì  ê´€ê³„ íŒŒì•…",
            "domain.spatial": "ê³µê°„ ì§€ê°",
            "domain.spatialDesc": "ê³µê°„ ê´€ê³„ ì´í•´",
            "domain.logical": "ë…¼ë¦¬ ì¶”ë¡ ",
            "domain.logicalDesc": "ë…¼ë¦¬ì  ë¶„ì„ ëŠ¥ë ¥",
            "domain.verbal": "ì–¸ì–´ ìœ ì¶”",
            "domain.verbalDesc": "ê°œë… ê°„ ê´€ê³„ íŒŒì•…",
            "test.exit": "âœ• ì¢…ë£Œ",
            "test.next": "ë‹¤ìŒ",
            "result.title": "ğŸ“Š ì¢…í•© ì¸ì§€ëŠ¥ë ¥ í‰ê°€ ê²°ê³¼",
            "result.iqLabel": "ì¢…í•© IQ (ì—°ë ¹ ë³´ì •)",
            "result.correct": "ì •ë‹µ ìˆ˜",
            "result.accuracy": "ì •ë‹µë¥ ",
            "result.avgTime": "í‰ê·  ì‘ë‹µì‹œê°„",
            "result.sem": "ì¸¡ì •ì˜¤ì°¨(SEM)",
            "result.domainTitle": "ğŸ“ˆ ì˜ì—­ë³„ ë¶„ì„",
            "result.strengths": "ê°•ì  ì˜ì—­",
            "result.weaknesses": "ê°œì„  ì˜ì—­",
            "result.restart": "ğŸ”„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸",
            "result.print": "ğŸ“„ ê²°ê³¼ ì¶œë ¥",
            "modal.exitTitle": "âš ï¸ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ",
            "modal.exitBody": "ì •ë§ í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            "modal.continue": "ê³„ì†í•˜ê¸°",
            "modal.exitConfirm": "ì¢…ë£Œ",
            "noStrengths": "íŠ¹ë³„íˆ ë‘ë“œëŸ¬ì§„ ê°•ì  ì—†ìŒ",
            "noWeaknesses": "íŠ¹ë³„íˆ ì•½í•œ ì˜ì—­ ì—†ìŒ"
        },
        en: {
            tagline: "Official Intelligence Quotient Assessment",
            "intro.title": "ğŸ“Š Comprehensive Cognitive Assessment",
            "intro.desc": "This assessment is a standardized cognitive evaluation based on <strong>Item Response Theory (IRT)</strong>.<br>Accurate IQ is calculated by comprehensively measuring 5 domains.",
            "intro.totalItems": "Items",
            "intro.timePerItem": "sec/item",
            "intro.domains": "Domains",
            "intro.method": "3PL Model",
            "intro.age": "Age:",
            "intro.ageUnit": "years",
            "intro.ageNote": "* Age-adjusted norms applied for accurate IQ calculation.",
            "intro.domainsTitle": "ğŸ“‹ Assessment Domains",
            "intro.start": "ğŸš€ Start Test",
            "intro.methodTitle": "ğŸ”¬ Assessment Methodology",
            "intro.method1": "Item Response Theory (IRT) 3-Parameter Logistic Model",
            "intro.method2": "Maximum Likelihood Estimation (MLE) & Expected A Posteriori (EAP)",
            "intro.method3": "95% Confidence Interval & Standard Error of Measurement (SEM)",
            "intro.method4": "Age-based Norms (13-99 years)",
            "intro.method5": "Domain-specific Analysis & Strength/Weakness Diagnosis",
            "domain.pattern": "Pattern Recognition",
            "domain.patternDesc": "Visual rule discovery",
            "domain.numerical": "Numerical Reasoning",
            "domain.numericalDesc": "Mathematical relationships",
            "domain.spatial": "Spatial Perception",
            "domain.spatialDesc": "Spatial relationships",
            "domain.logical": "Logical Reasoning",
            "domain.logicalDesc": "Logical analysis",
            "domain.verbal": "Verbal Analogies",
            "domain.verbalDesc": "Conceptual relationships",
            "test.exit": "âœ• Exit",
            "test.next": "Next",
            "result.title": "ğŸ“Š Comprehensive Assessment Results",
            "result.iqLabel": "Overall IQ (Age-Adjusted)",
            "result.correct": "Correct",
            "result.accuracy": "Accuracy",
            "result.avgTime": "Avg Response Time",
            "result.sem": "SEM",
            "result.domainTitle": "ğŸ“ˆ Domain Analysis",
            "result.strengths": "Strengths",
            "result.weaknesses": "Areas for Improvement",
            "result.restart": "ğŸ”„ Retake Test",
            "result.print": "ğŸ“„ Print Results",
            "modal.exitTitle": "âš ï¸ Exit Test",
            "modal.exitBody": "Are you sure you want to exit?<br>Progress will not be saved.",
            "modal.continue": "Continue",
            "modal.exitConfirm": "Exit",
            "noStrengths": "No significant strengths identified",
            "noWeaknesses": "No significant weaknesses identified"
        }
    };
    
    let currentLang = 'ko';
    
    function setLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.textContent.includes(lang === 'ko' ? 'í•œêµ­ì–´' : 'English'));
        });
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (i18n[lang][key]) {
                el.innerHTML = i18n[lang][key];
            }
        });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì˜ì—­ ì •ë³´
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const DOMAINS = {
        pattern: { icon: 'ğŸ”·', name: { ko: 'íŒ¨í„´ ì¸ì‹', en: 'Pattern Recognition' } },
        numerical: { icon: 'ğŸ”¢', name: { ko: 'ìˆ˜ë¦¬ ì¶”ë¡ ', en: 'Numerical Reasoning' } },
        spatial: { icon: 'ğŸ“', name: { ko: 'ê³µê°„ ì§€ê°', en: 'Spatial Perception' } },
        logical: { icon: 'ğŸ§©', name: { ko: 'ë…¼ë¦¬ ì¶”ë¡ ', en: 'Logical Reasoning' } },
        verbal: { icon: 'ğŸ“', name: { ko: 'ì–¸ì–´ ìœ ì¶”', en: 'Verbal Analogies' } }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // IRT ë¬¸ì œ ë°ì´í„°ë² ì´ìŠ¤ (30ë¬¸í•­: ì˜ì—­ë‹¹ 6ë¬¸í•­)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const TEST_ITEMS = [
        // ===== íŒ¨í„´ ì¸ì‹ (6ë¬¸í•­) - ë‚œì´ë„: -1.2, -0.4, 0.0, 0.2, 0.6, 1.2 =====
        { id: "P01", domain: "pattern", irt: { a: 1.2, b: -1.2, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "2", "3", "1", "2", "3", "1", "2", "?"], options: ["1", "2", "3", "4"], answer: 2 },
        { id: "P02", domain: "pattern", irt: { a: 1.3, b: -0.4, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "2", "3", "4", "5", "6", "7", "8", "?"], options: ["9", "10", "0", "7"], answer: 0 },
        { id: "P03", domain: "pattern", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["2", "4", "6", "3", "6", "9", "4", "8", "?"], options: ["10", "12", "14", "16"], answer: 1 },
        { id: "P04", domain: "pattern", irt: { a: 1.6, b: 0.2, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["A", "C", "E", "B", "D", "F", "C", "E", "?"], options: ["F", "G", "H", "I"], answer: 1 },
        { id: "P05", domain: "pattern", irt: { a: 1.7, b: 0.6, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "1", "1", "2", "4", "8", "3", "9", "?"], options: ["12", "18", "27", "36"], answer: 2 },
        { id: "P06", domain: "pattern", irt: { a: 1.9, b: 1.2, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "1", "2", "3", "5", "8", "13", "21", "?"], options: ["29", "32", "34", "36"], answer: 2 },
        
        // ===== ìˆ˜ë¦¬ ì¶”ë¡  (6ë¬¸í•­) - ë‚œì´ë„: -1.5, -0.3, 0.1, 0.4, 0.8, 1.4 =====
        { id: "N01", domain: "numerical", irt: { a: 1.1, b: -1.5, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”: 2, 4, 6, 8, ?", en: "Find the next term: 2, 4, 6, 8, ?" }, options: ["9", "10", "11", "12"], answer: 1 },
        { id: "N02", domain: "numerical", irt: { a: 1.3, b: -0.3, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”: 2, 4, 8, 16, ?", en: "Find the next term: 2, 4, 8, 16, ?" }, options: ["24", "32", "30", "20"], answer: 1 },
        { id: "N03", domain: "numerical", irt: { a: 1.5, b: 0.1, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”: 1, 4, 9, 16, 25, ?", en: "Find the next term: 1, 4, 9, 16, 25, ?" }, options: ["30", "35", "36", "49"], answer: 2 },
        { id: "N04", domain: "numerical", irt: { a: 1.6, b: 0.4, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”: 1, 1, 2, 3, 5, 8, ?", en: "Find the next term: 1, 1, 2, 3, 5, 8, ?" }, options: ["11", "12", "13", "15"], answer: 2 },
        { id: "N05", domain: "numerical", irt: { a: 1.8, b: 0.8, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”: 1, 3, 6, 10, 15, ?", en: "Find the next term: 1, 3, 6, 10, 15, ?" }, options: ["18", "20", "21", "25"], answer: 2 },
        { id: "N06", domain: "numerical", irt: { a: 2.0, b: 1.4, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­ì„ êµ¬í•˜ì„¸ìš”: 1, 2, 6, 24, 120, ?", en: "Find the next term: 1, 2, 6, 24, 120, ?" }, options: ["240", "480", "720", "840"], answer: 2 },
        
        // ===== ê³µê°„ ì§€ê° (6ë¬¸í•­) - ë‚œì´ë„: -1.0, -0.2, 0.0, 0.3, 0.7, 1.3 =====
        { id: "S01", domain: "spatial", irt: { a: 1.2, b: -1.0, c: 0.25 }, question: { ko: "â†‘ ë¥¼ ì‹œê³„ë°©í–¥ 90Â° íšŒì „í•˜ë©´?", en: "Rotate â†‘ clockwise 90Â°?" }, options: ["â†", "â†’", "â†‘", "â†“"], answer: 1 },
        { id: "S02", domain: "spatial", irt: { a: 1.4, b: -0.2, c: 0.25 }, question: { ko: "'b'ë¥¼ ê±°ìš¸ì— ë¹„ì¶”ë©´?", en: "Mirror image of 'b'?" }, options: ["b", "d", "p", "q"], answer: 1 },
        { id: "S03", domain: "spatial", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "ì£¼ì‚¬ìœ„ì—ì„œ 1ì˜ ë§ì€í¸ ìˆ«ìëŠ”? (1-6, 2-5, 3-4ê°€ ë§ˆì£¼ë´„)", en: "Opposite of 1 on die? (1-6, 2-5, 3-4 opposite)" }, options: ["2", "4", "5", "6"], answer: 3 },
        { id: "S04", domain: "spatial", irt: { a: 1.6, b: 0.3, c: 0.25 }, question: { ko: "ì •ì‚¬ê°í˜•ì„ ëŒ€ê°ì„ ìœ¼ë¡œ ìë¥´ë©´ ìƒê¸°ëŠ” ë„í˜•ì€?", en: "Cut a square diagonally, what shapes result?" }, options: { ko: ["ì§ì‚¬ê°í˜• 2ê°œ", "ì‚¼ê°í˜• 2ê°œ", "ì‚¬ë‹¤ë¦¬ê¼´ 2ê°œ", "ë§ˆë¦„ëª¨ 2ê°œ"], en: ["2 rectangles", "2 triangles", "2 trapezoids", "2 rhombuses"] }, answer: 1 },
        { id: "S05", domain: "spatial", irt: { a: 1.8, b: 0.7, c: 0.25 }, question: { ko: "ì§ê°ì‚¼ê°í˜• 2ê°œë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë„í˜•ì€?", en: "What can 2 right triangles make?" }, options: { ko: ["ì •ì‚¼ê°í˜•ë§Œ", "ì§ì‚¬ê°í˜•ë§Œ", "ë‘˜ ë‹¤ ê°€ëŠ¥", "ë¶ˆê°€ëŠ¥"], en: ["Only equilateral", "Only rectangle", "Both possible", "Impossible"] }, answer: 2 },
        { id: "S06", domain: "spatial", irt: { a: 2.0, b: 1.3, c: 0.25 }, question: { ko: "ì •ìœ¡ë©´ì²´ë¥¼ ê¼­ì§“ì ì—ì„œ ëŒ€ê°ì„ ìœ¼ë¡œ ìë¥´ë©´ ë‹¨ë©´ì€?", en: "Diagonal cross-section of cube through vertices?" }, options: { ko: ["ì •ì‚¼ê°í˜•", "ì •ì‚¬ê°í˜•", "ì§ì‚¬ê°í˜•", "ì •ìœ¡ê°í˜•"], en: ["Equilateral triangle", "Square", "Rectangle", "Regular hexagon"] }, answer: 3 },
        
        // ===== ë…¼ë¦¬ ì¶”ë¡  (6ë¬¸í•­) - ë‚œì´ë„: -1.3, -0.5, 0.0, 0.3, 0.9, 1.5 =====
        { id: "L01", domain: "logical", irt: { a: 1.1, b: -1.3, c: 0.25 }, question: { ko: "A > B ì´ê³  B > C ì´ë©´, ê°€ì¥ í° ê²ƒì€?", en: "If A > B and B > C, largest is?" }, options: ["A", "B", "C", { ko: "ì•Œ ìˆ˜ ì—†ìŒ", en: "Unknown" }], answer: 0 },
        { id: "L02", domain: "logical", irt: { a: 1.3, b: -0.5, c: 0.25 }, question: { ko: "ëª¨ë“  ê³ ì–‘ì´ëŠ” ë™ë¬¼ì´ë‹¤. ë‚˜ë¹„ëŠ” ê³ ì–‘ì´ë‹¤. ì°¸ì¸ ê²ƒì€?", en: "All cats are animals. Nabi is a cat. What is true?" }, options: { ko: ["ë‚˜ë¹„ëŠ” ë™ë¬¼ì´ë‹¤", "ëª¨ë“  ë™ë¬¼ì€ ê³ ì–‘ì´ë‹¤", "ë‚˜ë¹„ëŠ” ê°œë‹¤", "ì•Œ ìˆ˜ ì—†ë‹¤"], en: ["Nabi is an animal", "All animals are cats", "Nabi is a dog", "Unknown"] }, answer: 0 },
        { id: "L03", domain: "logical", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "x + 5 = 12 ì¼ ë•Œ, x = ?", en: "If x + 5 = 12, x = ?" }, options: ["5", "6", "7", "17"], answer: 2 },
        { id: "L04", domain: "logical", irt: { a: 1.6, b: 0.3, c: 0.25 }, question: { ko: "2x + 3 = 11 ì¼ ë•Œ, x = ?", en: "If 2x + 3 = 11, x = ?" }, options: ["3", "4", "5", "6"], answer: 1 },
        { id: "L05", domain: "logical", irt: { a: 1.8, b: 0.9, c: 0.25 }, question: { ko: "'ë¹„ê°€ ì˜¤ë©´ ë•…ì´ ì –ëŠ”ë‹¤'ê°€ ì°¸ì¼ ë•Œ, ë°˜ë“œì‹œ ì°¸ì¸ ê²ƒì€?", en: "If 'Rain wets ground' is true, what must be true?" }, options: { ko: ["ë•…ì´ ì –ìœ¼ë©´ ë¹„ê°€ ì˜¨ë‹¤", "ë¹„ ì•ˆì˜¤ë©´ ì•ˆì –ëŠ”ë‹¤", "ì•ˆì –ìœ¼ë©´ ë¹„ ì•ˆì˜¨ë‹¤", "í•­ìƒ ë¹„ê°€ ì˜¨ë‹¤"], en: ["If wet, rained", "No rain=dry", "If dry, no rain", "Always rains"] }, answer: 2 },
        { id: "L06", domain: "logical", irt: { a: 2.0, b: 1.5, c: 0.25 }, question: { ko: "(x + 5) Ã· 3 = 4 ì¼ ë•Œ, x = ?", en: "If (x + 5) Ã· 3 = 4, x = ?" }, options: ["5", "6", "7", "8"], answer: 2 },
        
        // ===== ì–¸ì–´ ìœ ì¶” (6ë¬¸í•­) - ë‚œì´ë„: -1.4, -0.6, -0.1, 0.2, 0.5, 1.1 =====
        { id: "V01", domain: "verbal", irt: { a: 1.1, b: -1.4, c: 0.25 }, question: { ko: "ì•„ë²„ì§€ : ì•„ë“¤ = ì–´ë¨¸ë‹ˆ : ?", en: "Father : Son = Mother : ?" }, options: { ko: ["ë‚¨í¸", "ì•„ë²„ì§€", "ë”¸", "í• ë¨¸ë‹ˆ"], en: ["Husband", "Father", "Daughter", "Grandmother"] }, answer: 2 },
        { id: "V02", domain: "verbal", irt: { a: 1.3, b: -0.6, c: 0.25 }, question: { ko: "í° : ì‘ì€ = ë†’ì€ : ?", en: "Big : Small = High : ?" }, options: { ko: ["ê¹Šì€", "ë‚®ì€", "ë©€ë¦¬", "ê°€ê¹Œìš´"], en: ["Deep", "Low", "Far", "Near"] }, answer: 1 },
        { id: "V03", domain: "verbal", irt: { a: 1.5, b: -0.1, c: 0.25 }, question: { ko: "ì±… : ì½ë‹¤ = ìŒì•… : ?", en: "Book : Read = Music : ?" }, options: { ko: ["ì•…ê¸°", "ë“£ë‹¤", "ê°€ìˆ˜", "ì½˜ì„œíŠ¸"], en: ["Instrument", "Listen", "Singer", "Concert"] }, answer: 1 },
        { id: "V04", domain: "verbal", irt: { a: 1.6, b: 0.2, c: 0.25 }, question: { ko: "ì† : ì¥ê°‘ = ë¨¸ë¦¬ : ?", en: "Hand : Glove = Head : ?" }, options: { ko: ["ëª¨ì", "ì–¼êµ´", "ë‘ë‡Œ", "ë¨¸ë¦¬ì¹´ë½"], en: ["Hat", "Face", "Brain", "Hair"] }, answer: 0 },
        { id: "V05", domain: "verbal", irt: { a: 1.7, b: 0.5, c: 0.25 }, question: { ko: "ì˜ì‚¬ : ë³‘ì› = êµì‚¬ : ?", en: "Doctor : Hospital = Teacher : ?" }, options: { ko: ["í•™ìƒ", "í•™êµ", "êµì‹¤", "êµìœ¡"], en: ["Student", "School", "Classroom", "Education"] }, answer: 1 },
        { id: "V06", domain: "verbal", irt: { a: 1.9, b: 1.1, c: 0.25 }, question: { ko: "ë¹› : ì–´ë‘  = ì§€ì‹ : ?", en: "Light : Darkness = Knowledge : ?" }, options: { ko: ["í•™êµ", "ë¬´ì§€", "ì±…", "ê³µë¶€"], en: ["School", "Ignorance", "Book", "Study"] }, answer: 1 }
    ];
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // IRT ê³„ì‚° ì—”ì§„
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const IRTEngine = {
        // 3PL ì •ë‹µ í™•ë¥ 
        probability: function(theta, item) {
            const { a, b, c } = item.irt;
            const exp = Math.exp(a * (theta - b));
            return c + (1 - c) * (exp / (1 + exp));
        },
        
        // Fisher ì •ë³´ëŸ‰
        fisherInfo: function(theta, items) {
            let info = 0;
            items.forEach(item => {
                const p = this.probability(theta, item);
                const q = 1 - p;
                const pStar = (p - item.irt.c) / (1 - item.irt.c);
                const itemInfo = item.irt.a * item.irt.a * pStar * pStar * q / Math.max(p, 0.001);
                info += itemInfo;
            });
            return Math.max(info, 0.1);
        },
        
        // MLE ì¶”ì • (Newton-Raphson)
        estimateMLE: function(responses, items, maxIter = 50) {
            let theta = 0;
            
            for (let iter = 0; iter < maxIter; iter++) {
                let firstDeriv = 0;
                let secondDeriv = 0;
                
                items.forEach((item, i) => {
                    const p = this.probability(theta, item);
                    const pStar = (p - item.irt.c) / (1 - item.irt.c);
                    const q = 1 - p;
                    
                    firstDeriv += item.irt.a * pStar * (responses[i] - p) / Math.max(p, 0.001);
                    secondDeriv -= item.irt.a * item.irt.a * pStar * pStar * q / Math.max(p, 0.001);
                });
                
                if (Math.abs(secondDeriv) < 0.001) break;
                
                const delta = firstDeriv / Math.abs(secondDeriv);
                theta += delta;
                theta = Math.max(-4, Math.min(4, theta));
                
                if (Math.abs(delta) < 0.001) break;
            }
            
            const info = this.fisherInfo(theta, items);
            const se = 1 / Math.sqrt(info);
            
            return { theta, se };
        },
        
        // EAP ì¶”ì • (ê·¹ë‹¨ ì‘ë‹µìš©)
        estimateEAP: function(responses, items) {
            const points = 41;
            let numerator = 0;
            let denominator = 0;
            
            for (let i = 0; i < points; i++) {
                const theta = -4 + (i * 8 / (points - 1));
                const prior = Math.exp(-theta * theta / 2) / Math.sqrt(2 * Math.PI);
                
                let likelihood = 1;
                items.forEach((item, j) => {
                    const p = this.probability(theta, item);
                    likelihood *= responses[j] === 1 ? p : (1 - p);
                });
                
                const weight = likelihood * prior;
                numerator += theta * weight;
                denominator += weight;
            }
            
            const thetaEAP = denominator > 0 ? numerator / denominator : 0;
            
            // ì‚¬í›„ í‘œì¤€í¸ì°¨
            let variance = 0;
            for (let i = 0; i < points; i++) {
                const theta = -4 + (i * 8 / (points - 1));
                const prior = Math.exp(-theta * theta / 2) / Math.sqrt(2 * Math.PI);
                
                let likelihood = 1;
                items.forEach((item, j) => {
                    const p = this.probability(theta, item);
                    likelihood *= responses[j] === 1 ? p : (1 - p);
                });
                
                const weight = denominator > 0 ? (likelihood * prior / denominator) : 0;
                variance += weight * Math.pow(theta - thetaEAP, 2);
            }
            
            return { theta: thetaEAP, se: Math.sqrt(Math.max(variance, 0.01)) };
        },
        
        // ëŠ¥ë ¥ ì¶”ì • (ìë™ ì„ íƒ)
        estimate: function(responses, items) {
            const correct = responses.filter(r => r === 1).length;
            
            if (correct === 0 || correct === responses.length) {
                return this.estimateEAP(responses, items);
            }
            return this.estimateMLE(responses, items);
        },
        
        // theta â†’ IQ
        toIQ: function(theta) {
            return Math.round(100 + theta * 15);
        },
        
        // IQ â†’ ë°±ë¶„ìœ„
        toPercentile: function(iq) {
            const z = (iq - 100) / 15;
            const t = 1 / (1 + 0.2316419 * Math.abs(z));
            const d = 0.3989423 * Math.exp(-z * z / 2);
            const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            return Math.round((z > 0 ? (1 - p) : p) * 1000) / 10;
        },
        
        // ì‹ ë¢°êµ¬ê°„
        confidenceInterval: function(iq, se, level = 0.95) {
            const z = level === 0.95 ? 1.96 : (level === 0.99 ? 2.576 : 1.645);
            const margin = Math.round(z * se * 15);
            return {
                lower: Math.max(40, iq - margin),
                upper: Math.min(160, iq + margin),
                margin
            };
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì—°ë ¹ ê·œì¤€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const AgeNorms = {
        groups: [
            { id: 'teen', range: [13, 17], label: { ko: 'ì²­ì†Œë…„', en: 'Teenager' }, thetaMean: -0.2, thetaSD: 1.0 },
            { id: 'young', range: [18, 29], label: { ko: 'ì²­ë…„', en: 'Young Adult' }, thetaMean: 0.1, thetaSD: 1.0 },
            { id: 'adult', range: [30, 44], label: { ko: 'ì„±ì¸', en: 'Adult' }, thetaMean: 0.0, thetaSD: 1.0 },
            { id: 'middle', range: [45, 59], label: { ko: 'ì¤‘ë…„', en: 'Middle Age' }, thetaMean: -0.1, thetaSD: 1.0 },
            { id: 'senior', range: [60, 99], label: { ko: 'ì¥ë…„', en: 'Senior' }, thetaMean: -0.3, thetaSD: 1.1 }
        ],
        
        getGroup: function(age) {
            for (const g of this.groups) {
                if (age >= g.range[0] && age <= g.range[1]) return g;
            }
            return this.groups[2];
        },
        
        adjustIQ: function(theta, age) {
            const group = this.getGroup(age);
            const normalized = (theta - group.thetaMean) / group.thetaSD;
            const iq = Math.round(100 + normalized * 15);
            return {
                rawIQ: IRTEngine.toIQ(theta),
                adjustedIQ: Math.max(40, Math.min(160, iq)),
                ageGroup: group,
                adjustment: Math.round((normalized - theta) * 15)
            };
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // IQ ë¶„ë¥˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function classifyIQ(iq) {
        const classifications = [
            { min: 145, label: { ko: 'ìµœìš°ìˆ˜ (Very Superior)', en: 'Very Superior' }, color: '#10b981' },
            { min: 130, label: { ko: 'ë§¤ìš° ìš°ìˆ˜ (Superior)', en: 'Superior' }, color: '#10b981' },
            { min: 120, label: { ko: 'ìš°ìˆ˜ (High Average)', en: 'High Average' }, color: '#3b82f6' },
            { min: 110, label: { ko: 'í‰ê·  ìƒ (Above Average)', en: 'Above Average' }, color: '#3b82f6' },
            { min: 90, label: { ko: 'í‰ê·  (Average)', en: 'Average' }, color: '#f59e0b' },
            { min: 80, label: { ko: 'í‰ê·  í•˜ (Low Average)', en: 'Low Average' }, color: '#f59e0b' },
            { min: 70, label: { ko: 'ê²½ê³„ì„  (Borderline)', en: 'Borderline' }, color: '#ef4444' },
            { min: 0, label: { ko: 'ë§¤ìš° ë‚®ìŒ (Very Low)', en: 'Very Low' }, color: '#ef4444' }
        ];
        
        for (const c of classifications) {
            if (iq >= c.min) return c;
        }
        return classifications[classifications.length - 1];
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê²Œì„ ìƒíƒœ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let state = {
        userAge: 25,
        currentItems: [],
        currentIndex: 0,
        responses: [],
        responseTimes: [],
        startTime: null,
        questionStartTime: null,
        timer: null,
        timeLeft: 45,
        selectedOption: null
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI í•¨ìˆ˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }
    
    function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // í…ŒìŠ¤íŠ¸ ì‹œì‘
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function startTest() {
        const ageInput = document.getElementById('userAge').value;
        state.userAge = parseInt(ageInput) || 25;
        
        if (state.userAge < 13 || state.userAge > 99) {
            alert(currentLang === 'ko' ? '13ì„¸ ì´ìƒ 99ì„¸ ì´í•˜ë§Œ ì°¸ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.' : 'Age must be between 13 and 99.');
            return;
        }
        
        // ë¬¸ì œ ì¤€ë¹„ (ëœë¤ ì…”í”Œ)
        state.currentItems = shuffle([...TEST_ITEMS]);
        state.currentIndex = 0;
        state.responses = [];
        state.responseTimes = [];
        state.startTime = Date.now();
        state.selectedOption = null;
        
        showScreen('screen-test');
        displayQuestion();
        startTimer();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë¬¸ì œ í‘œì‹œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function displayQuestion() {
        const item = state.currentItems[state.currentIndex];
        const total = state.currentItems.length;
        
        // ì§„í–‰ë¥ 
        document.getElementById('progressText').textContent = `${state.currentIndex + 1} / ${total}`;
        document.getElementById('progressFill').style.width = `${((state.currentIndex + 1) / total) * 100}%`;
        
        // ì˜ì—­ í‘œì‹œ
        const domain = DOMAINS[item.domain];
        document.getElementById('domainIcon').textContent = domain.icon;
        document.getElementById('domainLabel').textContent = domain.name[currentLang];
        
        // ë¬¸ì œ í…ìŠ¤íŠ¸
        const qText = typeof item.question === 'object' ? item.question[currentLang] : item.question;
        document.getElementById('questionText').textContent = qText;
        
        // ì‹œê° ìë£Œ
        const visual = document.getElementById('questionVisual');
        if (item.matrix) {
            visual.innerHTML = `
                <div class="matrix-grid">
                    ${item.matrix.map((cell, i) => `
                        <div class="matrix-cell ${cell === '?' ? 'highlight' : ''}">${cell}</div>
                    `).join('')}
                </div>
            `;
            visual.style.display = 'block';
        } else {
            visual.style.display = 'none';
        }
        
        // ì„ íƒì§€
        const container = document.getElementById('optionsContainer');
        let options = item.options;
        
        // optionsê°€ ë°°ì—´ì´ ì•„ë‹ˆë¼ {ko: [], en: []} í˜•íƒœì¸ ê²½ìš° ì²˜ë¦¬
        if (!Array.isArray(options)) {
            options = options[currentLang] || options.ko;
        }
        
        container.innerHTML = options.map((opt, i) => {
            // ê°œë³„ ì˜µì…˜ì´ {ko: '', en: ''} í˜•íƒœì¸ ê²½ìš° ì²˜ë¦¬
            const optText = (typeof opt === 'object' && opt !== null) ? (opt[currentLang] || opt.ko || String(opt)) : String(opt);
            return `
                <button class="option-btn" onclick="selectOption(${i})" data-index="${i}">
                    ${optText}
                </button>
            `;
        }).join('');
        
        document.getElementById('nextBtn').disabled = true;
        state.selectedOption = null;
    }
    
    function selectOption(index) {
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.toggle('selected', parseInt(btn.dataset.index) === index);
        });
        state.selectedOption = index;
        document.getElementById('nextBtn').disabled = false;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // íƒ€ì´ë¨¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function startTimer() {
        state.timeLeft = 45;
        state.questionStartTime = Date.now();
        updateTimerDisplay();
        
        clearInterval(state.timer);
        state.timer = setInterval(() => {
            state.timeLeft--;
            updateTimerDisplay();
            
            if (state.timeLeft <= 0) {
                autoSubmit();
            }
        }, 1000);
    }
    
    function updateTimerDisplay() {
        const timerEl = document.getElementById('timer');
        document.getElementById('timerValue').textContent = state.timeLeft;
        
        timerEl.classList.remove('warning', 'danger');
        if (state.timeLeft <= 5) {
            timerEl.classList.add('danger');
        } else if (state.timeLeft <= 10) {
            timerEl.classList.add('warning');
        }
    }
    
    function autoSubmit() {
        // ì‹œê°„ ì´ˆê³¼ - ì˜¤ë‹µ ì²˜ë¦¬
        state.responses.push(0);
        state.responseTimes.push(45000);
        
        if (state.currentIndex < state.currentItems.length - 1) {
            state.currentIndex++;
            state.selectedOption = null;
            displayQuestion();
            startTimer();
        } else {
            finishTest();
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë‹¤ìŒ ë¬¸ì œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function nextQuestion() {
        if (state.selectedOption === null) return;
        
        const item = state.currentItems[state.currentIndex];
        const isCorrect = state.selectedOption === item.answer ? 1 : 0;
        const responseTime = Date.now() - state.questionStartTime;
        
        state.responses.push(isCorrect);
        state.responseTimes.push(responseTime);
        
        if (state.currentIndex < state.currentItems.length - 1) {
            state.currentIndex++;
            state.selectedOption = null;
            displayQuestion();
            startTimer();
        } else {
            finishTest();
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ë° ê²°ê³¼
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function finishTest() {
        clearInterval(state.timer);
        calculateAndShowResults();
    }
    
    function calculateAndShowResults() {
        // 1. ì „ì²´ IRT ëŠ¥ë ¥ ì¶”ì •
        const overallResult = IRTEngine.estimate(state.responses, state.currentItems);
        
        // 2. ì—°ë ¹ ë³´ì •
        const ageResult = AgeNorms.adjustIQ(overallResult.theta, state.userAge);
        
        // 3. ì‹ ë¢°êµ¬ê°„
        const ci = IRTEngine.confidenceInterval(ageResult.adjustedIQ, overallResult.se);
        
        // 4. ë¶„ë¥˜ ë° ë°±ë¶„ìœ„
        const classification = classifyIQ(ageResult.adjustedIQ);
        const percentile = IRTEngine.toPercentile(ageResult.adjustedIQ);
        
        // 5. ì˜ì—­ë³„ ì ìˆ˜ ê³„ì‚°
        const domainScores = calculateDomainScores();
        
        // 6. í†µê³„
        const totalCorrect = state.responses.filter(r => r === 1).length;
        const accuracy = Math.round((totalCorrect / state.responses.length) * 100);
        const avgTime = Math.round(state.responseTimes.reduce((a, b) => a + b, 0) / state.responseTimes.length / 1000);
        const sem = Math.round(overallResult.se * 15 * 10) / 10;
        
        // ===== ê²°ê³¼ í‘œì‹œ =====
        
        // ë©”ì¸ IQ
        document.getElementById('resultIQ').textContent = ageResult.adjustedIQ;
        document.getElementById('resultCI').textContent = `95% CI: ${ci.lower} ~ ${ci.upper}`;
        
        // ë¶„ë¥˜
        const classLabel = document.getElementById('resultClass');
        classLabel.textContent = classification.label[currentLang];
        classLabel.style.color = classification.color;
        
        document.getElementById('resultPercentile').textContent = 
            currentLang === 'ko' ? `ë°±ë¶„ìœ„ ${percentile}%` : `Percentile ${percentile}%`;
        
        // í†µê³„
        document.getElementById('statCorrect').textContent = `${totalCorrect}/30`;
        document.getElementById('statAccuracy').textContent = `${accuracy}%`;
        document.getElementById('statTime').textContent = `${avgTime}s`;
        document.getElementById('statSEM').textContent = `Â±${sem}`;
        
        // ì˜ì—­ë³„ ì°¨íŠ¸
        renderDomainChart(domainScores);
        
        // ê°•ì•½ì  ë¶„ì„
        analyzeStrengthsWeaknesses(domainScores);
        
        // ì—°ë ¹ í•´ì„
        renderAgeInterpretation(ageResult);
        
        showScreen('screen-result');
    }
    
    function calculateDomainScores() {
        const domainScores = {};
        
        Object.keys(DOMAINS).forEach(domain => {
            const indices = [];
            state.currentItems.forEach((item, i) => {
                if (item.domain === domain) indices.push(i);
            });
            
            if (indices.length === 0) return;
            
            const domainResponses = indices.map(i => state.responses[i]);
            const domainItems = indices.map(i => state.currentItems[i]);
            
            const result = IRTEngine.estimate(domainResponses, domainItems);
            const iq = IRTEngine.toIQ(result.theta);
            const correct = domainResponses.filter(r => r === 1).length;
            
            domainScores[domain] = {
                iq: Math.max(40, Math.min(160, iq)),
                correct: correct,
                total: domainResponses.length,
                accuracy: Math.round((correct / domainResponses.length) * 100),
                theta: result.theta
            };
        });
        
        return domainScores;
    }
    
    function renderDomainChart(scores) {
        const container = document.getElementById('domainBars');
        
        container.innerHTML = Object.entries(scores).map(([domain, data]) => {
            const info = DOMAINS[domain];
            const barWidth = Math.min(100, Math.max(0, ((data.iq - 40) / 120) * 100));
            const fillClass = data.iq >= 120 ? 'fill-excellent' : 
                             data.iq >= 100 ? 'fill-good' : 
                             data.iq >= 80 ? 'fill-average' : 'fill-below';
            
            return `
                <div class="domain-bar-item">
                    <div class="domain-bar-header">
                        <span class="domain-bar-name">
                            ${info.icon} ${info.name[currentLang]}
                        </span>
                        <span class="domain-bar-score">IQ ${data.iq} (${data.correct}/${data.total})</span>
                    </div>
                    <div class="domain-bar-track">
                        <div class="domain-bar-fill ${fillClass}" style="width: ${barWidth}%"></div>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function analyzeStrengthsWeaknesses(scores) {
        const scoreArray = Object.entries(scores).map(([domain, data]) => ({
            domain,
            iq: data.iq,
            name: DOMAINS[domain].name[currentLang],
            icon: DOMAINS[domain].icon
        }));
        
        // í‰ê·  ê³„ì‚°
        const avgIQ = scoreArray.reduce((sum, s) => sum + s.iq, 0) / scoreArray.length;
        
        // ê°•ì  (í‰ê· ë³´ë‹¤ 10ì  ì´ìƒ)
        const strengths = scoreArray.filter(s => s.iq >= avgIQ + 8).sort((a, b) => b.iq - a.iq);
        
        // ì•½ì  (í‰ê· ë³´ë‹¤ 10ì  ì´í•˜)
        const weaknesses = scoreArray.filter(s => s.iq <= avgIQ - 8).sort((a, b) => a.iq - b.iq);
        
        // ê°•ì  í‘œì‹œ
        const strengthsList = document.getElementById('strengthsList');
        if (strengths.length > 0) {
            strengthsList.innerHTML = strengths.map(s => `
                <div class="analysis-item strength-item">
                    ${s.icon} ${s.name} (IQ ${s.iq})
                </div>
            `).join('');
        } else {
            strengthsList.innerHTML = `<div class="analysis-item" style="color: #94a3b8;">${i18n[currentLang].noStrengths}</div>`;
        }
        
        // ì•½ì  í‘œì‹œ
        const weaknessesList = document.getElementById('weaknessesList');
        if (weaknesses.length > 0) {
            weaknessesList.innerHTML = weaknesses.map(w => `
                <div class="analysis-item weakness-item">
                    ${w.icon} ${w.name} (IQ ${w.iq})
                </div>
            `).join('');
        } else {
            weaknessesList.innerHTML = `<div class="analysis-item" style="color: #94a3b8;">${i18n[currentLang].noWeaknesses}</div>`;
        }
    }
    
    function renderAgeInterpretation(ageResult) {
        const container = document.getElementById('ageInterpretation');
        const group = ageResult.ageGroup;
        const adj = ageResult.adjustment;
        
        let html = '';
        
        if (currentLang === 'ko') {
            html = `<p><strong>ğŸ“Š ì—°ë ¹ë³„ í•´ì„</strong></p><p style="margin-top: 10px; color: #94a3b8;">`;
            if (adj > 5) {
                html += `<strong>${group.label.ko}</strong> ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ <strong style="color: var(--success);">${Math.abs(adj)}ì  ë†’ì€</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤. ë™ì¼ ì—°ë ¹ëŒ€ì—ì„œ ë§¤ìš° ìš°ìˆ˜í•œ ì¸ì§€ëŠ¥ë ¥ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`;
            } else if (adj > 0) {
                html += `<strong>${group.label.ko}</strong> ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ <strong style="color: var(--success);">${Math.abs(adj)}ì  ë†’ì€</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
            } else if (adj < -5) {
                html += `<strong>${group.label.ko}</strong> ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ <strong style="color: var(--warning);">${Math.abs(adj)}ì  ë‚®ì€</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤. ì¸ì§€ í›ˆë ¨ì„ í†µí•œ ê°œì„ ì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            } else if (adj < 0) {
                html += `<strong>${group.label.ko}</strong> ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ <strong style="color: var(--warning);">${Math.abs(adj)}ì  ë‚®ì€</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
            } else {
                html += `<strong>${group.label.ko}</strong> ì—°ë ¹ëŒ€ì˜ í‰ê· ì ì¸ ì¸ì§€ëŠ¥ë ¥ ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
            }
            html += `</p>`;
        } else {
            html = `<p><strong>ğŸ“Š Age Interpretation</strong></p><p style="margin-top: 10px; color: #94a3b8;">`;
            if (adj > 5) {
                html += `Your score is <strong style="color: var(--success);">${Math.abs(adj)} points above</strong> the ${group.label.en} average. You demonstrate excellent cognitive ability for your age group.`;
            } else if (adj > 0) {
                html += `Your score is <strong style="color: var(--success);">${Math.abs(adj)} points above</strong> the ${group.label.en} average.`;
            } else if (adj < -5) {
                html += `Your score is <strong style="color: var(--warning);">${Math.abs(adj)} points below</strong> the ${group.label.en} average. Cognitive training may help improvement.`;
            } else if (adj < 0) {
                html += `Your score is <strong style="color: var(--warning);">${Math.abs(adj)} points below</strong> the ${group.label.en} average.`;
            } else {
                html += `Your cognitive ability is <strong>average</strong> for the ${group.label.en} age group.`;
            }
            html += `</p>`;
        }
        
        container.innerHTML = html;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê¸°íƒ€ ê¸°ëŠ¥
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function confirmExit() {
        document.getElementById('exitModal').classList.add('active');
    }
    
    function hideExitModal() {
        document.getElementById('exitModal').classList.remove('active');
    }
    
    function exitTest() {
        clearInterval(state.timer);
        hideExitModal();
        location.reload();
    }
    
    function printReport() {
        window.print();
    }
    
    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        setLanguage('ko');
    });
    </script>
</body>
</html>
