<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COGNIQ - Official IQ Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
        }
        
        body {
            font-family: 'Noto Sans KR', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #94a3b8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Cards */
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #f1f5f9;
        }
        
        /* Buttons */
        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e2e8f0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        /* Age Input Section */
        .age-section {
            margin-bottom: 30px;
        }
        
        .age-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .age-input-group label {
            font-weight: 500;
            color: #94a3b8;
        }
        
        .age-input-group input {
            width: 100px;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            background: rgba(0,0,0,0.2);
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .age-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .age-note {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        /* Category Selection */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .category-card {
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category-card:hover {
            border-color: rgba(96, 165, 250, 0.5);
            background: rgba(96, 165, 250, 0.1);
        }
        
        .category-card.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.2);
            box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
        }
        
        .category-card.selected::after {
            content: 'âœ“';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .category-card {
            position: relative;
        }
        
        .category-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .category-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: #e2e8f0;
        }
        
        /* Info Box */
        .info-box {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info-box.highlight {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.2), rgba(124, 58, 237, 0.2));
            border-color: rgba(124, 58, 237, 0.4);
        }
        
        .highlight-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: #f1f5f9;
            text-align: center;
        }
        
        /* Progress Bar */
        .progress-container {
            margin-bottom: 25px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        /* Timer */
        .timer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 20px;
        }
        
        .timer.warning {
            color: var(--warning);
            animation: pulse 1s infinite;
        }
        
        .timer.danger {
            color: var(--danger);
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Question */
        .question-container {
            margin-bottom: 30px;
        }
        
        .question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 20px;
            color: #f1f5f9;
            line-height: 1.8;
        }
        
        .question-visual {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .matrix-grid {
            display: inline-grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 0 auto;
        }
        
        .matrix-cell {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .matrix-cell.highlight {
            background: rgba(37, 99, 235, 0.3);
            border: 2px solid var(--primary);
        }
        
        .sequence-display {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: 8px;
            color: #e2e8f0;
        }
        
        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .option-btn {
            padding: 18px 20px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #e2e8f0;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
        }
        
        .option-btn.selected {
            background: rgba(37, 99, 235, 0.2);
            border-color: var(--primary);
        }
        
        /* Results */
        .result-container {
            text-align: center;
        }
        
        .iq-display {
            margin: 30px 0;
        }
        
        .iq-score {
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }
        
        .iq-label {
            font-size: 1.5rem;
            color: #94a3b8;
            margin-top: 10px;
        }
        
        .confidence-interval {
            font-size: 1.1rem;
            color: #60a5fa;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(37, 99, 235, 0.1);
            border-radius: 8px;
            display: inline-block;
        }
        
        .classification {
            margin: 25px 0;
        }
        
        .class-label {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--success);
        }
        
        .percentile {
            font-size: 1rem;
            color: #94a3b8;
            margin-top: 5px;
        }
        
        /* Domain Results Chart */
        .domain-chart {
            margin: 30px 0;
        }
        
        .domain-bar-item {
            margin-bottom: 20px;
        }
        
        .domain-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .domain-bar-name {
            color: #e2e8f0;
            font-weight: 500;
        }
        
        .domain-bar-score {
            color: #60a5fa;
            font-weight: 600;
        }
        
        .domain-bar-track {
            height: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .domain-bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1s ease-out;
        }
        
        .domain-bar-fill.excellent { background: linear-gradient(90deg, #10b981, #34d399); }
        .domain-bar-fill.good { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .domain-bar-fill.average { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .domain-bar-fill.below { background: linear-gradient(90deg, #ef4444, #f87171); }
        
        /* Analysis Section */
        .analysis-section {
            text-align: left;
            margin: 30px 0;
        }
        
        .analysis-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #f1f5f9;
        }
        
        .strength-item, .weakness-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .strength-item {
            border-left: 3px solid var(--success);
        }
        
        .weakness-item {
            border-left: 3px solid var(--warning);
        }
        
        /* Certificate */
        .certificate {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(37, 99, 235, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .certificate-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--success);
            margin-bottom: 15px;
        }
        
        .certificate-code {
            font-family: monospace;
            font-size: 1.5rem;
            background: rgba(0,0,0,0.3);
            padding: 15px 25px;
            border-radius: 8px;
            color: #fbbf24;
            letter-spacing: 2px;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: #1e293b;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #f1f5f9;
        }
        
        .modal-body {
            color: #94a3b8;
            margin-bottom: 25px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* Screen visibility */
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Report Print Styles */
        .report-section {
            page-break-inside: avoid;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .iq-score {
                font-size: 4rem;
            }
            
            .matrix-cell {
                width: 50px;
                height: 50px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="lang-toggle">
        <button class="lang-btn active" onclick="setLanguage('ko')">í•œêµ­ì–´</button>
        <button class="lang-btn" onclick="setLanguage('en')">English</button>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo">COGNIQ</div>
            <p class="tagline" data-i18n="tagline">Official Intelligence Quotient Assessment</p>
        </header>

        <!-- Screen 1: Intro -->
        <div id="screen-intro" class="screen active">
            <div class="card">
                <h2 class="card-title" data-i18n="intro.title">ê³µì¸ IQ í…ŒìŠ¤íŠ¸</h2>
                
                <div class="info-box highlight">
                    <p class="highlight-text" data-i18n="intro.highlight">
                        ğŸ¯ 5ê°€ì§€ ì˜ì—­ ì¤‘ 1ê°€ì§€ë¥¼ ì„ íƒí•˜ì—¬ IQ 120 ì´ìƒ ë‹¬ì„± ì‹œ<br>ë©˜ì‚¬ ë„ì „ ìê²©ì´ ì£¼ì–´ì§‘ë‹ˆë‹¤.
                    </p>
                </div>
                
                <!-- Age Input -->
                <div class="age-section">
                    <div class="age-input-group">
                        <label data-i18n="intro.age">ë‚˜ì´ (ë§Œ):</label>
                        <input type="number" id="userAge" min="13" max="99" placeholder="25">
                        <span data-i18n="intro.ageUnit">ì„¸</span>
                    </div>
                    <p class="age-note" data-i18n="intro.ageNote">* ì—°ë ¹ë³„ ê·œì¤€ì„ ì ìš©í•˜ì—¬ ì •í™•í•œ IQë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.</p>
                </div>
                
                <!-- Category Selection -->
                <p style="margin-bottom: 15px; color: #94a3b8;" data-i18n="intro.selectCategory">í…ŒìŠ¤íŠ¸ ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”:</p>
                
                <div class="category-grid">
                    <div class="category-card" data-category="pattern" onclick="selectCategory('pattern')">
                        <div class="category-icon">ğŸ”·</div>
                        <div class="category-name" data-i18n="category.pattern">íŒ¨í„´ ì¸ì‹</div>
                    </div>
                    <div class="category-card" data-category="numerical" onclick="selectCategory('numerical')">
                        <div class="category-icon">ğŸ”¢</div>
                        <div class="category-name" data-i18n="category.numerical">ìˆ˜ë¦¬ ì¶”ë¡ </div>
                    </div>
                    <div class="category-card" data-category="spatial" onclick="selectCategory('spatial')">
                        <div class="category-icon">ğŸ“</div>
                        <div class="category-name" data-i18n="category.spatial">ê³µê°„ ì§€ê°</div>
                    </div>
                    <div class="category-card" data-category="logical" onclick="selectCategory('logical')">
                        <div class="category-icon">ğŸ§©</div>
                        <div class="category-name" data-i18n="category.logical">ë…¼ë¦¬ ì¶”ë¡ </div>
                    </div>
                    <div class="category-card" data-category="verbal" onclick="selectCategory('verbal')">
                        <div class="category-icon">ğŸ“</div>
                        <div class="category-name" data-i18n="category.verbal">ì–¸ì–´ ìœ ì¶”</div>
                    </div>
                </div>
                
                <div class="info-box" id="selectionInfo" style="display: none;">
                    <p id="selectionText"></p>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 25px;">
                    <button class="btn btn-primary" id="startBtn" onclick="startTest()" disabled data-i18n="intro.selectFirst">
                        ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”
                    </button>
                    <button class="btn btn-secondary" onclick="showCodeInput()" data-i18n="intro.havingCode">
                        ğŸ”‘ ì¸ì¦ì½”ë“œ ì…ë ¥
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 15px; color: #f1f5f9;" data-i18n="intro.method">ğŸ“Š í‰ê°€ ë°©ë²•ë¡ </h3>
                <ul style="color: #94a3b8; padding-left: 20px;">
                    <li data-i18n="intro.method1">ë¬¸í•­ë°˜ì‘ì´ë¡ (IRT) 3PL ëª¨ë¸ ê¸°ë°˜</li>
                    <li data-i18n="intro.method2">ìµœëŒ€ìš°ë„ì¶”ì •(MLE)ìœ¼ë¡œ ëŠ¥ë ¥ ì‚°ì¶œ</li>
                    <li data-i18n="intro.method3">95% ì‹ ë¢°êµ¬ê°„ ì œê³µ</li>
                    <li data-i18n="intro.method4">ì—°ë ¹ë³„ ê·œì¤€ ì ìš©</li>
                </ul>
            </div>
        </div>

        <!-- Screen 2: Test -->
        <div id="screen-test" class="screen">
            <div class="card">
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="progressText">1 / 10</span>
                        <span id="categoryLabel"></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 10%"></div>
                    </div>
                </div>
                
                <div class="timer" id="timer">
                    â±ï¸ <span id="timerValue">45</span>
                </div>
                
                <div class="question-container">
                    <p class="question-text" id="questionText"></p>
                    <div class="question-visual" id="questionVisual"></div>
                </div>
                
                <div class="options-grid" id="optionsContainer"></div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 25px;">
                    <button class="btn btn-danger" onclick="confirmExit()" data-i18n="test.exit">
                        âœ• ì¢…ë£Œ
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled data-i18n="test.next">
                        ë‹¤ìŒ â†’
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 3: Results -->
        <div id="screen-result" class="screen">
            <div class="card result-container">
                <h2 class="card-title" data-i18n="result.title">ğŸ“Š IQ í‰ê°€ ê²°ê³¼</h2>
                
                <div class="iq-display">
                    <div class="iq-score" id="resultIQ">--</div>
                    <div class="iq-label" data-i18n="result.iqLabel">ì—°ë ¹ ë³´ì • IQ</div>
                    <div class="confidence-interval" id="resultCI">
                        95% CI: -- ~ --
                    </div>
                </div>
                
                <div class="classification">
                    <div class="class-label" id="resultClass">--</div>
                    <div class="percentile" id="resultPercentile">ë°±ë¶„ìœ„ --%</div>
                </div>
                
                <!-- Domain Analysis -->
                <div class="domain-chart" id="domainChart">
                    <h3 style="margin-bottom: 20px; text-align: left;" data-i18n="result.domainTitle">ì˜ì—­ë³„ ë¶„ì„</h3>
                </div>
                
                <!-- Strengths & Weaknesses -->
                <div class="analysis-section" id="analysisSection">
                    <div id="strengthsContainer"></div>
                    <div id="weaknessesContainer" style="margin-top: 20px;"></div>
                </div>
                
                <!-- Age Interpretation -->
                <div class="info-box" id="ageInterpretation" style="text-align: left;"></div>
                
                <!-- Certificate (if qualified) -->
                <div class="certificate" id="certificate" style="display: none;">
                    <div class="certificate-title" data-i18n="result.qualified">ğŸ‰ ë©˜ì‚¬ ë„ì „ ìê²© íšë“!</div>
                    <p style="margin-bottom: 15px; color: #94a3b8;" data-i18n="result.codeDesc">ì•„ë˜ ì½”ë“œë¡œ ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ì— ë„ì „í•˜ì„¸ìš”:</p>
                    <div class="certificate-code" id="certCode">CQ-XXXXXXXX</div>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="tryAnotherCategory()" data-i18n="result.tryAnother">
                        ğŸ”„ ë‹¤ë¥¸ ì˜ì—­ ë„ì „
                    </button>
                    <button class="btn btn-success" id="mensaBtn" onclick="goToMensa()" style="display: none;" data-i18n="result.goMensa">
                        ğŸ† ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ ë„ì „
                    </button>
                    <button class="btn btn-primary" onclick="printReport()" data-i18n="result.print">
                        ğŸ“„ ë¦¬í¬íŠ¸ ì¶œë ¥
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 4: Mensa Test -->
        <div id="screen-mensa" class="screen">
            <div class="card">
                <h2 class="card-title">ğŸ† <span data-i18n="mensa.title">ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸</span></h2>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="mensaProgressText">1 / 20</span>
                        <span data-i18n="mensa.subtitle">ê³ ê¸‰ ë¬¸ì œ</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mensaProgressFill" style="width: 5%"></div>
                    </div>
                </div>
                
                <div class="timer" id="mensaTimer">
                    â±ï¸ <span id="mensaTimerValue">60</span>
                </div>
                
                <div class="question-container">
                    <p class="question-text" id="mensaQuestionText"></p>
                    <div class="question-visual" id="mensaQuestionVisual"></div>
                </div>
                
                <div class="options-grid" id="mensaOptionsContainer"></div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 25px;">
                    <button class="btn btn-danger" onclick="confirmExit()" data-i18n="test.exit">
                        âœ• ì¢…ë£Œ
                    </button>
                    <button class="btn btn-primary" id="mensaNextBtn" onclick="nextMensaQuestion()" disabled data-i18n="test.next">
                        ë‹¤ìŒ â†’
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 5: Mensa Results -->
        <div id="screen-mensa-result" class="screen">
            <div class="card result-container">
                <h2 class="card-title">ğŸ† <span data-i18n="mensaResult.title">ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼</span></h2>
                
                <div class="iq-display">
                    <div class="iq-score" id="mensaResultIQ">--</div>
                    <div class="iq-label" data-i18n="mensaResult.iqLabel">ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ IQ</div>
                    <div class="confidence-interval" id="mensaResultCI">
                        95% CI: -- ~ --
                    </div>
                </div>
                
                <div class="classification">
                    <div class="class-label" id="mensaResultClass">--</div>
                    <div class="percentile" id="mensaResultPercentile">ë°±ë¶„ìœ„ --%</div>
                </div>
                
                <div class="certificate" id="mensaCertificate" style="display: none;">
                    <div class="certificate-title" data-i18n="mensaResult.passed">ğŸŠ ë©˜ì‚¬ ê¸°ì¤€ í†µê³¼!</div>
                    <p style="color: #94a3b8;" data-i18n="mensaResult.passedDesc">
                        ì¶•í•˜í•©ë‹ˆë‹¤! ìƒìœ„ 2% ì´ë‚´ì˜ ë›°ì–´ë‚œ ì¸ì§€ëŠ¥ë ¥ì„ ë³´ìœ í•˜ê³  ê³„ì‹­ë‹ˆë‹¤.
                    </p>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="location.reload()" data-i18n="mensaResult.restart">
                        ğŸ”„ ì²˜ìŒìœ¼ë¡œ
                    </button>
                    <button class="btn btn-primary" onclick="printReport()" data-i18n="result.print">
                        ğŸ“„ ë¦¬í¬íŠ¸ ì¶œë ¥
                    </button>
                </div>
            </div>
        </div>

        <!-- Code Input Modal -->
        <div class="modal-overlay" id="codeModal">
            <div class="modal">
                <h3 class="modal-title" data-i18n="modal.codeTitle">ğŸ”‘ ì¸ì¦ì½”ë“œ ì…ë ¥</h3>
                <div class="modal-body">
                    <input type="text" id="codeInput" placeholder="CQ-XXXXXXXX" 
                        style="width: 100%; padding: 15px; border: 2px solid rgba(255,255,255,0.1); 
                        border-radius: 8px; background: rgba(0,0,0,0.2); color: white; 
                        font-size: 1.2rem; text-align: center; text-transform: uppercase;">
                    <p id="codeError" style="color: var(--danger); margin-top: 10px; display: none;"></p>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="hideCodeInput()" data-i18n="modal.cancel">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="verifyCode()" data-i18n="modal.verify">í™•ì¸</button>
                </div>
            </div>
        </div>

        <!-- Exit Confirmation Modal -->
        <div class="modal-overlay" id="exitModal">
            <div class="modal">
                <h3 class="modal-title" data-i18n="modal.exitTitle">âš ï¸ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ</h3>
                <div class="modal-body" data-i18n="modal.exitBody">
                    ì •ë§ í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="hideExitModal()" data-i18n="modal.continue">ê³„ì†í•˜ê¸°</button>
                    <button class="btn btn-danger" onclick="exitTest()" data-i18n="modal.exitConfirm">ì¢…ë£Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë‹¤êµ­ì–´ ì§€ì›
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const i18n = {
        ko: {
            tagline: "ê³µì‹ ì§€ëŠ¥ì§€ìˆ˜ í‰ê°€",
            "intro.title": "ê³µì¸ IQ í…ŒìŠ¤íŠ¸",
            "intro.highlight": "ğŸ¯ 5ê°€ì§€ ì˜ì—­ ì¤‘ 1ê°€ì§€ë¥¼ ì„ íƒí•˜ì—¬ IQ 120 ì´ìƒ ë‹¬ì„± ì‹œ<br>ë©˜ì‚¬ ë„ì „ ìê²©ì´ ì£¼ì–´ì§‘ë‹ˆë‹¤.",
            "intro.age": "ë‚˜ì´ (ë§Œ):",
            "intro.ageUnit": "ì„¸",
            "intro.ageNote": "* ì—°ë ¹ë³„ ê·œì¤€ì„ ì ìš©í•˜ì—¬ ì •í™•í•œ IQë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.",
            "intro.selectCategory": "í…ŒìŠ¤íŠ¸ ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”:",
            "intro.selectFirst": "ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”",
            "intro.start": "í…ŒìŠ¤íŠ¸ ì‹œì‘",
            "intro.havingCode": "ğŸ”‘ ì¸ì¦ì½”ë“œ ì…ë ¥",
            "intro.method": "ğŸ“Š í‰ê°€ ë°©ë²•ë¡ ",
            "intro.method1": "ë¬¸í•­ë°˜ì‘ì´ë¡ (IRT) 3PL ëª¨ë¸ ê¸°ë°˜",
            "intro.method2": "ìµœëŒ€ìš°ë„ì¶”ì •(MLE)ìœ¼ë¡œ ëŠ¥ë ¥ ì‚°ì¶œ",
            "intro.method3": "95% ì‹ ë¢°êµ¬ê°„ ì œê³µ",
            "intro.method4": "ì—°ë ¹ë³„ ê·œì¤€ ì ìš©",
            "category.pattern": "íŒ¨í„´ ì¸ì‹",
            "category.numerical": "ìˆ˜ë¦¬ ì¶”ë¡ ",
            "category.spatial": "ê³µê°„ ì§€ê°",
            "category.logical": "ë…¼ë¦¬ ì¶”ë¡ ",
            "category.verbal": "ì–¸ì–´ ìœ ì¶”",
            "test.exit": "âœ• ì¢…ë£Œ",
            "test.next": "ë‹¤ìŒ â†’",
            "test.submit": "ì œì¶œ",
            "result.title": "ğŸ“Š IQ í‰ê°€ ê²°ê³¼",
            "result.iqLabel": "ì—°ë ¹ ë³´ì • IQ",
            "result.domainTitle": "ì˜ì—­ë³„ ë¶„ì„",
            "result.strengths": "ğŸ’ª ê°•ì ",
            "result.weaknesses": "ğŸ“ˆ ê°œì„  ì˜ì—­",
            "result.qualified": "ğŸ‰ ë©˜ì‚¬ ë„ì „ ìê²© íšë“!",
            "result.codeDesc": "ì•„ë˜ ì½”ë“œë¡œ ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ì— ë„ì „í•˜ì„¸ìš”:",
            "result.tryAnother": "ğŸ”„ ë‹¤ë¥¸ ì˜ì—­ ë„ì „",
            "result.goMensa": "ğŸ† ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ ë„ì „",
            "result.print": "ğŸ“„ ë¦¬í¬íŠ¸ ì¶œë ¥",
            "mensa.title": "ë©˜ì‚¬ ë„ì „ í…ŒìŠ¤íŠ¸",
            "mensa.subtitle": "ê³ ê¸‰ ë¬¸ì œ",
            "mensaResult.title": "ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼",
            "mensaResult.iqLabel": "ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ IQ",
            "mensaResult.passed": "ğŸŠ ë©˜ì‚¬ ê¸°ì¤€ í†µê³¼!",
            "mensaResult.passedDesc": "ì¶•í•˜í•©ë‹ˆë‹¤! ìƒìœ„ 2% ì´ë‚´ì˜ ë›°ì–´ë‚œ ì¸ì§€ëŠ¥ë ¥ì„ ë³´ìœ í•˜ê³  ê³„ì‹­ë‹ˆë‹¤.",
            "mensaResult.restart": "ğŸ”„ ì²˜ìŒìœ¼ë¡œ",
            "modal.codeTitle": "ğŸ”‘ ì¸ì¦ì½”ë“œ ì…ë ¥",
            "modal.cancel": "ì·¨ì†Œ",
            "modal.verify": "í™•ì¸",
            "modal.exitTitle": "âš ï¸ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ",
            "modal.exitBody": "ì •ë§ í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            "modal.continue": "ê³„ì†í•˜ê¸°",
            "modal.exitConfirm": "ì¢…ë£Œ",
            "modal.invalidCode": "ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œì…ë‹ˆë‹¤.",
            "selectionInfo": "ì„ íƒ: {category} | 10ë¬¸í•­ | ë¬¸í•­ë‹¹ 45ì´ˆ | IQ 120+ ì‹œ ë©˜ì‚¬ ìê²©"
        },
        en: {
            tagline: "Official Intelligence Quotient Assessment",
            "intro.title": "Official IQ Test",
            "intro.highlight": "ğŸ¯ Select 1 of 5 domains. Score IQ 120+ to<br>qualify for the Mensa Challenge.",
            "intro.age": "Age:",
            "intro.ageUnit": "years",
            "intro.ageNote": "* Age-adjusted norms applied for accurate IQ calculation.",
            "intro.selectCategory": "Select a test domain:",
            "intro.selectFirst": "Select a domain",
            "intro.start": "Start Test",
            "intro.havingCode": "ğŸ”‘ Enter Code",
            "intro.method": "ğŸ“Š Assessment Methodology",
            "intro.method1": "Based on Item Response Theory (IRT) 3PL Model",
            "intro.method2": "Maximum Likelihood Estimation (MLE)",
            "intro.method3": "95% Confidence Interval Provided",
            "intro.method4": "Age-based Norms Applied",
            "category.pattern": "Pattern Recognition",
            "category.numerical": "Numerical Reasoning",
            "category.spatial": "Spatial Perception",
            "category.logical": "Logical Reasoning",
            "category.verbal": "Verbal Analogies",
            "test.exit": "âœ• Exit",
            "test.next": "Next â†’",
            "test.submit": "Submit",
            "result.title": "ğŸ“Š IQ Assessment Results",
            "result.iqLabel": "Age-Adjusted IQ",
            "result.domainTitle": "Domain Analysis",
            "result.strengths": "ğŸ’ª Strengths",
            "result.weaknesses": "ğŸ“ˆ Areas for Improvement",
            "result.qualified": "ğŸ‰ Mensa Challenge Qualified!",
            "result.codeDesc": "Use this code to take the Mensa test:",
            "result.tryAnother": "ğŸ”„ Try Another Domain",
            "result.goMensa": "ğŸ† Take Mensa Test",
            "result.print": "ğŸ“„ Print Report",
            "mensa.title": "Mensa Challenge Test",
            "mensa.subtitle": "Advanced Problems",
            "mensaResult.title": "Mensa Test Results",
            "mensaResult.iqLabel": "Mensa Test IQ",
            "mensaResult.passed": "ğŸŠ Mensa Standard Achieved!",
            "mensaResult.passedDesc": "Congratulations! You demonstrate cognitive abilities in the top 2%.",
            "mensaResult.restart": "ğŸ”„ Start Over",
            "modal.codeTitle": "ğŸ”‘ Enter Verification Code",
            "modal.cancel": "Cancel",
            "modal.verify": "Verify",
            "modal.exitTitle": "âš ï¸ Exit Test",
            "modal.exitBody": "Are you sure you want to exit? Progress will not be saved.",
            "modal.continue": "Continue",
            "modal.exitConfirm": "Exit",
            "modal.invalidCode": "Invalid code.",
            "selectionInfo": "Selected: {category} | 10 items | 45s each | IQ 120+ for Mensa"
        }
    };
    
    let currentLang = 'ko';
    
    function setLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.textContent.includes(lang === 'ko' ? 'í•œêµ­ì–´' : 'English'));
        });
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (i18n[lang][key]) {
                el.innerHTML = i18n[lang][key];
            }
        });
        updateSelectionInfo();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // IRT ë¬¸ì œ ë°ì´í„°ë² ì´ìŠ¤
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const IQ_TEST_ITEMS = {
        pattern: [
            { id: "PAT001", irt: { a: 1.0, b: -2.0, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["â—", "â—", "â—", "â—", "â—", "â—", "â—", "â—", "?"], options: ["â—", "â—‹", "â– ", "â–²"], answer: 0 },
            { id: "PAT002", irt: { a: 1.0, b: -1.8, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "2", "3", "1", "2", "3", "1", "2", "?"], options: ["1", "2", "3", "4"], answer: 2 },
            { id: "PAT003", irt: { a: 1.1, b: -1.5, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["A", "A", "A", "B", "B", "B", "C", "C", "?"], options: ["A", "B", "C", "D"], answer: 2 },
            { id: "PAT004", irt: { a: 1.2, b: -1.0, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "2", "3", "4", "5", "6", "7", "8", "?"], options: ["9", "10", "0", "7"], answer: 0 },
            { id: "PAT005", irt: { a: 1.3, b: -0.5, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["A", "B", "C", "D", "E", "F", "G", "H", "?"], options: ["I", "J", "G", "A"], answer: 0 },
            { id: "PAT006", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["2", "4", "6", "3", "6", "9", "4", "8", "?"], options: ["10", "12", "14", "16"], answer: 1 },
            { id: "PAT007", irt: { a: 1.6, b: 0.3, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["A", "C", "E", "B", "D", "F", "C", "E", "?"], options: ["F", "G", "H", "I"], answer: 1 },
            { id: "PAT008", irt: { a: 1.8, b: 1.0, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "1", "1", "2", "4", "8", "3", "9", "?"], options: ["12", "18", "27", "36"], answer: 2 },
            { id: "PAT009", irt: { a: 1.9, b: 1.3, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["2", "3", "6", "4", "5", "20", "6", "7", "?"], options: ["13", "36", "42", "48"], answer: 2 },
            { id: "PAT010", irt: { a: 2.0, b: 1.8, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["2", "4", "8", "3", "9", "27", "4", "16", "?"], options: ["32", "48", "64", "256"], answer: 2 },
            { id: "PAT011", irt: { a: 2.1, b: 1.9, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "8", "27", "64", "125", "216", "343", "512", "?"], options: ["625", "729", "1000", "1024"], answer: 1 },
            { id: "PAT012", irt: { a: 2.2, b: 2.3, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["2", "6", "18", "4", "12", "36", "8", "24", "?"], options: ["48", "64", "72", "96"], answer: 2 },
            { id: "PAT013", irt: { a: 2.3, b: 2.5, c: 0.25 }, question: { ko: "ê·œì¹™ì„ ì°¾ì•„ ? ì— ë“¤ì–´ê°ˆ ê²ƒì„ ê³ ë¥´ì„¸ìš”.", en: "Find the pattern for ?" }, matrix: ["1", "1", "2", "3", "5", "8", "13", "21", "?"], options: ["29", "32", "34", "36"], answer: 2 }
        ],
        
        numerical: [
            { id: "NUM001", irt: { a: 1.0, b: -2.0, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 2, 3, 4, ?", en: "Next term: 1, 2, 3, 4, ?" }, type: "sequence", options: ["5", "6", "4", "3"], answer: 0 },
            { id: "NUM002", irt: { a: 1.0, b: -1.8, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 2, 4, 6, 8, ?", en: "Next term: 2, 4, 6, 8, ?" }, type: "sequence", options: ["9", "10", "11", "12"], answer: 1 },
            { id: "NUM003", irt: { a: 1.1, b: -1.5, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 10, 20, 30, 40, ?", en: "Next term: 10, 20, 30, 40, ?" }, type: "sequence", options: ["45", "50", "55", "60"], answer: 1 },
            { id: "NUM004", irt: { a: 1.3, b: -0.7, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 2, 4, 8, 16, ?", en: "Next term: 2, 4, 8, 16, ?" }, type: "sequence", options: ["24", "32", "30", "20"], answer: 1 },
            { id: "NUM005", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 1, 2, 3, 5, 8, ?", en: "Next term: 1, 1, 2, 3, 5, 8, ?" }, type: "sequence", options: ["11", "12", "13", "15"], answer: 2 },
            { id: "NUM006", irt: { a: 1.6, b: 0.4, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 4, 9, 16, 25, ?", en: "Next term: 1, 4, 9, 16, 25, ?" }, type: "sequence", options: ["30", "35", "36", "49"], answer: 2 },
            { id: "NUM007", irt: { a: 1.8, b: 1.0, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 3, 6, 10, 15, ?", en: "Next term: 1, 3, 6, 10, 15, ?" }, type: "sequence", options: ["18", "20", "21", "25"], answer: 2 },
            { id: "NUM008", irt: { a: 1.8, b: 1.2, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 2, 3, 5, 7, 11, 13, ?", en: "Next term: 2, 3, 5, 7, 11, 13, ?" }, type: "sequence", options: ["15", "17", "19", "21"], answer: 1 },
            { id: "NUM009", irt: { a: 1.9, b: 1.5, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 2, 6, 24, 120, ?", en: "Next term: 1, 2, 6, 24, 120, ?" }, type: "sequence", options: ["240", "480", "720", "840"], answer: 2 },
            { id: "NUM010", irt: { a: 2.0, b: 1.8, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 4, 27, 256, ?", en: "Next term: 1, 4, 27, 256, ?" }, type: "sequence", options: ["625", "1024", "3125", "4096"], answer: 2 },
            { id: "NUM011", irt: { a: 2.2, b: 2.2, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 2, 5, 11, 23, 47, ?", en: "Next term: 2, 5, 11, 23, 47, ?" }, type: "sequence", options: ["71", "89", "95", "99"], answer: 2 },
            { id: "NUM012", irt: { a: 2.2, b: 2.4, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 1, 2, 5, 14, 41, ?", en: "Next term: 1, 2, 5, 14, 41, ?" }, type: "sequence", options: ["100", "114", "122", "130"], answer: 2 },
            { id: "NUM013", irt: { a: 2.3, b: 2.5, c: 0.25 }, question: { ko: "ìˆ˜ì—´ì˜ ë‹¤ìŒ í•­: 2, 3, 5, 9, 17, 33, ?", en: "Next term: 2, 3, 5, 9, 17, 33, ?" }, type: "sequence", options: ["49", "57", "65", "73"], answer: 2 }
        ],
        
        spatial: [
            { id: "SPA001", irt: { a: 1.0, b: -2.0, c: 0.25 }, question: { ko: "â†’ ë¥¼ 180Â° íšŒì „í•˜ë©´?", en: "Rotate â†’ by 180Â°?" }, type: "rotation", options: ["â†’", "â†", "â†‘", "â†“"], answer: 1 },
            { id: "SPA002", irt: { a: 1.0, b: -1.8, c: 0.25 }, question: { ko: "â†‘ ë¥¼ ì‹œê³„ë°©í–¥ 90Â° íšŒì „í•˜ë©´?", en: "Rotate â†‘ clockwise 90Â°?" }, type: "rotation", options: ["â†", "â†’", "â†‘", "â†“"], answer: 1 },
            { id: "SPA003", irt: { a: 1.2, b: -1.0, c: 0.25 }, question: { ko: "â”˜ ë¥¼ ì‹œê³„ë°©í–¥ 90Â° íšŒì „í•˜ë©´?", en: "Rotate â”˜ clockwise 90Â°?" }, type: "rotation", options: ["â””", "â”", "â”Œ", "â”€"], answer: 0 },
            { id: "SPA004", irt: { a: 1.3, b: -0.5, c: 0.25 }, question: { ko: "'b'ë¥¼ ê±°ìš¸ì— ë¹„ì¶”ë©´?", en: "Mirror image of 'b'?" }, type: "mirror", options: ["b", "d", "p", "q"], answer: 1 },
            { id: "SPA005", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "ì£¼ì‚¬ìœ„ì—ì„œ 1ì˜ ë§ì€í¸ ìˆ«ìëŠ”? (1-6, 2-5, 3-4)", en: "Opposite of 1 on die? (1-6, 2-5, 3-4)" }, type: "cube", options: ["2", "4", "5", "6"], answer: 3 },
            { id: "SPA006", irt: { a: 1.6, b: 0.4, c: 0.25 }, question: { ko: "ì •ì‚¬ê°í˜•ì„ ë°˜ìœ¼ë¡œ ì ‘ìœ¼ë©´?", en: "Fold square in half?" }, type: "folding", options: { ko: ["ì •ì‚¬ê°í˜•", "ì§ì‚¬ê°í˜•", "ì‚¼ê°í˜•", "ë§ˆë¦„ëª¨"], en: ["Square", "Rectangle", "Triangle", "Rhombus"] }, answer: 1 },
            { id: "SPA007", irt: { a: 1.8, b: 1.0, c: 0.25 }, question: { ko: "ì§ê°ì‚¼ê°í˜• 2ê°œë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë„í˜•ì€?", en: "What can 2 right triangles make?" }, type: "construction", options: { ko: ["ì •ì‚¼ê°í˜•ë§Œ", "ì§ì‚¬ê°í˜•ë§Œ", "ë‘˜ ë‹¤ ê°€ëŠ¥", "í‰í–‰ì‚¬ë³€í˜•ë§Œ"], en: ["Only equilateral", "Only rectangle", "Both possible", "Only parallelogram"] }, answer: 2 },
            { id: "SPA008", irt: { a: 1.9, b: 1.4, c: 0.25 }, question: { ko: "ì •ìœ¡ë©´ì²´ë¥¼ ëŒ€ê°ì„ ìœ¼ë¡œ ìë¥´ë©´ ë‹¨ë©´ì€?", en: "Diagonal cross-section of cube?" }, type: "cross_section", options: { ko: ["ì •ì‚¼ê°í˜•", "ì •ì‚¬ê°í˜•", "ì§ì‚¬ê°í˜•", "ì •ìœ¡ê°í˜•"], en: ["Equilateral triangle", "Square", "Rectangle", "Regular hexagon"] }, answer: 3 },
            { id: "SPA009", irt: { a: 2.0, b: 1.9, c: 0.25 }, question: { ko: "3cm ì •ìœ¡ë©´ì²´ì—ì„œ 1cm ì •ìœ¡ë©´ì²´ 8ê°œ ì œê±° ì‹œ ë‚¨ì€ ë¶€í”¼?", en: "3cm cube minus 8 1cm cubes. Remaining volume?" }, type: "volume", options: ["19cmÂ³", "21cmÂ³", "23cmÂ³", "25cmÂ³"], answer: 0 },
            { id: "SPA010", irt: { a: 2.2, b: 2.2, c: 0.25 }, question: { ko: "ì •ì´ì‹­ë©´ì²´ì˜ ë©´ ê°œìˆ˜ëŠ”?", en: "Faces of icosahedron?" }, type: "polyhedron", options: ["12", "16", "20", "24"], answer: 2 },
            { id: "SPA011", irt: { a: 2.2, b: 2.4, c: 0.25 }, question: { ko: "ì›ê¸°ë‘¥ì˜ ìœ„, ì•, ì˜† ëª¨ì–‘ì€?", en: "Top, front, side views of cylinder?" }, type: "projection", options: { ko: ["ì›,ì§ì‚¬ê°í˜•,ì§ì‚¬ê°í˜•", "ì›,ì›,ì§ì‚¬ê°í˜•", "ì›,íƒ€ì›,ì§ì‚¬ê°í˜•", "ì›,ì§ì‚¬ê°í˜•,ì›"], en: ["Circle,rect,rect", "Circle,circle,rect", "Circle,ellipse,rect", "Circle,rect,circle"] }, answer: 0 },
            { id: "SPA012", irt: { a: 2.3, b: 2.5, c: 0.25 }, question: { ko: "ë„ë„›(í† ëŸ¬ìŠ¤)ê³¼ ìœ„ìƒë™í˜•ì¸ ê²ƒì€?", en: "Topologically equivalent to torus?" }, type: "topology", options: { ko: ["ê³µ", "ì†ì¡ì´ ìˆëŠ” ì»µ", "ì ‘ì‹œ", "ìˆŸê°€ë½"], en: ["Ball", "Cup with handle", "Plate", "Spoon"] }, answer: 1 }
        ],
        
        logical: [
            { id: "LOG001", irt: { a: 1.0, b: -2.0, c: 0.25 }, question: { ko: "A > B, B > C ì´ë©´ ê°€ì¥ í° ê²ƒì€?", en: "If A > B and B > C, largest is?" }, type: "comparison", options: ["A", "B", "C", { ko: "ì•Œ ìˆ˜ ì—†ìŒ", en: "Unknown" }], answer: 0 },
            { id: "LOG002", irt: { a: 1.1, b: -1.5, c: 0.25 }, question: { ko: "ëª¨ë“  ê°•ì•„ì§€ëŠ” ë™ë¬¼ì´ë‹¤. ë°”ë‘‘ì´ëŠ” ê°•ì•„ì§€ë‹¤. ì°¸ì¸ ê²ƒì€?", en: "All dogs are animals. Baduk is a dog. True statement?" }, type: "syllogism", options: { ko: ["ë°”ë‘‘ì´ëŠ” ë™ë¬¼", "ëª¨ë“  ë™ë¬¼ì€ ê°•ì•„ì§€", "ë°”ë‘‘ì´ëŠ” ê³ ì–‘ì´", "ì•Œ ìˆ˜ ì—†ë‹¤"], en: ["Baduk is animal", "All animals are dogs", "Baduk is cat", "Unknown"] }, answer: 0 },
            { id: "LOG003", irt: { a: 1.2, b: -0.8, c: 0.25 }, question: { ko: "'ë¹„ê°€ ì˜¤ë©´ ë•…ì´ ì –ëŠ”ë‹¤'ê°€ ì°¸ì¼ ë•Œ ë°˜ë“œì‹œ ì°¸ì¸ ê²ƒì€?", en: "If 'Rain wets ground' is true, what must be true?" }, type: "conditional", options: { ko: ["ë•…ì´ ì –ìœ¼ë©´ ë¹„ê°€ ì˜¨ë‹¤", "ë¹„ ì•ˆì˜¤ë©´ ì•ˆì –ëŠ”ë‹¤", "ì•ˆì –ìœ¼ë©´ ë¹„ ì•ˆì˜¨ë‹¤", "í•­ìƒ ë¹„ê°€ ì˜¨ë‹¤"], en: ["If wet, rained", "No rain=dry", "If dry, no rain", "Always rains"] }, answer: 2 },
            { id: "LOG004", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "x + 5 = 12 ì¼ ë•Œ, x = ?", en: "If x + 5 = 12, x = ?" }, type: "equation", options: ["5", "6", "7", "17"], answer: 2 },
            { id: "LOG005", irt: { a: 1.5, b: 0.2, c: 0.25 }, question: { ko: "2x + 3 = 11 ì¼ ë•Œ, x = ?", en: "If 2x + 3 = 11, x = ?" }, type: "equation", options: ["3", "4", "5", "6"], answer: 1 },
            { id: "LOG006", irt: { a: 1.6, b: 0.5, c: 0.25 }, question: { ko: "'Pì´ë©´ Q'ê°€ ì°¸ì´ê³  'P'ê°€ ì°¸ì¼ ë•Œ, QëŠ”?", en: "If 'P implies Q' is true and P is true, Q is?" }, type: "conditional", options: { ko: ["ë°˜ë“œì‹œ ì°¸", "ë°˜ë“œì‹œ ê±°ì§“", "ì•Œ ìˆ˜ ì—†ìŒ", "ë•Œì— ë”°ë¼"], en: ["Must be true", "Must be false", "Unknown", "Depends"] }, answer: 0 },
            { id: "LOG007", irt: { a: 1.8, b: 1.0, c: 0.25 }, question: { ko: "(x + 5) Ã· 3 = 4 ì¼ ë•Œ, x = ?", en: "If (x + 5) Ã· 3 = 4, x = ?" }, type: "equation", options: ["5", "6", "7", "8"], answer: 2 },
            { id: "LOG008", irt: { a: 1.9, b: 1.4, c: 0.25 }, question: { ko: "A,B,C ì¤‘ ì •í™•íˆ í•˜ë‚˜ë§Œ ì°¸. Aê°€ ê±°ì§“ì´ë©´?", en: "Exactly one of A,B,C true. If A false?" }, type: "set", options: { ko: ["Bë‚˜ C í•˜ë‚˜ ì°¸", "B,C ëª¨ë‘ ì°¸", "B,C ëª¨ë‘ ê±°ì§“", "ì•Œ ìˆ˜ ì—†ìŒ"], en: ["One of B,C true", "Both B,C true", "Both B,C false", "Unknown"] }, answer: 0 },
            { id: "LOG009", irt: { a: 2.0, b: 1.8, c: 0.25 }, question: { ko: "ê¸°ì‚¬(ì§„ì‹¤)ì™€ ì•…ë‹¹(ê±°ì§“). A:'BëŠ” ì•…ë‹¹' B:'ë‘˜ ë‹¤ ê¸°ì‚¬'. Aì™€ BëŠ”?", en: "Knights(truth), Knaves(lies). A:'B is knave' B:'Both knights'. A and B?" }, type: "knights", options: { ko: ["ë‘˜ ë‹¤ ê¸°ì‚¬", "ë‘˜ ë‹¤ ì•…ë‹¹", "Aê¸°ì‚¬ Bì•…ë‹¹", "Aì•…ë‹¹ Bê¸°ì‚¬"], en: ["Both knights", "Both knaves", "A knight B knave", "A knave B knight"] }, answer: 2 },
            { id: "LOG010", irt: { a: 2.0, b: 1.9, c: 0.25 }, question: { ko: "ëª¬í‹°í™€: ë¬¸ ì„ íƒ í›„ ë¹ˆ ë¬¸ ê³µê°œ. ë°”ê¾¸ëŠ” ê²ƒì´ ìœ ë¦¬?", en: "Monty Hall: After choosing, empty door opened. Switch?" }, type: "probability", options: { ko: ["ë°”ê¾¸ë©´ ìœ ë¦¬(2/3)", "ì•ˆë°”ê¾¸ë©´ ìœ ë¦¬", "ê°™ë‹¤(1/2)", "ì•Œ ìˆ˜ ì—†ìŒ"], en: ["Switch better(2/3)", "Stay better", "Same(1/2)", "Unknown"] }, answer: 0 },
            { id: "LOG011", irt: { a: 2.2, b: 2.2, c: 0.25 }, question: { ko: "'ì´ ë¬¸ì¥ì€ ê±°ì§“ì´ë‹¤'ì˜ ì§„ë¦¬ê°’ì€?", en: "Truth value of 'This sentence is false'?" }, type: "paradox", options: { ko: ["ì°¸", "ê±°ì§“", "ì°¸ë„ ê±°ì§“ë„ ì•„ë‹˜", "ì°¸ì´ë©´ì„œ ê±°ì§“"], en: ["True", "False", "Neither", "Both"] }, answer: 2 },
            { id: "LOG012", irt: { a: 2.3, b: 2.5, c: 0.25 }, question: { ko: "ì£„ìˆ˜ì˜ ë”œë ˆë§ˆì—ì„œ ë‘˜ ë‹¤ í•©ë¦¬ì ì´ë©´?", en: "In Prisoner's Dilemma, if both rational?" }, type: "game_theory", options: { ko: ["ë‘˜ ë‹¤ í˜‘ë ¥", "ë‘˜ ë‹¤ ë°°ì‹ ", "í•œ ëª…ë§Œ ë°°ì‹ ", "ë¬´ì‘ìœ„"], en: ["Both cooperate", "Both defect", "One defects", "Random"] }, answer: 1 }
        ],
        
        verbal: [
            { id: "VER001", irt: { a: 1.0, b: -2.0, c: 0.25 }, question: { ko: "ì•„ë²„ì§€ : ì•„ë“¤ = ì–´ë¨¸ë‹ˆ : ?", en: "Father : Son = Mother : ?" }, type: "analogy", options: { ko: ["ë‚¨í¸", "ì•„ë²„ì§€", "ë”¸", "í• ë¨¸ë‹ˆ"], en: ["Husband", "Father", "Daughter", "Grandmother"] }, answer: 2 },
            { id: "VER002", irt: { a: 1.0, b: -1.8, c: 0.25 }, question: { ko: "í° : ì‘ì€ = ë†’ì€ : ?", en: "Big : Small = High : ?" }, type: "analogy", options: { ko: ["ê¹Šì€", "ë‚®ì€", "ë©€ë¦¬", "ê°€ê¹Œìš´"], en: ["Deep", "Low", "Far", "Near"] }, answer: 1 },
            { id: "VER003", irt: { a: 1.2, b: -1.0, c: 0.25 }, question: { ko: "ì±… : ì½ë‹¤ = ìŒì•… : ?", en: "Book : Read = Music : ?" }, type: "analogy", options: { ko: ["ì•…ê¸°", "ë“£ë‹¤", "ê°€ìˆ˜", "ì½˜ì„œíŠ¸"], en: ["Instrument", "Listen", "Singer", "Concert"] }, answer: 1 },
            { id: "VER004", irt: { a: 1.3, b: -0.5, c: 0.25 }, question: { ko: "ì˜ì‚¬ : ë³‘ì› = êµì‚¬ : ?", en: "Doctor : Hospital = Teacher : ?" }, type: "analogy", options: { ko: ["í•™ìƒ", "í•™êµ", "êµì‹¤", "êµìœ¡"], en: ["Student", "School", "Classroom", "Education"] }, answer: 1 },
            { id: "VER005", irt: { a: 1.5, b: 0.0, c: 0.25 }, question: { ko: "ì† : ì¥ê°‘ = ë¨¸ë¦¬ : ?", en: "Hand : Glove = Head : ?" }, type: "analogy", options: { ko: ["ëª¨ì", "ì–¼êµ´", "ë‘ë‡Œ", "ë¨¸ë¦¬ì¹´ë½"], en: ["Hat", "Face", "Brain", "Hair"] }, answer: 0 },
            { id: "VER006", irt: { a: 1.6, b: 0.4, c: 0.25 }, question: { ko: "í™”ê°€ : ê·¸ë¦¼ = ì‘ê³¡ê°€ : ?", en: "Painter : Painting = Composer : ?" }, type: "analogy", options: { ko: ["ì•…ê¸°", "ìŒì•…", "ê°€ìˆ˜", "ë¬´ëŒ€"], en: ["Instrument", "Music", "Singer", "Stage"] }, answer: 1 },
            { id: "VER007", irt: { a: 1.8, b: 1.0, c: 0.25 }, question: { ko: "ë¹› : ì–´ë‘  = ì§€ì‹ : ?", en: "Light : Darkness = Knowledge : ?" }, type: "analogy", options: { ko: ["í•™êµ", "ë¬´ì§€", "ì±…", "ê³µë¶€"], en: ["School", "Ignorance", "Book", "Study"] }, answer: 1 },
            { id: "VER008", irt: { a: 1.8, b: 1.2, c: 0.25 }, question: { ko: "ë‚˜ë¬´ : ìˆ² = ë³„ : ?", en: "Tree : Forest = Star : ?" }, type: "analogy", options: { ko: ["í•˜ëŠ˜", "ì€í•˜", "ë‹¬", "ìš°ì£¼"], en: ["Sky", "Galaxy", "Moon", "Universe"] }, answer: 1 },
            { id: "VER009", irt: { a: 1.9, b: 1.5, c: 0.25 }, question: { ko: "ë¬¼ : ê°ˆì¦ = ìŒì‹ : ?", en: "Water : Thirst = Food : ?" }, type: "analogy", options: { ko: ["ë§›", "ë°°ê³ í””", "ìš”ë¦¬", "ì˜ì–‘"], en: ["Taste", "Hunger", "Cooking", "Nutrition"] }, answer: 1 },
            { id: "VER010", irt: { a: 2.0, b: 1.8, c: 0.25 }, question: { ko: "ì¦ìƒ : ì§„ë‹¨ = ë‹¨ì„œ : ?", en: "Symptom : Diagnosis = Clue : ?" }, type: "analogy", options: { ko: ["ë²”ì¸", "ì¶”ë¡ ", "ì¦ê±°", "í•´ê²°"], en: ["Culprit", "Deduction", "Evidence", "Solution"] }, answer: 1 },
            { id: "VER011", irt: { a: 2.0, b: 1.9, c: 0.25 }, question: { ko: "ê²¸ì† : ì˜¤ë§Œ = ì ˆì œ : ?", en: "Humility : Arrogance = Temperance : ?" }, type: "analogy", options: { ko: ["ì¸ë‚´", "íƒìš•", "í‰í™”", "ë¶„ë…¸"], en: ["Patience", "Greed", "Peace", "Anger"] }, answer: 1 },
            { id: "VER012", irt: { a: 2.3, b: 2.5, c: 0.25 }, question: { ko: "ì—”íŠ¸ë¡œí”¼ : ì—´ì—­í•™ = ë¶ˆí™•ì •ì„± : ?", en: "Entropy : Thermodynamics = Uncertainty : ?" }, type: "analogy", options: { ko: ["í™•ë¥ ", "í†µê³„í•™", "ì–‘ìì—­í•™", "ìƒëŒ€ì„±"], en: ["Probability", "Statistics", "Quantum Mechanics", "Relativity"] }, answer: 2 }
        ]
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // IRT ê³„ì‚° ì—”ì§„
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const IRTEngine = {
        // 3PL ì •ë‹µ í™•ë¥ 
        probability: function(theta, item) {
            const { a, b, c } = item.irt;
            const exp = Math.exp(a * (theta - b));
            return c + (1 - c) * (exp / (1 + exp));
        },
        
        // Fisher ì •ë³´ëŸ‰
        fisherInfo: function(theta, items) {
            let info = 0;
            items.forEach(item => {
                const p = this.probability(theta, item);
                const q = 1 - p;
                const pStar = (p - item.irt.c) / (1 - item.irt.c);
                info += item.irt.a * item.irt.a * pStar * pStar * q / p;
            });
            return info;
        },
        
        // MLE ì¶”ì •
        estimateMLE: function(responses, items, maxIter = 50) {
            let theta = 0;
            
            for (let iter = 0; iter < maxIter; iter++) {
                let firstDeriv = 0;
                let secondDeriv = 0;
                
                items.forEach((item, i) => {
                    const p = this.probability(theta, item);
                    const pStar = (p - item.irt.c) / (1 - item.irt.c);
                    const q = 1 - p;
                    
                    firstDeriv += item.irt.a * pStar * (responses[i] - p) / p;
                    secondDeriv -= item.irt.a * item.irt.a * pStar * pStar * q / p;
                });
                
                const delta = firstDeriv / Math.abs(secondDeriv);
                theta += delta;
                theta = Math.max(-4, Math.min(4, theta));
                
                if (Math.abs(delta) < 0.001) break;
            }
            
            const info = this.fisherInfo(theta, items);
            const se = 1 / Math.sqrt(Math.max(info, 0.01));
            
            return { theta, se };
        },
        
        // EAP ì¶”ì • (ê·¹ë‹¨ ì‘ë‹µìš©)
        estimateEAP: function(responses, items) {
            const points = 41;
            let numerator = 0;
            let denominator = 0;
            
            for (let i = 0; i < points; i++) {
                const theta = -4 + (i * 8 / (points - 1));
                const prior = Math.exp(-theta * theta / 2) / Math.sqrt(2 * Math.PI);
                
                let likelihood = 1;
                items.forEach((item, j) => {
                    const p = this.probability(theta, item);
                    likelihood *= responses[j] === 1 ? p : (1 - p);
                });
                
                const weight = likelihood * prior;
                numerator += theta * weight;
                denominator += weight;
            }
            
            const thetaEAP = numerator / (denominator || 0.001);
            
            // ì‚¬í›„ í‘œì¤€í¸ì°¨
            let variance = 0;
            for (let i = 0; i < points; i++) {
                const theta = -4 + (i * 8 / (points - 1));
                const prior = Math.exp(-theta * theta / 2) / Math.sqrt(2 * Math.PI);
                
                let likelihood = 1;
                items.forEach((item, j) => {
                    const p = this.probability(theta, item);
                    likelihood *= responses[j] === 1 ? p : (1 - p);
                });
                
                const weight = likelihood * prior / denominator;
                variance += weight * Math.pow(theta - thetaEAP, 2);
            }
            
            return { theta: thetaEAP, se: Math.sqrt(variance) };
        },
        
        // ëŠ¥ë ¥ ì¶”ì • (ìë™ ì„ íƒ)
        estimate: function(responses, items) {
            const correct = responses.filter(r => r === 1).length;
            
            if (correct === 0 || correct === responses.length) {
                return this.estimateEAP(responses, items);
            }
            return this.estimateMLE(responses, items);
        },
        
        // theta â†’ IQ
        toIQ: function(theta) {
            return Math.round(100 + theta * 15);
        },
        
        // IQ â†’ ë°±ë¶„ìœ„
        toPercentile: function(iq) {
            const z = (iq - 100) / 15;
            const t = 1 / (1 + 0.2316419 * Math.abs(z));
            const d = 0.3989423 * Math.exp(-z * z / 2);
            const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            return Math.round((z > 0 ? (1 - p) : p) * 1000) / 10;
        },
        
        // ì‹ ë¢°êµ¬ê°„
        confidenceInterval: function(iq, se, level = 0.95) {
            const z = level === 0.95 ? 1.96 : (level === 0.99 ? 2.576 : 1.645);
            const margin = Math.round(z * se * 15);
            return {
                lower: Math.max(40, iq - margin),
                upper: Math.min(160, iq + margin),
                margin
            };
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì—°ë ¹ ê·œì¤€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const AgeNorms = {
        groups: [
            { id: 'teen', range: [13, 17], label: { ko: 'ì²­ì†Œë…„', en: 'Teenager' }, thetaMean: -0.2, thetaSD: 1.0 },
            { id: 'young', range: [18, 29], label: { ko: 'ì²­ë…„', en: 'Young Adult' }, thetaMean: 0.1, thetaSD: 1.0 },
            { id: 'adult', range: [30, 44], label: { ko: 'ì„±ì¸', en: 'Adult' }, thetaMean: 0.0, thetaSD: 1.0 },
            { id: 'middle', range: [45, 59], label: { ko: 'ì¤‘ë…„', en: 'Middle Age' }, thetaMean: -0.1, thetaSD: 1.0 },
            { id: 'senior', range: [60, 99], label: { ko: 'ì¥ë…„', en: 'Senior' }, thetaMean: -0.3, thetaSD: 1.1 }
        ],
        
        getGroup: function(age) {
            for (const g of this.groups) {
                if (age >= g.range[0] && age <= g.range[1]) return g;
            }
            return this.groups[2];
        },
        
        adjustIQ: function(theta, age) {
            const group = this.getGroup(age);
            const normalized = (theta - group.thetaMean) / group.thetaSD;
            const iq = Math.round(100 + normalized * 15);
            return {
                rawIQ: IRTEngine.toIQ(theta),
                adjustedIQ: Math.max(40, Math.min(160, iq)),
                ageGroup: group,
                adjustment: Math.round((normalized - theta) * 15)
            };
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // IQ ë¶„ë¥˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function classifyIQ(iq) {
        const classifications = [
            { min: 145, label: { ko: 'ìµœìš°ìˆ˜ (Very Superior)', en: 'Very Superior' } },
            { min: 130, label: { ko: 'ë§¤ìš° ìš°ìˆ˜ (Superior)', en: 'Superior' } },
            { min: 120, label: { ko: 'ìš°ìˆ˜ (High Average)', en: 'High Average' } },
            { min: 110, label: { ko: 'í‰ê·  ìƒ (Above Average)', en: 'Above Average' } },
            { min: 90, label: { ko: 'í‰ê·  (Average)', en: 'Average' } },
            { min: 80, label: { ko: 'í‰ê·  í•˜ (Low Average)', en: 'Low Average' } },
            { min: 70, label: { ko: 'ê²½ê³„ì„  (Borderline)', en: 'Borderline' } },
            { min: 0, label: { ko: 'ë§¤ìš° ë‚®ìŒ (Very Low)', en: 'Very Low' } }
        ];
        
        for (const c of classifications) {
            if (iq >= c.min) return c;
        }
        return classifications[classifications.length - 1];
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê²Œì„ ìƒíƒœ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let state = {
        selectedCategory: null,
        userAge: 25,
        currentItems: [],
        currentIndex: 0,
        responses: [],
        responseTimes: [],
        startTime: null,
        timer: null,
        timeLeft: 45,
        validCodes: ['CQ-TESTCODE'],
        isMensa: false
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI í•¨ìˆ˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }
    
    function selectCategory(cat) {
        state.selectedCategory = cat;
        
        document.querySelectorAll('.category-card').forEach(card => {
            card.classList.toggle('selected', card.dataset.category === cat);
        });
        
        document.getElementById('selectionInfo').style.display = 'block';
        updateSelectionInfo();
        
        const btn = document.getElementById('startBtn');
        btn.disabled = false;
        btn.textContent = currentLang === 'ko' ? 'í…ŒìŠ¤íŠ¸ ì‹œì‘' : 'Start Test';
    }
    
    function updateSelectionInfo() {
        if (!state.selectedCategory) return;
        
        const catNames = {
            ko: { pattern: 'íŒ¨í„´ ì¸ì‹', numerical: 'ìˆ˜ë¦¬ ì¶”ë¡ ', spatial: 'ê³µê°„ ì§€ê°', logical: 'ë…¼ë¦¬ ì¶”ë¡ ', verbal: 'ì–¸ì–´ ìœ ì¶”' },
            en: { pattern: 'Pattern Recognition', numerical: 'Numerical Reasoning', spatial: 'Spatial Perception', logical: 'Logical Reasoning', verbal: 'Verbal Analogies' }
        };
        
        const template = i18n[currentLang]['selectionInfo'];
        document.getElementById('selectionText').textContent = template.replace('{category}', catNames[currentLang][state.selectedCategory]);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // í…ŒìŠ¤íŠ¸ ì‹œì‘
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function startTest() {
        const ageInput = document.getElementById('userAge').value;
        state.userAge = parseInt(ageInput) || 25;
        
        if (state.userAge < 13 || state.userAge > 99) {
            alert(currentLang === 'ko' ? '13ì„¸ ì´ìƒ 99ì„¸ ì´í•˜ë§Œ ì°¸ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.' : 'Age must be between 13 and 99.');
            return;
        }
        
        if (!state.selectedCategory) return;
        
        // ë¬¸ì œ ì¤€ë¹„ (ì…”í”Œí•˜ì—¬ 10ë¬¸í•­ ì„ íƒ)
        const allItems = [...IQ_TEST_ITEMS[state.selectedCategory]];
        state.currentItems = shuffle(allItems).slice(0, 10);
        state.currentIndex = 0;
        state.responses = [];
        state.responseTimes = [];
        state.startTime = Date.now();
        state.isMensa = false;
        
        const catNames = {
            ko: { pattern: 'íŒ¨í„´ ì¸ì‹', numerical: 'ìˆ˜ë¦¬ ì¶”ë¡ ', spatial: 'ê³µê°„ ì§€ê°', logical: 'ë…¼ë¦¬ ì¶”ë¡ ', verbal: 'ì–¸ì–´ ìœ ì¶”' },
            en: { pattern: 'Pattern Recognition', numerical: 'Numerical Reasoning', spatial: 'Spatial Perception', logical: 'Logical Reasoning', verbal: 'Verbal Analogies' }
        };
        document.getElementById('categoryLabel').textContent = catNames[currentLang][state.selectedCategory];
        
        showScreen('screen-test');
        displayQuestion();
        startTimer();
    }
    
    function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë¬¸ì œ í‘œì‹œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function displayQuestion() {
        const item = state.currentItems[state.currentIndex];
        const total = state.currentItems.length;
        
        // ì§„í–‰ë¥ 
        document.getElementById('progressText').textContent = `${state.currentIndex + 1} / ${total}`;
        document.getElementById('progressFill').style.width = `${((state.currentIndex + 1) / total) * 100}%`;
        
        // ë¬¸ì œ í…ìŠ¤íŠ¸
        const qText = typeof item.question === 'object' ? item.question[currentLang] : item.question;
        document.getElementById('questionText').textContent = qText;
        
        // ì‹œê° ìë£Œ
        const visual = document.getElementById('questionVisual');
        if (item.matrix) {
            visual.innerHTML = `
                <div class="matrix-grid">
                    ${item.matrix.map((cell, i) => `
                        <div class="matrix-cell ${cell === '?' ? 'highlight' : ''}">${cell}</div>
                    `).join('')}
                </div>
            `;
            visual.style.display = 'block';
        } else if (item.type === 'sequence') {
            visual.innerHTML = `<div class="sequence-display">${qText.split(':')[1] || ''}</div>`;
            visual.style.display = 'none';
        } else {
            visual.style.display = 'none';
        }
        
        // ì„ íƒì§€
        const container = document.getElementById('optionsContainer');
        const options = typeof item.options[0] === 'object' ? item.options[currentLang] || item.options : item.options;
        
        container.innerHTML = options.map((opt, i) => `
            <button class="option-btn" onclick="selectOption(${i})" data-index="${i}">
                ${typeof opt === 'object' ? opt[currentLang] : opt}
            </button>
        `).join('');
        
        document.getElementById('nextBtn').disabled = true;
    }
    
    function selectOption(index) {
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.toggle('selected', parseInt(btn.dataset.index) === index);
        });
        state.selectedOption = index;
        document.getElementById('nextBtn').disabled = false;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // íƒ€ì´ë¨¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function startTimer() {
        state.timeLeft = state.isMensa ? 60 : 45;
        state.questionStartTime = Date.now();
        updateTimerDisplay();
        
        clearInterval(state.timer);
        state.timer = setInterval(() => {
            state.timeLeft--;
            updateTimerDisplay();
            
            if (state.timeLeft <= 0) {
                autoSubmit();
            }
        }, 1000);
    }
    
    function updateTimerDisplay() {
        const timerId = state.isMensa ? 'mensaTimerValue' : 'timerValue';
        const timerEl = document.getElementById(timerId).parentElement;
        
        document.getElementById(timerId).textContent = state.timeLeft;
        
        timerEl.classList.remove('warning', 'danger');
        if (state.timeLeft <= 5) {
            timerEl.classList.add('danger');
        } else if (state.timeLeft <= 10) {
            timerEl.classList.add('warning');
        }
    }
    
    function autoSubmit() {
        // ì‹œê°„ ì´ˆê³¼ - ì˜¤ë‹µ ì²˜ë¦¬
        const item = state.currentItems[state.currentIndex];
        state.responses.push(0);
        state.responseTimes.push(state.isMensa ? 60000 : 45000);
        
        if (state.currentIndex < state.currentItems.length - 1) {
            state.currentIndex++;
            state.selectedOption = null;
            displayQuestion();
            startTimer();
        } else {
            finishTest();
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë‹¤ìŒ ë¬¸ì œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function nextQuestion() {
        if (state.selectedOption === undefined || state.selectedOption === null) return;
        
        const item = state.currentItems[state.currentIndex];
        const isCorrect = state.selectedOption === item.answer ? 1 : 0;
        const responseTime = Date.now() - state.questionStartTime;
        
        state.responses.push(isCorrect);
        state.responseTimes.push(responseTime);
        
        if (state.currentIndex < state.currentItems.length - 1) {
            state.currentIndex++;
            state.selectedOption = null;
            displayQuestion();
            startTimer();
        } else {
            finishTest();
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ë° ê²°ê³¼
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function finishTest() {
        clearInterval(state.timer);
        
        if (state.isMensa) {
            showMensaResults();
        } else {
            showResults();
        }
    }
    
    function showResults() {
        // IRT ëŠ¥ë ¥ ì¶”ì •
        const result = IRTEngine.estimate(state.responses, state.currentItems);
        
        // ì—°ë ¹ ë³´ì •
        const ageResult = AgeNorms.adjustIQ(result.theta, state.userAge);
        
        // ì‹ ë¢°êµ¬ê°„
        const ci = IRTEngine.confidenceInterval(ageResult.adjustedIQ, result.se);
        
        // ë¶„ë¥˜
        const classification = classifyIQ(ageResult.adjustedIQ);
        
        // ë°±ë¶„ìœ„
        const percentile = IRTEngine.toPercentile(ageResult.adjustedIQ);
        
        // ê²°ê³¼ í‘œì‹œ
        document.getElementById('resultIQ').textContent = ageResult.adjustedIQ;
        document.getElementById('resultCI').textContent = `95% CI: ${ci.lower} ~ ${ci.upper}`;
        document.getElementById('resultClass').textContent = classification.label[currentLang];
        document.getElementById('resultPercentile').textContent = 
            currentLang === 'ko' ? `ë°±ë¶„ìœ„ ${percentile}%` : `Percentile ${percentile}%`;
        
        // ì˜ì—­ë³„ ë¶„ì„ (ë‹¨ì¼ ì˜ì—­ì´ë¯€ë¡œ ê°„ëµí™”)
        const chartContainer = document.getElementById('domainChart');
        const catNames = {
            ko: { pattern: 'íŒ¨í„´ ì¸ì‹', numerical: 'ìˆ˜ë¦¬ ì¶”ë¡ ', spatial: 'ê³µê°„ ì§€ê°', logical: 'ë…¼ë¦¬ ì¶”ë¡ ', verbal: 'ì–¸ì–´ ìœ ì¶”' },
            en: { pattern: 'Pattern Recognition', numerical: 'Numerical Reasoning', spatial: 'Spatial Perception', logical: 'Logical Reasoning', verbal: 'Verbal Analogies' }
        };
        
        const barClass = ageResult.adjustedIQ >= 120 ? 'excellent' : 
                        ageResult.adjustedIQ >= 100 ? 'good' : 
                        ageResult.adjustedIQ >= 80 ? 'average' : 'below';
        
        chartContainer.innerHTML = `
            <h3 style="margin-bottom: 20px; text-align: left;">${currentLang === 'ko' ? 'ì˜ì—­ë³„ ë¶„ì„' : 'Domain Analysis'}</h3>
            <div class="domain-bar-item">
                <div class="domain-bar-header">
                    <span class="domain-bar-name">${catNames[currentLang][state.selectedCategory]}</span>
                    <span class="domain-bar-score">IQ ${ageResult.adjustedIQ}</span>
                </div>
                <div class="domain-bar-track">
                    <div class="domain-bar-fill ${barClass}" style="width: ${Math.min(100, (ageResult.adjustedIQ / 160) * 100)}%"></div>
                </div>
            </div>
            <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 10px;">
                ${currentLang === 'ko' ? `ì •ë‹µë¥ : ${state.responses.filter(r => r === 1).length}/10 (${state.responses.filter(r => r === 1).length * 10}%)` :
                `Accuracy: ${state.responses.filter(r => r === 1).length}/10 (${state.responses.filter(r => r === 1).length * 10}%)`}
            </p>
        `;
        
        // ì—°ë ¹ í•´ì„
        const ageInterpretation = document.getElementById('ageInterpretation');
        const ageGroup = ageResult.ageGroup;
        const adj = ageResult.adjustment;
        
        if (currentLang === 'ko') {
            if (adj > 2) {
                ageInterpretation.innerHTML = `ğŸ“Š <strong>${ageGroup.label.ko}</strong> ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ <strong>${Math.abs(adj)}ì </strong> ë†’ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ë™ì¼ ì—°ë ¹ëŒ€ì—ì„œ ìš°ìˆ˜í•œ ì¸ì§€ëŠ¥ë ¥ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`;
            } else if (adj < -2) {
                ageInterpretation.innerHTML = `ğŸ“Š <strong>${ageGroup.label.ko}</strong> ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ <strong>${Math.abs(adj)}ì </strong> ë‚®ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ì¸ì§€ í›ˆë ¨ì„ í†µí•œ ê°œì„ ì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            } else {
                ageInterpretation.innerHTML = `ğŸ“Š <strong>${ageGroup.label.ko}</strong> ì—°ë ¹ëŒ€ì˜ í‰ê· ì ì¸ ì¸ì§€ëŠ¥ë ¥ ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
            }
        } else {
            if (adj > 2) {
                ageInterpretation.innerHTML = `ğŸ“Š Your score is <strong>${Math.abs(adj)} points above</strong> the ${ageGroup.label.en} average. You demonstrate superior cognitive ability for your age group.`;
            } else if (adj < -2) {
                ageInterpretation.innerHTML = `ğŸ“Š Your score is <strong>${Math.abs(adj)} points below</strong> the ${ageGroup.label.en} average. Cognitive training may help improvement.`;
            } else {
                ageInterpretation.innerHTML = `ğŸ“Š Your cognitive ability is <strong>average</strong> for the ${ageGroup.label.en} age group.`;
            }
        }
        
        // ë©˜ì‚¬ ìê²© í™•ì¸
        if (ageResult.adjustedIQ >= 120) {
            const code = generateCode();
            state.validCodes.push(code);
            
            document.getElementById('certificate').style.display = 'block';
            document.getElementById('certCode').textContent = code;
            document.getElementById('mensaBtn').style.display = 'inline-flex';
        } else {
            document.getElementById('certificate').style.display = 'none';
            document.getElementById('mensaBtn').style.display = 'none';
        }
        
        showScreen('screen-result');
    }
    
    function generateCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = 'CQ-';
        for (let i = 0; i < 8; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë©˜ì‚¬ í…ŒìŠ¤íŠ¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function goToMensa() {
        // ê³ ë‚œë„ ë¬¸ì œ ì„ ë³„ (b >= 1.5)
        let mensaItems = [];
        Object.keys(IQ_TEST_ITEMS).forEach(cat => {
            const hard = IQ_TEST_ITEMS[cat].filter(item => item.irt.b >= 1.5);
            mensaItems = mensaItems.concat(hard);
        });
        
        state.currentItems = shuffle(mensaItems).slice(0, 20);
        state.currentIndex = 0;
        state.responses = [];
        state.responseTimes = [];
        state.startTime = Date.now();
        state.isMensa = true;
        state.selectedOption = null;
        
        showScreen('screen-mensa');
        displayMensaQuestion();
        startTimer();
    }
    
    function displayMensaQuestion() {
        const item = state.currentItems[state.currentIndex];
        const total = state.currentItems.length;
        
        document.getElementById('mensaProgressText').textContent = `${state.currentIndex + 1} / ${total}`;
        document.getElementById('mensaProgressFill').style.width = `${((state.currentIndex + 1) / total) * 100}%`;
        
        const qText = typeof item.question === 'object' ? item.question[currentLang] : item.question;
        document.getElementById('mensaQuestionText').textContent = qText;
        
        const visual = document.getElementById('mensaQuestionVisual');
        if (item.matrix) {
            visual.innerHTML = `
                <div class="matrix-grid">
                    ${item.matrix.map((cell, i) => `
                        <div class="matrix-cell ${cell === '?' ? 'highlight' : ''}">${cell}</div>
                    `).join('')}
                </div>
            `;
            visual.style.display = 'block';
        } else {
            visual.style.display = 'none';
        }
        
        const container = document.getElementById('mensaOptionsContainer');
        const options = typeof item.options[0] === 'object' ? (item.options[currentLang] || item.options) : item.options;
        
        container.innerHTML = options.map((opt, i) => `
            <button class="option-btn" onclick="selectMensaOption(${i})" data-index="${i}">
                ${typeof opt === 'object' ? opt[currentLang] : opt}
            </button>
        `).join('');
        
        document.getElementById('mensaNextBtn').disabled = true;
    }
    
    function selectMensaOption(index) {
        document.querySelectorAll('#mensaOptionsContainer .option-btn').forEach(btn => {
            btn.classList.toggle('selected', parseInt(btn.dataset.index) === index);
        });
        state.selectedOption = index;
        document.getElementById('mensaNextBtn').disabled = false;
    }
    
    function nextMensaQuestion() {
        if (state.selectedOption === undefined || state.selectedOption === null) return;
        
        const item = state.currentItems[state.currentIndex];
        const isCorrect = state.selectedOption === item.answer ? 1 : 0;
        const responseTime = Date.now() - state.questionStartTime;
        
        state.responses.push(isCorrect);
        state.responseTimes.push(responseTime);
        
        if (state.currentIndex < state.currentItems.length - 1) {
            state.currentIndex++;
            state.selectedOption = null;
            displayMensaQuestion();
            startTimer();
        } else {
            finishTest();
        }
    }
    
    function showMensaResults() {
        const result = IRTEngine.estimate(state.responses, state.currentItems);
        const ageResult = AgeNorms.adjustIQ(result.theta, state.userAge);
        
        // ë©˜ì‚¬ í…ŒìŠ¤íŠ¸ëŠ” ê¸°ë³¸ 115 ë³´ì •
        const mensaIQ = Math.round(Math.max(100, Math.min(160, 115 + result.theta * 15)));
        const ci = IRTEngine.confidenceInterval(mensaIQ, result.se);
        const classification = classifyIQ(mensaIQ);
        const percentile = IRTEngine.toPercentile(mensaIQ);
        
        document.getElementById('mensaResultIQ').textContent = mensaIQ;
        document.getElementById('mensaResultCI').textContent = `95% CI: ${ci.lower} ~ ${ci.upper}`;
        document.getElementById('mensaResultClass').textContent = classification.label[currentLang];
        document.getElementById('mensaResultPercentile').textContent = 
            currentLang === 'ko' ? `ë°±ë¶„ìœ„ ${percentile}%` : `Percentile ${percentile}%`;
        
        if (mensaIQ >= 130) {
            document.getElementById('mensaCertificate').style.display = 'block';
        } else {
            document.getElementById('mensaCertificate').style.display = 'none';
        }
        
        showScreen('screen-mensa-result');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê¸°íƒ€ ê¸°ëŠ¥
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function tryAnotherCategory() {
        state.selectedCategory = null;
        document.querySelectorAll('.category-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('selectionInfo').style.display = 'none';
        document.getElementById('startBtn').disabled = true;
        document.getElementById('startBtn').textContent = currentLang === 'ko' ? 'ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”' : 'Select a domain';
        showScreen('screen-intro');
    }
    
    function showCodeInput() {
        document.getElementById('codeModal').classList.add('active');
        document.getElementById('codeInput').value = '';
        document.getElementById('codeError').style.display = 'none';
    }
    
    function hideCodeInput() {
        document.getElementById('codeModal').classList.remove('active');
    }
    
    function verifyCode() {
        const code = document.getElementById('codeInput').value.trim().toUpperCase();
        
        if (state.validCodes.includes(code)) {
            hideCodeInput();
            goToMensa();
        } else {
            document.getElementById('codeError').textContent = i18n[currentLang]['modal.invalidCode'];
            document.getElementById('codeError').style.display = 'block';
        }
    }
    
    function confirmExit() {
        document.getElementById('exitModal').classList.add('active');
    }
    
    function hideExitModal() {
        document.getElementById('exitModal').classList.remove('active');
    }
    
    function exitTest() {
        clearInterval(state.timer);
        hideExitModal();
        location.reload();
    }
    
    function printReport() {
        window.print();
    }
    
    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        setLanguage('ko');
    });
    </script>
</body>
</html>
